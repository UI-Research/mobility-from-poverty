---
title: "Historical Employment Metric Comparison"
author: "JP Walsh"
date: today
format:
  html:
    toc: true
    toc_float: true
    embed-resources: true
    code-fold: true
execute: 
  warning: false
editor_options: 
  chunk_output_type: console
---

This program compares the results for the employment metric updated by JP Walsh in 2023/24 with the results originally produced by Kevin in 2022/23. These processes should be the same and as a result the final metrics should be comparable.

## House keeping

```{r}
library(tidyverse)
library(tidylog)
library(here)
library(assertr)
library(gt)

options(scipen = 999)
```

## Longitudinal Data        

Ready income metric.
```{r}

counties_old <- read_csv(here("data", "01_mobility-metrics_race-ethnicity_longitudinal.csv")) %>% 
  select(year, state, county, share_employed, subgroup) %>% 
  filter(year == 2021, subgroup == "All")

counties_new <- read_csv(here("09_employment", "data", "final", "metrics_employment_county_race-ethnicity_longitudinal.csv")) %>% 
  select(year, state, county, share_employed_updt = share_employed, subgroup) %>% 
  filter(year == 2021, subgroup == "All")
  
```

Summarize the statistics. Remove NAs from the old data set where we have added suppression so that the comparison groups are equal.
```{r}
counties_suppressed_new <- counties_new %>% 
  mutate(fips = paste0(state, county)) %>% 
  filter(is.na(share_employed_updt)) %>% 
  select(fips) %>% 
  pull()

counties_old %>%
  mutate(fips = paste0(state, county)) %>% 
  filter(!fips %in% counties_suppressed_new) %>% 
  summary()

counties_new %>% 
  summary()
```

Join metrics and compare the results. There are minuscule differences between a selection of counties likely due to rounding differences.
```{r}

counties_new %>% 
  left_join(counties_old, by = c("year", "state", "county")) %>% 
  filter(!is.na(share_employed_updt)) %>% 
  mutate(diff_employed = round((share_employed_updt - share_employed), digits = 3)) %>% 
  reactable::reactable()

```

