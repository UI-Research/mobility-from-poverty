<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="JP Walsh">

<title>Air Quality Index Program</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="air_toxicity_metric_files/libs/clipboard/clipboard.min.js"></script>
<script src="air_toxicity_metric_files/libs/quarto-html/quarto.js"></script>
<script src="air_toxicity_metric_files/libs/quarto-html/popper.min.js"></script>
<script src="air_toxicity_metric_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="air_toxicity_metric_files/libs/quarto-html/anchor.min.js"></script>
<link href="air_toxicity_metric_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="air_toxicity_metric_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="air_toxicity_metric_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="air_toxicity_metric_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="air_toxicity_metric_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

<script src="air_toxicity_metric_files/libs/core-js-2.5.3/shim.min.js"></script>
<script src="air_toxicity_metric_files/libs/react-18.2.0/react.min.js"></script>
<script src="air_toxicity_metric_files/libs/react-18.2.0/react-dom.min.js"></script>
<script src="air_toxicity_metric_files/libs/reactwidget-1.0.0/react-tools.js"></script>
<script src="air_toxicity_metric_files/libs/htmlwidgets-1.6.2/htmlwidgets.js"></script>
<link href="air_toxicity_metric_files/libs/reactable-0.4.4/reactable.css" rel="stylesheet">
<script src="air_toxicity_metric_files/libs/reactable-binding-0.4.4/reactable.js"></script>


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Air Quality Index Program</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>JP Walsh </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<p><em>Program for the creation of the Air Quality index metric under the Environemntal quality predictor</em></p>
<p>ACS Code: Initially written by Rebecca Marx and updated by JP Walsh 2022-2023.</p>
<p>Primary data derived from the EPA AirTox Screen Assessment (data source linked below).</p>
<section id="housekeeping" class="level2">
<h2 class="anchored" data-anchor-id="housekeeping">Housekeeping</h2>
<p>Read in packages for use. If you do not have an IPUMS API key you will need to make one via the <a href="https://www.ipums.org/">IPUMS website</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidycensus)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>-- Attaching core tidyverse packages ------------------------ tidyverse 2.0.0 --
v dplyr     1.1.3     v readr     2.1.4
v forcats   1.0.0     v stringr   1.5.0
v ggplot2   3.4.4     v tibble    3.2.1
v lubridate 1.9.3     v tidyr     1.3.0
v purrr     1.0.2     
-- Conflicts ------------------------------------------ tidyverse_conflicts() --
x dplyr::filter() masks stats::filter()
x dplyr::lag()    masks stats::lag()
i Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: NLP

Attaching package: 'NLP'

The following object is masked from 'package:ggplot2':

    annotate</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(skimr)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rvest)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'rvest'

The following object is masked from 'package:readr':

    guess_encoding</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'httr'

The following object is masked from 'package:NLP':

    content</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidylog)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'tidylog'

The following objects are masked from 'package:dplyr':

    add_count, add_tally, anti_join, count, distinct, distinct_all,
    distinct_at, distinct_if, filter, filter_all, filter_at, filter_if,
    full_join, group_by, group_by_all, group_by_at, group_by_if,
    inner_join, left_join, mutate, mutate_all, mutate_at, mutate_if,
    relocate, rename, rename_all, rename_at, rename_if, rename_with,
    right_join, sample_frac, sample_n, select, select_all, select_at,
    select_if, semi_join, slice, slice_head, slice_max, slice_min,
    slice_sample, slice_tail, summarise, summarise_all, summarise_at,
    summarise_if, summarize, summarize_all, summarize_at, summarize_if,
    tally, top_frac, top_n, transmute, transmute_all, transmute_at,
    transmute_if, ungroup

The following objects are masked from 'package:tidyr':

    drop_na, fill, gather, pivot_longer, pivot_wider, replace_na,
    spread, uncount

The following object is masked from 'package:stats':

    filter</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reactable)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'janitor'

The following objects are masked from 'package:stats':

    chisq.test, fisher.test</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Enter census API key here.</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co">#census_api_key(YOUR KEY)</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen =</span> <span class="dv">999</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="program-overview" class="level2">
<h2 class="anchored" data-anchor-id="program-overview">Program Overview</h2>
<p>Original data pulled from the EPA website:</p>
<p><a href="https://www.epa.gov/AirToxScreen/2019-airtoxscreen-assessment-results#nationwide">2019 Data</a> <a href="https://www.epa.gov/AirToxScreen/2018-airtoxscreen-assessment-results#nationwide">2018 Data</a> <a href="https://www.epa.gov/national-air-toxics-assessment/2014-nata-assessment-results">2014 Data</a></p>
<p>Downloaded data is available in the Air Quality folder inside the Metrics_2024_round <a href="https://urbanorg.box.com/s/n82wl2bv8n2nmrdcgwa07q1dyn5bldvc">box folder</a>.</p>
<p>Description:</p>
<p>This code updates the program titled AirTox_2018_clean.R which was written by Rebecca Marx and was last updated April 4, 2023. The program recreates Rebecca’s steps and adds environmental hazards data for 2019.Note that the EPA uses the same list of census tracts in all years.</p>
</section>
<section id="read-data" class="level2">
<h2 class="anchored" data-anchor-id="read-data">Read data</h2>
<p>Import AirTox Screen Data on Cancer, Neuroligical and Respitory health for years 2014, 2018 and 2019. These data are in three seperate excel files for each year. Bind them together using map.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>airtox_data19 <span class="ot">&lt;-</span> <span class="fu">map_df</span>(<span class="fu">list.files</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"06_neighborhoods/environment/data/raw/2019/"</span>)), </span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="sc">~</span><span class="fu">read_excel</span>(<span class="fu">paste0</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"06_neighborhoods/environment/data/raw/2019"</span>), <span class="st">"/"</span>, .x))) <span class="sc">%&gt;%</span> </span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="st">"2019"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>mutate: new variable 'year' (character) with one unique value and 0% NA</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>airtox_data18 <span class="ot">&lt;-</span> <span class="fu">map_df</span>(<span class="fu">list.files</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"06_neighborhoods/environment/data/raw/2018/"</span>)), </span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="sc">~</span><span class="fu">read_excel</span>(<span class="fu">paste0</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"06_neighborhoods/environment/data/raw/2018"</span>), <span class="st">"/"</span>, .x))) <span class="sc">%&gt;%</span>  </span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="st">"2018"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>mutate: new variable 'year' (character) with one unique value and 0% NA</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>airtox_data14 <span class="ot">&lt;-</span> <span class="fu">map_df</span>(<span class="fu">list.files</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"06_neighborhoods/environment/data/raw/2014/"</span>)), </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="sc">~</span><span class="fu">read_excel</span>(<span class="fu">paste0</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"06_neighborhoods/environment/data/raw/2014"</span>), <span class="st">"/"</span>, .x))) <span class="sc">%&gt;%</span> </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="st">"2014"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>mutate: new variable 'year' (character) with one unique value and 0% NA</code></pre>
</div>
</div>
<p>Confirm that the census tracts included are the same for each year of data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>tracts19 <span class="ot">&lt;-</span> airtox_data19 <span class="sc">%&gt;%</span> </span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">year19 =</span> year, tract) <span class="sc">%&gt;%</span> </span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>select: renamed one variable (year19) and dropped 122 variables</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>tracts18 <span class="ot">&lt;-</span> airtox_data18 <span class="sc">%&gt;%</span> </span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">year18 =</span> year, tract) <span class="sc">%&gt;%</span> </span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>select: renamed one variable (year18) and dropped 122 variables</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>tracts14 <span class="ot">&lt;-</span> airtox_data14 <span class="sc">%&gt;%</span> </span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">year14 =</span> year, tract) <span class="sc">%&gt;%</span> </span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>select: renamed one variable (year14) and dropped 122 variables</code></pre>
</div>
</div>
<p>Comparing the 2019 and 2018 data the tract list is exactly the same.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anti_join</span>(tracts19, tracts18)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(tract)`
anti_join: added no columns
&gt; rows only in x 0
&gt; rows only in y ( 0)
&gt; matched rows (76,726)
&gt; ========
&gt; rows total 0</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 0 x 2
# i 2 variables: year19 &lt;chr&gt;, tract &lt;chr&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anti_join</span>(tracts18, tracts19)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(tract)`
anti_join: added no columns
&gt; rows only in x 0
&gt; rows only in y ( 0)
&gt; matched rows (76,726)
&gt; ========
&gt; rows total 0</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 0 x 2
# i 2 variables: year18 &lt;chr&gt;, tract &lt;chr&gt;</code></pre>
</div>
</div>
<p>For 2014 there are several tracts that are included but changed in the 18/19 data.These are corrrected for in the crosswalk section below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anti_join</span>(tracts14, tracts19)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(tract)`
anti_join: added no columns
&gt; rows only in x 7
&gt; rows only in y ( 6)
&gt; matched rows (76,720)
&gt; ========
&gt; rows total 7</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 x 2
  year14 tract      
  &lt;chr&gt;  &lt;chr&gt;      
1 2014   02270000000
2 2014   02270000100
3 2014   06037980004
4 2014   46113000000
5 2014   46113940500
6 2014   46113940800
7 2014   46113940900</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anti_join</span>(tracts14, tracts18)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(tract)`
anti_join: added no columns
&gt; rows only in x 7
&gt; rows only in y ( 6)
&gt; matched rows (76,720)
&gt; ========
&gt; rows total 7</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 x 2
  year14 tract      
  &lt;chr&gt;  &lt;chr&gt;      
1 2014   02270000000
2 2014   02270000100
3 2014   06037980004
4 2014   46113000000
5 2014   46113940500
6 2014   46113940800
7 2014   46113940900</code></pre>
</div>
</div>
<p>Create versions of the data with only the census tract ID and tract level risk indicator from each year of data.</p>
<p>Starting with the cancer indicator, select only cases where total_cancer_risk is filled in the data and bind the individual years. The data frame cancer_data will now have the cancer metric for 2014, 2018 and 2019.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>cancer_data <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(airtox_data19 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(total_cancer_risk_per_million)), </span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>                               airtox_data18 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(total_cancer_risk_per_million)),</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>                         airtox_data14 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(total_cancer_risk_per_million))) <span class="sc">%&gt;%</span> </span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(year, tract, total_cancer_risk_per_million)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>filter: removed 153,452 rows (67%), 76,726 rows remaining
filter: removed 153,452 rows (67%), 76,726 rows remaining</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>filter: removed 153,454 rows (67%), 76,727 rows remaining</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>select: dropped 121 variables (state, epa_region, county, fips, population, …)</code></pre>
</div>
</div>
<p>Check the distribution of the cancer metric by year.There are some significant outliers in the data where tracts have a very high cancer hazard risk (we can leave these in as there is no reason to belive the EPA made a mistake). The second graph removes outliers and shows that after 2014 the EPA started rounding this statistic to the nearest 10th (not sure if this was intentional or an unintended consequence of using the xlsx format).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>cancer_data <span class="sc">%&gt;%</span> </span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">factor</span>(year)) <span class="sc">%&gt;%</span> </span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> total_cancer_risk_per_million, <span class="at">color =</span> year, <span class="at">fill =</span> year)) <span class="sc">+</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.15</span>) <span class="sc">+</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Tracts by cancer risk hazard, distriubtion"</span>) <span class="sc">+</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Density"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>mutate: converted 'year' from character to factor (0 new NA)</code></pre>
</div>
<div class="cell-output-display">
<p><img src="air_toxicity_metric_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>cancer_data <span class="sc">%&gt;%</span> </span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(total_cancer_risk_per_million <span class="sc">&lt;</span> <span class="dv">100</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">factor</span>(year)) <span class="sc">%&gt;%</span> </span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> total_cancer_risk_per_million, <span class="at">color =</span> year, <span class="at">fill =</span> year)) <span class="sc">+</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.15</span>) <span class="sc">+</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Tracts by cancer risk hazard, distriubtion (no outliers)"</span>) <span class="sc">+</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Density"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>filter: removed 226 rows (&lt;1%), 229,953 rows remaining
mutate: converted 'year' from character to factor (0 new NA)</code></pre>
</div>
<div class="cell-output-display">
<p><img src="air_toxicity_metric_files/figure-html/unnamed-chunk-7-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Next, select only cases where total_neurological_hazard is filled in and bind all years.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>nuero_data <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(airtox_data19 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(total_neurological_hazard_quotient)), </span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>                               airtox_data18 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(total_neurological_hazard_quotient)),</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>                         airtox_data14 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(total_neurological_hazard_quotient))) <span class="sc">%&gt;%</span> </span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(year, tract, total_neurological_hazard_quotient)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>filter: removed 153,452 rows (67%), 76,726 rows remaining
filter: removed 153,452 rows (67%), 76,726 rows remaining</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>filter: removed 153,454 rows (67%), 76,727 rows remaining</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>select: dropped 121 variables (state, epa_region, county, fips, population, …)</code></pre>
</div>
</div>
<p>Check the distribution of the nuero metric by year.There are some significant outliers in the data where tracts have a very high nuero hazard risk. The same issue exists as above with rounding.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>nuero_data <span class="sc">%&gt;%</span> </span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">factor</span>(year)) <span class="sc">%&gt;%</span> </span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> total_neurological_hazard_quotient, <span class="at">color =</span> year, <span class="at">fill =</span> year)) <span class="sc">+</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.15</span>) <span class="sc">+</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Tracts by cancer risk hazard, distriubtion"</span>) <span class="sc">+</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Density"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>mutate: converted 'year' from character to factor (0 new NA)</code></pre>
</div>
<div class="cell-output-display">
<p><img src="air_toxicity_metric_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>nuero_data <span class="sc">%&gt;%</span> </span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(total_neurological_hazard_quotient <span class="sc">&lt;</span> <span class="fl">0.15</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">factor</span>(year)) <span class="sc">%&gt;%</span> </span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> total_neurological_hazard_quotient, <span class="at">color =</span> year, <span class="at">fill =</span> year)) <span class="sc">+</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.15</span>) <span class="sc">+</span></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Tracts by cancer risk hazard, distriubtion (no outliers)"</span>) <span class="sc">+</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Density"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>filter: removed 1,478 rows (1%), 228,701 rows remaining
mutate: converted 'year' from character to factor (0 new NA)</code></pre>
</div>
<div class="cell-output-display">
<p><img src="air_toxicity_metric_files/figure-html/unnamed-chunk-9-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Next, select only cases where total_respiratory_hazard is filled in and bind all years.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>resp_data <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(airtox_data19 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(total_respiratory_hazard_quotient)), </span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>                               airtox_data18 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(total_respiratory_hazard_quotient)),</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>                         airtox_data14 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(total_respiratory_hazard_quotient))) <span class="sc">%&gt;%</span> </span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(year, tract, total_respiratory_hazard_quotient)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>filter: removed 153,452 rows (67%), 76,726 rows remaining
filter: removed 153,452 rows (67%), 76,726 rows remaining</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>filter: removed 153,454 rows (67%), 76,727 rows remaining</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>select: dropped 121 variables (state, epa_region, county, fips, population, …)</code></pre>
</div>
</div>
<p>Check the distribution of the nuero metric by year. Graph 1 again shows there are some tracts with significantly higher respo risk. Note same issue as prior years with rounding.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>resp_data <span class="sc">%&gt;%</span> </span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">factor</span>(year)) <span class="sc">%&gt;%</span> </span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> total_respiratory_hazard_quotient, <span class="at">color =</span> year, <span class="at">fill =</span> year)) <span class="sc">+</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.15</span>) <span class="sc">+</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Tracts by resp risk hazard, distriubtion"</span>) <span class="sc">+</span></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Density"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>mutate: converted 'year' from character to factor (0 new NA)</code></pre>
</div>
<div class="cell-output-display">
<p><img src="air_toxicity_metric_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>resp_data <span class="sc">%&gt;%</span> </span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(total_respiratory_hazard_quotient <span class="sc">&lt;</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">factor</span>(year)) <span class="sc">%&gt;%</span> </span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> total_respiratory_hazard_quotient, <span class="at">color =</span> year, <span class="at">fill =</span> year)) <span class="sc">+</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.15</span>) <span class="sc">+</span></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Tracts by resp risk hazard, distriubtion (no outliers)"</span>) <span class="sc">+</span></span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Density"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>filter: removed 278 rows (&lt;1%), 229,901 rows remaining
mutate: converted 'year' from character to factor (0 new NA)</code></pre>
</div>
<div class="cell-output-display">
<p><img src="air_toxicity_metric_files/figure-html/unnamed-chunk-11-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Join the data sets for each risk category by census tract. Rename the variables so they are easily referenced throughout the program.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>enviro_all <span class="ot">&lt;-</span> <span class="fu">left_join</span>(cancer_data, nuero_data, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"tract"</span>, <span class="st">"year"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(resp_data, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"tract"</span>, <span class="st">"year"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(year, tract, <span class="at">resp =</span> total_respiratory_hazard_quotient, <span class="at">canc =</span> total_cancer_risk_per_million,</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">neuro =</span> total_neurological_hazard_quotient)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>left_join: added one column (total_neurological_hazard_quotient)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>           &gt; rows only in x         0</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>           &gt; rows only in y  (      0)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>           &gt; matched rows     230,179</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>           &gt;                 =========</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>           &gt; rows total       230,179</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>left_join: added one column (total_respiratory_hazard_quotient)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>           &gt; rows only in x         0</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>           &gt; rows only in y  (      0)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>           &gt; matched rows     230,179</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>           &gt;                 =========</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>           &gt; rows total       230,179</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>select: renamed 3 variables (resp, canc, neuro)</code></pre>
</div>
</div>
<section id="acs-tract-data" class="level3">
<h3 class="anchored" data-anchor-id="acs-tract-data">ACS Tract Data</h3>
<p>Add tract-level subgroup information which will be used to break out the racial composition and poverty level of each census tract. First we will read in tract level population data. Total population and total white, non-Hispanic. Then total population in poverty.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load_variables</span>(<span class="dv">2019</span>, <span class="st">"acs5"</span>, <span class="at">cache =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"B01003_001"</span>, <span class="st">"B03002_003"</span>, <span class="st">"B03002_001"</span>, <span class="st">"B17001_001"</span>, <span class="st">"B17001_002"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reactable</span>(<span class="at">searchable =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>filter: removed 27,035 rows (&gt;99%), 5 rows remaining</code></pre>
</div>
<div class="cell-output-display">

<div class="reactable html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-ce2663795dddc4f84f87" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-ce2663795dddc4f84f87">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"name":["B01003_001","B03002_001","B03002_003","B17001_001","B17001_002"],"label":["Estimate!!Total","Estimate!!Total:","Estimate!!Total:!!Not Hispanic or Latino:!!White alone","Estimate!!Total:","Estimate!!Total:!!Income in the past 12 months below poverty level:"],"concept":["TOTAL POPULATION","HISPANIC OR LATINO ORIGIN BY RACE","HISPANIC OR LATINO ORIGIN BY RACE","POVERTY STATUS IN THE PAST 12 MONTHS BY SEX BY AGE","POVERTY STATUS IN THE PAST 12 MONTHS BY SEX BY AGE"],"geography":["block group","block group","block group","tract","tract"]},"columns":[{"id":"name","name":"name","type":"character"},{"id":"label","name":"label","type":"character"},{"id":"concept","name":"concept","type":"character"},{"id":"geography","name":"geography","type":"character"}],"searchable":true,"dataKey":"b9650e75cc2fcf32932300959e6bc1f7"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>state_abrv <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"DC"</span>, state.abb) </span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>pull_acs <span class="ot">&lt;-</span> <span class="cf">function</span>(years) {</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>  tidycensus<span class="sc">::</span><span class="fu">get_acs</span>(<span class="at">geography =</span> <span class="st">"tract"</span>, </span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">variables =</span> <span class="fu">c</span>(<span class="st">"total_pop"</span> <span class="ot">=</span> <span class="st">"B01003_001"</span>,</span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"total_pop_race"</span> <span class="ot">=</span> <span class="st">"B03002_001"</span>,</span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"wnh"</span> <span class="ot">=</span> <span class="st">"B03002_003"</span>, </span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"total_pop_pov"</span> <span class="ot">=</span> <span class="st">"B17001_001"</span>, </span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"poverty"</span> <span class="ot">=</span> <span class="st">"B17001_002"</span>),</span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true" tabindex="-1"></a>                      <span class="at">year =</span> years,</span>
<span id="cb78-12"><a href="#cb78-12" aria-hidden="true" tabindex="-1"></a>                      <span class="at">state =</span> state_abrv,</span>
<span id="cb78-13"><a href="#cb78-13" aria-hidden="true" tabindex="-1"></a>                      <span class="at">geometry =</span> <span class="cn">FALSE</span>,</span>
<span id="cb78-14"><a href="#cb78-14" aria-hidden="true" tabindex="-1"></a>                      <span class="at">output =</span> <span class="st">"wide"</span></span>
<span id="cb78-15"><a href="#cb78-15" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb78-16"><a href="#cb78-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.character</span>(years))</span>
<span id="cb78-17"><a href="#cb78-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb78-18"><a href="#cb78-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-19"><a href="#cb78-19" aria-hidden="true" tabindex="-1"></a>acs_tracts <span class="ot">&lt;-</span> <span class="fu">map_dfr</span>(<span class="fu">list</span>(<span class="dv">2019</span>, <span class="dv">2018</span>, <span class="dv">2014</span>), pull_acs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Getting data from the 2015-2019 5-year ACS</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Fetching tract data by state and combining the result.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>mutate: new variable 'year' (character) with one unique value and 0% NA</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Getting data from the 2014-2018 5-year ACS</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Fetching tract data by state and combining the result.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>mutate: new variable 'year' (character) with one unique value and 0% NA</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Getting data from the 2010-2014 5-year ACS</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Fetching tract data by state and combining the result.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>mutate: new variable 'year' (character) with one unique value and 0% NA</code></pre>
</div>
</div>
</section>
</section>
<section id="clean-data" class="level2">
<h2 class="anchored" data-anchor-id="clean-data">Clean Data</h2>
<p>Remove results form Puerto Rico and Virgin Islands.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>enviro_all_clean <span class="ot">&lt;-</span> enviro_all <span class="sc">%&gt;%</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">state =</span> <span class="fu">str_sub</span>(tract, <span class="dv">1</span>, <span class="dv">2</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(state <span class="sc">!=</span> <span class="dv">72</span> <span class="sc">&amp;</span> state <span class="sc">!=</span> <span class="dv">78</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>mutate: new variable 'state' (character) with 54 unique values and 0% NA</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>filter: removed 3,021 rows (1%), 227,158 rows remaining</code></pre>
</div>
</div>
<p>The EPA AirToxScreen data uses some census tracts from 2010 that have been changed since then. Adjust these tracts manually first.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>enviro_all_clean <span class="ot">&lt;-</span> enviro_all_clean <span class="sc">%&gt;%</span> </span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tract =</span> <span class="fu">case_when</span>(                                  </span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>      tract <span class="sc">==</span>  <span class="st">"36053940101"</span> <span class="sc">~</span> <span class="st">"36053030101"</span>,</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>      tract <span class="sc">==</span>  <span class="st">"36053940102"</span> <span class="sc">~</span> <span class="st">"36053030102"</span>,</span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>      tract <span class="sc">==</span>  <span class="st">"36053940103"</span> <span class="sc">~</span> <span class="st">"36053030103"</span>, </span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a>      tract <span class="sc">==</span>  <span class="st">"36053940200"</span> <span class="sc">~</span> <span class="st">"36053030200"</span>,</span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a>      tract <span class="sc">==</span>  <span class="st">"36053940300"</span> <span class="sc">~</span> <span class="st">"36053030300"</span>,</span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a>      tract <span class="sc">==</span>  <span class="st">"36053940401"</span> <span class="sc">~</span> <span class="st">"36053030401"</span>,</span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a>      tract <span class="sc">==</span>  <span class="st">"36053940700"</span> <span class="sc">~</span> <span class="st">"36053030402"</span>,</span>
<span id="cb91-10"><a href="#cb91-10" aria-hidden="true" tabindex="-1"></a>      tract <span class="sc">==</span>  <span class="st">"36053940403"</span> <span class="sc">~</span> <span class="st">"36053030403"</span>,</span>
<span id="cb91-11"><a href="#cb91-11" aria-hidden="true" tabindex="-1"></a>      tract <span class="sc">==</span>  <span class="st">"36053940600"</span> <span class="sc">~</span> <span class="st">"36053030600"</span>,</span>
<span id="cb91-12"><a href="#cb91-12" aria-hidden="true" tabindex="-1"></a>      tract <span class="sc">==</span>  <span class="st">"36065940100"</span> <span class="sc">~</span> <span class="st">"36065024700"</span>,</span>
<span id="cb91-13"><a href="#cb91-13" aria-hidden="true" tabindex="-1"></a>      tract <span class="sc">==</span>  <span class="st">"36065940000"</span> <span class="sc">~</span> <span class="st">"36065024800"</span>,</span>
<span id="cb91-14"><a href="#cb91-14" aria-hidden="true" tabindex="-1"></a>      tract <span class="sc">==</span>  <span class="st">"36065940200"</span> <span class="sc">~</span> <span class="st">"36065024900"</span>,</span>
<span id="cb91-15"><a href="#cb91-15" aria-hidden="true" tabindex="-1"></a>      tract <span class="sc">==</span>  <span class="st">"04019002701"</span> <span class="sc">~</span> <span class="st">"04019002704"</span>,</span>
<span id="cb91-16"><a href="#cb91-16" aria-hidden="true" tabindex="-1"></a>      tract <span class="sc">==</span>  <span class="st">"04019002903"</span> <span class="sc">~</span> <span class="st">"04019002906"</span>,</span>
<span id="cb91-17"><a href="#cb91-17" aria-hidden="true" tabindex="-1"></a>      tract <span class="sc">==</span>  <span class="st">"04019410501"</span> <span class="sc">~</span> <span class="st">"04019004118"</span>, </span>
<span id="cb91-18"><a href="#cb91-18" aria-hidden="true" tabindex="-1"></a>      tract <span class="sc">==</span>  <span class="st">"04019410502"</span> <span class="sc">~</span> <span class="st">"04019004121"</span>,</span>
<span id="cb91-19"><a href="#cb91-19" aria-hidden="true" tabindex="-1"></a>      tract <span class="sc">==</span>  <span class="st">"04019410503"</span> <span class="sc">~</span> <span class="st">"04019004125"</span>, </span>
<span id="cb91-20"><a href="#cb91-20" aria-hidden="true" tabindex="-1"></a>      tract <span class="sc">==</span>  <span class="st">"04019470400"</span> <span class="sc">~</span> <span class="st">"04019005200"</span>, </span>
<span id="cb91-21"><a href="#cb91-21" aria-hidden="true" tabindex="-1"></a>      tract <span class="sc">==</span>  <span class="st">"04019470500"</span> <span class="sc">~</span> <span class="st">"04019005300"</span>, </span>
<span id="cb91-22"><a href="#cb91-22" aria-hidden="true" tabindex="-1"></a>      tract <span class="sc">==</span>  <span class="st">"06037930401"</span> <span class="sc">~</span> <span class="st">"06037137000"</span>,</span>
<span id="cb91-23"><a href="#cb91-23" aria-hidden="true" tabindex="-1"></a>      tract <span class="sc">==</span>  <span class="st">"51515050100"</span> <span class="sc">~</span> <span class="st">"51019050100"</span>,</span>
<span id="cb91-24"><a href="#cb91-24" aria-hidden="true" tabindex="-1"></a>      tract <span class="sc">==</span>  <span class="st">"02270000100"</span> <span class="sc">~</span> <span class="st">"02158000100"</span>,</span>
<span id="cb91-25"><a href="#cb91-25" aria-hidden="true" tabindex="-1"></a>      tract <span class="sc">==</span>  <span class="st">"46113940500"</span> <span class="sc">~</span> <span class="st">"46102940500"</span>,</span>
<span id="cb91-26"><a href="#cb91-26" aria-hidden="true" tabindex="-1"></a>      tract <span class="sc">==</span>  <span class="st">"46113940800"</span> <span class="sc">~</span> <span class="st">"46102940800"</span>,</span>
<span id="cb91-27"><a href="#cb91-27" aria-hidden="true" tabindex="-1"></a>      tract <span class="sc">==</span>  <span class="st">"46113940900"</span> <span class="sc">~</span> <span class="st">"46102940900"</span>, </span>
<span id="cb91-28"><a href="#cb91-28" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> tract</span>
<span id="cb91-29"><a href="#cb91-29" aria-hidden="true" tabindex="-1"></a>    ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>mutate: changed 64 values (&lt;1%) of 'tract' (0 new NA)</code></pre>
</div>
</div>
<p>The data contains some results that are not at the tract level. Some of these rows can be identified because the tract ID will be entirely zeros.</p>
<p>Create a variable with just the tract ID information alone (remove county and state from the GEOID).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>enviro_all_clean <span class="ot">&lt;-</span> enviro_all_clean <span class="sc">%&gt;%</span> </span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tract_id =</span> <span class="fu">str_sub</span>(tract, <span class="at">start =</span> <span class="dv">6</span>, <span class="at">end =</span> <span class="dv">11</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>mutate: new variable 'tract_id' (character) with 23,762 unique values and 0% NA</code></pre>
</div>
</div>
<p>Count the number of these rows.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>enviro_all_clean <span class="sc">%&gt;%</span> </span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(tract_id <span class="sc">==</span> <span class="st">"000000"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(tract_id) <span class="sc">%&gt;%</span> </span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>filter: removed 217,576 rows (96%), 9,582 rows remaining</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>group_by: one grouping variable (tract_id)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>count: now one row and 2 columns, one group variable remaining (tract_id)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 x 2
# Groups:   tract_id [1]
  tract_id     n
  &lt;chr&gt;    &lt;int&gt;
1 000000    9582</code></pre>
</div>
</div>
<p>Join onto the ACS tract data so we know we are only keeping census tract level data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>enviro_all_tracts <span class="ot">&lt;-</span> acs_tracts <span class="sc">%&gt;%</span> </span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2019</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID) <span class="sc">%&gt;%</span> </span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(enviro_all_clean, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span> <span class="ot">=</span> <span class="st">"tract"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(tract_id)) <span class="sc">%&gt;%</span> </span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">tract =</span> GEOID)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>filter: removed 146,112 rows (67%), 73,056 rows remaining</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>select: dropped 12 variables (NAME, total_popE, total_popM, total_pop_raceE, total_pop_raceM, …)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>left_join: added 6 columns (year, resp, canc, neuro, state, …)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>           &gt; rows only in x       530</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>           &gt; rows only in y  (  9,582)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>           &gt; matched rows     217,576    (includes duplicates)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>           &gt;                 =========</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>           &gt; rows total       218,106</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>filter: removed 530 rows (&lt;1%), 217,576 rows remaining</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>rename: renamed one variable (tract)</code></pre>
</div>
</div>
<p>This leaves us with approximately 72,525 tracts per year (note 2014 has one additional tract). Looking at the removed tracts, these are all cases where the EPA did not have tract level information. Many of these have small population counts.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="fu">count</span>(enviro_all_clean, year)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>count: now 3 rows and 2 columns, ungrouped</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 x 2
  year      n
  &lt;chr&gt; &lt;int&gt;
1 2014  75720
2 2018  75719
3 2019  75719</code></pre>
</div>
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="fu">count</span>(enviro_all_tracts, year)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>count: now 3 rows and 2 columns, ungrouped</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 x 2
  year      n
  &lt;chr&gt; &lt;int&gt;
1 2014  72526
2 2018  72525
3 2019  72525</code></pre>
</div>
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anti_join</span>(acs_tracts, enviro_all_tracts, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span> <span class="ot">=</span> <span class="st">"tract"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(total_popE <span class="sc">!=</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>anti_join: added no columns</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>           &gt; rows only in x     1,594</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>           &gt; rows only in y  (      0)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>           &gt; matched rows    (217,574)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>           &gt;                 =========</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>           &gt; rows total         1,594</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>filter: removed 1,540 rows (97%), 54 rows remaining</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 54 x 13
   GEOID NAME  total_popE total_popM total_pop_raceE total_pop_raceM  wnhE  wnhM
   &lt;chr&gt; &lt;chr&gt;      &lt;dbl&gt;      &lt;dbl&gt;           &lt;dbl&gt;           &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
 1 0401~ Cens~       4291        471            4291             471  3052   597
 2 1312~ Cens~        196         72             196              72     0    13
 3 1703~ Cens~        434        335             434             335     0    11
 4 2207~ Cens~        480        387             480             387    70   112
 5 2502~ Cens~         67        105              67             105     0    12
 6 2603~ Cens~        157         81             157              81    51    36
 7 2608~ Cens~          3          3               3               3     2     2
 8 2804~ Cens~         86         48              86              48    17    18
 9 3401~ Cens~       1663        258            1663             258   494   115
10 3604~ Cens~         11         12              11              12     0    12
# i 44 more rows
# i 5 more variables: total_pop_povE &lt;dbl&gt;, total_pop_povM &lt;dbl&gt;,
#   povertyE &lt;dbl&gt;, povertyM &lt;dbl&gt;, year &lt;chr&gt;</code></pre>
</div>
</div>
<p>Confirm there are no non-tract level rows remaining.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>enviro_all_tracts <span class="sc">%&gt;%</span> </span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(tract_id <span class="sc">==</span> <span class="st">"000000"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(tract_id) <span class="sc">%&gt;%</span> </span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>filter: removed all rows (100%)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>group_by: one grouping variable (tract_id)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>count: now 0 rows and 2 columns, one group variable remaining (tract_id)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 0 x 2
# Groups:   tract_id [0]
# i 2 variables: tract_id &lt;chr&gt;, n &lt;int&gt;</code></pre>
</div>
</div>
</section>
<section id="create-airtox-metric" class="level2">
<h2 class="anchored" data-anchor-id="create-airtox-metric">Create AirTox Metric</h2>
<p>Create variables with the mean and standard deviation of each health metric for each year. This will be used in creating the indexed variable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>enviro_index_all <span class="ot">&lt;-</span> enviro_all_tracts <span class="sc">%&gt;%</span> </span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span> </span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">resp_mean =</span> <span class="fu">mean</span>(resp, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">canc_mean =</span> <span class="fu">mean</span>(canc, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb131-5"><a href="#cb131-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">neuro_mean =</span> <span class="fu">mean</span>(neuro, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb131-6"><a href="#cb131-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">resp_stdv =</span> <span class="fu">sd</span>(resp, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb131-7"><a href="#cb131-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">canc_stdv =</span> <span class="fu">sd</span>(canc, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb131-8"><a href="#cb131-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">neuro_stdv =</span> <span class="fu">sd</span>(neuro, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb131-9"><a href="#cb131-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>group_by: one grouping variable (year)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>mutate (grouped): new variable 'resp_mean' (double) with 3 unique values and 0% NA</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>                  new variable 'canc_mean' (double) with 3 unique values and 0% NA</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>                  new variable 'neuro_mean' (double) with 3 unique values and 0% NA</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>                  new variable 'resp_stdv' (double) with 3 unique values and 0% NA</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>                  new variable 'canc_stdv' (double) with 3 unique values and 0% NA</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>                  new variable 'neuro_stdv' (double) with 3 unique values and 0% NA</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>ungroup: no grouping variables</code></pre>
</div>
</div>
<p>Create the Environmental Health Indicator using the statistics calculated above. First calculate the components, which is the individual health indicator for a tract minus the mean of that indicator and divided by the standard deviation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a>enviro_index_all  <span class="ot">&lt;-</span> enviro_index_all  <span class="sc">%&gt;%</span></span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">resp_norm =</span> (resp <span class="sc">-</span> resp_mean)<span class="sc">/</span>resp_stdv,</span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">canc_norm =</span> (canc <span class="sc">-</span> canc_mean)<span class="sc">/</span>canc_stdv,</span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">neuro_norm =</span> (neuro <span class="sc">-</span> neuro_mean)<span class="sc">/</span>neuro_stdv)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>mutate: new variable 'resp_norm' (double) with 72,562 unique values and 0% NA</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>        new variable 'canc_norm' (double) with 72,561 unique values and 0% NA</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>        new variable 'neuro_norm' (double) with 72,600 unique values and 0% NA</code></pre>
</div>
</div>
<p>Add together the normalized results and multiple by negative 1 to create the index.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a>enviro_index_all  <span class="ot">&lt;-</span> enviro_index_all  <span class="sc">%&gt;%</span></span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">envhealth =</span> (resp_norm <span class="sc">+</span> canc_norm <span class="sc">+</span> neuro_norm)<span class="sc">*-</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>mutate: new variable 'envhealth' (double) with 73,660 unique values and 0% NA</code></pre>
</div>
</div>
<p>Percent rank the calculated value, again grouping by year.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a>enviro_index_all  <span class="ot">&lt;-</span> enviro_index_all  <span class="sc">%&gt;%</span></span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span> </span>
<span id="cb146-3"><a href="#cb146-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">index_air_hazard =</span> <span class="fu">round</span>(<span class="fu">percent_rank</span>(envhealth) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb146-4"><a href="#cb146-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>group_by: one grouping variable (year)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>mutate (grouped): new variable 'index_air_hazard' (double) with 101 unique values and 0% NA</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>ungroup: no grouping variables</code></pre>
</div>
</div>
<p>Keep only the tract and hazard index variable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a>haz_index_all <span class="ot">&lt;-</span> enviro_index_all  <span class="sc">%&gt;%</span> </span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(year, tract, index_air_hazard)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>select: dropped 15 variables (resp, canc, neuro, state, tract_id, …)</code></pre>
</div>
</div>
<p>Visualize the distribution to see how it looks. Note that 2018 and 2019 have slightly less even distributions due to the inclusion of 100ths in the EPA data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a>haz_index_all <span class="sc">%&gt;%</span> </span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">factor</span>(year)) <span class="sc">%&gt;%</span> </span>
<span id="cb152-3"><a href="#cb152-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> index_air_hazard, <span class="at">color =</span> year, <span class="at">fill =</span> year)) <span class="sc">+</span></span>
<span id="cb152-4"><a href="#cb152-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">adjust =</span> <span class="dv">4</span>, <span class="at">alpha =</span> <span class="fl">0.15</span>) <span class="sc">+</span></span>
<span id="cb152-5"><a href="#cb152-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb152-6"><a href="#cb152-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Tracts by air quality index, distriubtion"</span>) <span class="sc">+</span></span>
<span id="cb152-7"><a href="#cb152-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Density"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>mutate: converted 'year' from character to factor (0 new NA)</code></pre>
</div>
<div class="cell-output-display">
<p><img src="air_toxicity_metric_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<section id="subgroup-information" class="level3">
<h3 class="anchored" data-anchor-id="subgroup-information">Subgroup information</h3>
<p>The poverty total population is different in some cases from the total pop estimate from the race variable. The median difference is 15 and average difference is 108, though there are some large differences. It makes sense to use the total from the poverty variable as the denominator for the poverty indicator to avoid inflating or deflating results.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a>acs_tracts <span class="sc">%&gt;%</span> </span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">population_diff_race =</span> <span class="fu">abs</span>(total_popE <span class="sc">-</span> total_pop_raceE),</span>
<span id="cb154-3"><a href="#cb154-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">population_diff_pov =</span> <span class="fu">abs</span>(total_popE <span class="sc">-</span> total_pop_povE)) <span class="sc">%&gt;%</span> </span>
<span id="cb154-4"><a href="#cb154-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(population_diff_race)) <span class="sc">%&gt;%</span> </span>
<span id="cb154-5"><a href="#cb154-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(NAME, year, total_popE, total_pop_raceE, total_pop_povE, population_diff_race, population_diff_pov) <span class="sc">%&gt;%</span> </span>
<span id="cb154-6"><a href="#cb154-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>mutate: new variable 'population_diff_race' (double) with one unique value and 0% NA</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>        new variable 'population_diff_pov' (double) with 3,522 unique values and &lt;1% NA</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>select: dropped 8 variables (GEOID, total_popM, total_pop_raceM, wnhE, wnhM, …)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>     NAME               year             total_popE    total_pop_raceE
 Length:219168      Length:219168      Min.   :    0   Min.   :    0  
 Class :character   Class :character   1st Qu.: 2902   1st Qu.: 2902  
 Mode  :character   Mode  :character   Median : 4094   Median : 4094  
                                       Mean   : 4388   Mean   : 4388  
                                       3rd Qu.: 5503   3rd Qu.: 5503  
                                       Max.   :72041   Max.   :72041  
                                                                      
 total_pop_povE  population_diff_race population_diff_pov
 Min.   :    0   Min.   :0            Min.   :    0.0    
 1st Qu.: 2814   1st Qu.:0            1st Qu.:    0.0    
 Median : 3991   Median :0            Median :   15.0    
 Mean   : 4279   Mean   :0            Mean   :  108.7    
 3rd Qu.: 5384   3rd Qu.:0            3rd Qu.:   66.0    
 Max.   :71858   Max.   :0            Max.   :16694.0    
 NA's   :9                            NA's   :9          </code></pre>
</div>
</div>
<p>Use ACS data to create a variable for percent of each tract that are people of color and the percent in poverty. Remove the estimate indicator “E” from value names. The variable <code>total_pop</code> will be used for weighting census tracts as it is the most complete indicator of tract population.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a>acs_tracts <span class="ot">&lt;-</span> acs_tracts <span class="sc">%&gt;%</span></span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(year, <span class="at">geoid =</span> GEOID,</span>
<span id="cb159-3"><a href="#cb159-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">total_pop =</span> total_popE,</span>
<span id="cb159-4"><a href="#cb159-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">total_pop_race =</span> total_pop_raceE,</span>
<span id="cb159-5"><a href="#cb159-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">wnh =</span> wnhE,</span>
<span id="cb159-6"><a href="#cb159-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">total_pop_pov =</span> total_pop_povE, </span>
<span id="cb159-7"><a href="#cb159-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">poverty =</span> povertyE) <span class="sc">%&gt;%</span> </span>
<span id="cb159-8"><a href="#cb159-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">poc =</span> total_pop_race <span class="sc">-</span> wnh,</span>
<span id="cb159-9"><a href="#cb159-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">percent_poc =</span> poc<span class="sc">/</span>total_pop_race,</span>
<span id="cb159-10"><a href="#cb159-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">percent_pov =</span> poverty <span class="sc">/</span> total_pop_pov)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>select: renamed 6 variables (geoid, total_pop, total_pop_race, wnh, total_pop_pov, …) and dropped 6 variables</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>mutate: new variable 'poc' (double) with 8,999 unique values and 0% NA</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>        new variable 'percent_poc' (double) with 208,560 unique values and 1% NA</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>        new variable 'percent_pov' (double) with 201,675 unique values and 1% NA</code></pre>
</div>
</div>
<p>Create indicator variable for race based on percentage of poc/nh-White in each tract. These percentage cut offs were determined by Marge Turner. Also create indicator for tracts in ‘High Poverty’, with 40% or higher poverty rate meaning the tract has a high level of poverty</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a>race_pov <span class="ot">&lt;-</span> acs_tracts <span class="sc">%&gt;%</span></span>
<span id="cb164-2"><a href="#cb164-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb164-3"><a href="#cb164-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">race_ind =</span> <span class="fu">case_when</span>(</span>
<span id="cb164-4"><a href="#cb164-4" aria-hidden="true" tabindex="-1"></a>      percent_poc <span class="sc">&gt;</span> .<span class="dv">4</span> <span class="sc">&amp;</span> percent_poc <span class="sc">&lt;</span> .<span class="dv">6</span> <span class="sc">~</span><span class="st">"No Majority Race/Ethnicity"</span>,</span>
<span id="cb164-5"><a href="#cb164-5" aria-hidden="true" tabindex="-1"></a>      percent_poc <span class="sc">&gt;=</span> .<span class="dv">6</span> <span class="sc">~</span> <span class="st">"Majority Non-White"</span>,</span>
<span id="cb164-6"><a href="#cb164-6" aria-hidden="true" tabindex="-1"></a>      percent_poc <span class="sc">&lt;=</span> .<span class="dv">6</span> <span class="sc">~</span> <span class="st">"Majority White, Non-Hispanic"</span>), </span>
<span id="cb164-7"><a href="#cb164-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">poverty_type =</span> <span class="fu">case_when</span>(</span>
<span id="cb164-8"><a href="#cb164-8" aria-hidden="true" tabindex="-1"></a>      percent_pov <span class="sc">&lt;</span> .<span class="dv">4</span> <span class="sc">~</span> <span class="st">"Not Extreme Poverty"</span>,</span>
<span id="cb164-9"><a href="#cb164-9" aria-hidden="true" tabindex="-1"></a>      percent_pov <span class="sc">&gt;=</span>  .<span class="dv">4</span> <span class="sc">~</span> <span class="st">"Extreme Poverty"</span>)</span>
<span id="cb164-10"><a href="#cb164-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb164-11"><a href="#cb164-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(year, geoid, race_ind, poverty_type, total_pop)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>mutate: new variable 'race_ind' (character) with 4 unique values and 1% NA</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>        new variable 'poverty_type' (character) with 3 unique values and 1% NA</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>select: dropped 7 variables (total_pop_race, wnh, total_pop_pov, poverty, poc, …)</code></pre>
</div>
</div>
</section>
</section>
<section id="crosswalk-to-county" class="level2">
<h2 class="anchored" data-anchor-id="crosswalk-to-county">Crosswalk to County</h2>
<p>Crosswalk the individual years of data onto the UMF geographic crosswalk for counties file taken from the geographic-crosswalks folder. This will create a version of the data where all tracts that fall within counties used in the main UMF data set are present in the final data (regardless of missing EPA data). Note that the EPA did not change which counties are included between 2014, 2018 and 2019.</p>
<p>Read in county crosswalk and create tract level variable that combines state, county and tract IDs. To merge with AirTox index which includes 2014, 2018 and 2019, create a tract to county row for each year in the data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb168"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a>crosswalk_cnty <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"geographic-crosswalks/data"</span>, <span class="st">"tract-county-crosswalk_2018.csv"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb168-2"><a href="#cb168-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year1 =</span> <span class="st">"2019"</span>,</span>
<span id="cb168-3"><a href="#cb168-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">year2 =</span> <span class="st">"2018"</span>,</span>
<span id="cb168-4"><a href="#cb168-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">year3 =</span> <span class="st">"2014"</span>,</span>
<span id="cb168-5"><a href="#cb168-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">tract =</span> <span class="fu">paste0</span>(state, county, tract)) <span class="sc">%&gt;%</span> </span>
<span id="cb168-6"><a href="#cb168-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(tract, year1<span class="sc">:</span>year3) <span class="sc">%&gt;%</span> </span>
<span id="cb168-7"><a href="#cb168-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">!</span>tract, <span class="at">values_to =</span> <span class="st">"year"</span>, <span class="at">names_to =</span> <span class="st">"value"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb168-8"><a href="#cb168-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>value)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 73056 Columns: 4
-- Column specification --------------------------------------------------------
Delimiter: ","
chr (3): state, county, tract
dbl (1): year

i Use `spec()` to retrieve the full column specification for this data.
i Specify the column types or set `show_col_types = FALSE` to quiet this message.
mutate: changed 73,056 values (100%) of 'tract' (0 new NA)

        new variable 'year1' (character) with one unique value and 0% NA

        new variable 'year2' (character) with one unique value and 0% NA

        new variable 'year3' (character) with one unique value and 0% NA

select: dropped 3 variables (year, state, county)

pivot_longer: reorganized (year1, year2, year3) into (value, year) [was 73056x4, now 219168x3]

select: dropped one variable (value)</code></pre>
</div>
</div>
<p>Remove results form Puerto Rico and Virgin Islands.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb170"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a>haz_index_all <span class="ot">&lt;-</span> haz_index_all <span class="sc">%&gt;%</span></span>
<span id="cb170-2"><a href="#cb170-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(year, tract, index_air_hazard)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>select: no changes</code></pre>
</div>
</div>
<p>Merge the index data onto the country crosswalk file.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb172"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a>haz_index_crosswalk <span class="ot">&lt;-</span> crosswalk_cnty <span class="sc">%&gt;%</span> </span>
<span id="cb172-2"><a href="#cb172-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(haz_index_all, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"tract"</span>, <span class="st">"year"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>left_join: added one column (index_air_hazard)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>           &gt; rows only in x     1,592</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>           &gt; rows only in y  (      0)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>           &gt; matched rows     217,576</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>           &gt;                 =========</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>           &gt; rows total       219,168</code></pre>
</div>
</div>
<p>Looking at the missing tracts in the crosswalk file, the states with the most missing are very large and populous (Florida, Michigan, New York).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb179"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anti_join</span>(crosswalk_cnty, haz_index_all, <span class="at">by =</span> <span class="st">"tract"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb179-2"><a href="#cb179-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">state =</span> <span class="fu">str_sub</span>(tract, <span class="at">start =</span> <span class="dv">1</span>, <span class="at">end =</span> <span class="dv">2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb179-3"><a href="#cb179-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(state, year) <span class="sc">%&gt;%</span></span>
<span id="cb179-4"><a href="#cb179-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb179-5"><a href="#cb179-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>anti_join: added no columns</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>           &gt; rows only in x     1,590</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>           &gt; rows only in y  (      0)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>           &gt; matched rows    (217,578)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>           &gt;                 =========</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>           &gt; rows total         1,590</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>mutate: new variable 'state' (character) with 41 unique values and 0% NA</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>group_by: 2 grouping variables (state, year)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>count: now 123 rows and 3 columns, 2 group variables remaining (state, year)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 123 x 3
# Groups:   state, year [123]
   state year      n
   &lt;chr&gt; &lt;chr&gt; &lt;int&gt;
 1 12    2014     63
 2 12    2018     63
 3 12    2019     63
 4 26    2014     57
 5 26    2018     57
 6 26    2019     57
 7 36    2014     48
 8 36    2018     48
 9 36    2019     48
10 06    2014     34
# i 113 more rows</code></pre>
</div>
</div>
<p>Create state and county indicator for 2019 data</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb190"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a><span class="co">#split tract into state and county </span></span>
<span id="cb190-2"><a href="#cb190-2" aria-hidden="true" tabindex="-1"></a>haz_index_crosswalk <span class="ot">&lt;-</span> haz_index_crosswalk <span class="sc">%&gt;%</span></span>
<span id="cb190-3"><a href="#cb190-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">geoid =</span> <span class="fu">str_sub</span>(tract, <span class="at">start =</span> <span class="dv">1</span>, <span class="at">end =</span> <span class="dv">11</span>),</span>
<span id="cb190-4"><a href="#cb190-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">state =</span> <span class="fu">str_sub</span>(tract, <span class="at">start =</span> <span class="dv">1</span>, <span class="at">end =</span> <span class="dv">2</span>),</span>
<span id="cb190-5"><a href="#cb190-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">county =</span> <span class="fu">str_sub</span>(tract, <span class="at">start =</span> <span class="dv">3</span>, <span class="at">end =</span> <span class="dv">5</span>),</span>
<span id="cb190-6"><a href="#cb190-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">county_id =</span> <span class="fu">str_sub</span>(tract, <span class="at">start =</span> <span class="dv">1</span>, <span class="at">end =</span> <span class="dv">5</span>)</span>
<span id="cb190-7"><a href="#cb190-7" aria-hidden="true" tabindex="-1"></a>         )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>mutate: new variable 'geoid' (character) with 73,056 unique values and 0% NA</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>        new variable 'state' (character) with 51 unique values and 0% NA</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>        new variable 'county' (character) with 324 unique values and 0% NA</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>        new variable 'county_id' (character) with 3,142 unique values and 0% NA</code></pre>
</div>
</div>
</section>
<section id="create-aritox-index-metric-county" class="level2">
<h2 class="anchored" data-anchor-id="create-aritox-index-metric-county">Create AriTox Index Metric: County</h2>
<section id="all" class="level3">
<h3 class="anchored" data-anchor-id="all">All</h3>
<p>Join onto the environmental hazard index data. Calculate the total population for tracts where the index data is missing.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb195"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a>haz_index_acs <span class="ot">&lt;-</span> haz_index_crosswalk <span class="sc">%&gt;%</span> </span>
<span id="cb195-2"><a href="#cb195-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(race_pov, <span class="at">by=</span><span class="fu">c</span>(<span class="st">"geoid"</span>, <span class="st">"year"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb195-3"><a href="#cb195-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">na_pop=</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(index_air_hazard), total_pop, <span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>left_join: added 3 columns (race_ind, poverty_type, total_pop)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>           &gt; rows only in x         4</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>           &gt; rows only in y  (      4)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>           &gt; matched rows     219,164</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>           &gt;                 =========</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>           &gt; rows total       219,168</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>mutate: new variable 'na_pop' (double) with 46 unique values and 0% NA</code></pre>
</div>
</div>
<p>Calculate the average of county level hazard index for each year. Weight the mean by the total population inside each tract the value is coming from.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb203"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true" tabindex="-1"></a>haz_index_county_all <span class="ot">&lt;-</span> haz_index_acs <span class="sc">%&gt;%</span></span>
<span id="cb203-2"><a href="#cb203-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, county_id, state, county) <span class="sc">%&gt;%</span></span>
<span id="cb203-3"><a href="#cb203-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">index_air_hazard =</span> <span class="fu">weighted.mean</span>(index_air_hazard, total_pop, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb203-4"><a href="#cb203-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">na_pop =</span> <span class="fu">sum</span>(na_pop),</span>
<span id="cb203-5"><a href="#cb203-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">county_pop =</span> <span class="fu">sum</span>(total_pop)) <span class="sc">%&gt;%</span></span>
<span id="cb203-6"><a href="#cb203-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>group_by: 4 grouping variables (year, county_id, state, county)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>summarise: now 9,426 rows and 7 columns, 3 group variables remaining (year, county_id, state)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>ungroup: no grouping variables</code></pre>
</div>
</div>
<p>Calculate percent population of each county that has missing tract hazard information.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb207"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb207-1"><a href="#cb207-1" aria-hidden="true" tabindex="-1"></a>haz_index_county_all <span class="ot">&lt;-</span> haz_index_county_all <span class="sc">%&gt;%</span></span>
<span id="cb207-2"><a href="#cb207-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">na_perc =</span> na_pop <span class="sc">/</span> county_pop,</span>
<span id="cb207-3"><a href="#cb207-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">subgroup =</span> <span class="st">"All"</span>,</span>
<span id="cb207-4"><a href="#cb207-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">subgroup_type =</span> <span class="st">"all"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb207-5"><a href="#cb207-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(na_pop, county_pop)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>mutate: new variable 'na_perc' (double) with 51 unique values and &lt;1% NA</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>        new variable 'subgroup' (character) with one unique value and 0% NA</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>        new variable 'subgroup_type' (character) with one unique value and 0% NA</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>select: dropped 2 variables (na_pop, county_pop)</code></pre>
</div>
</div>
</section>
<section id="subgroups" class="level3">
<h3 class="anchored" data-anchor-id="subgroups">Subgroups</h3>
<p>Create an NA indicator counting population of tracts where either index air quality or poverty_type are missing.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb212"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb212-1"><a href="#cb212-1" aria-hidden="true" tabindex="-1"></a>haz_index_pov <span class="ot">&lt;-</span> haz_index_acs <span class="sc">%&gt;%</span> </span>
<span id="cb212-2"><a href="#cb212-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">na_pop =</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(index_air_hazard) <span class="sc">|</span> <span class="fu">is.na</span>(poverty_type), total_pop, <span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>mutate: changed 434 values (&lt;1%) of 'na_pop' (4 new NA)</code></pre>
</div>
</div>
<p>Calculate county/poverty type index using tract population as the weight. <em>Note</em> this is a change from the original version. The previous program weighted each tract by the count of individuals in poverty for high_poverty tracts and the county of individuals not in poverty in not_high_poverty tracts. This version considers the total population of the tracts and weights based on that.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb214"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb214-1"><a href="#cb214-1" aria-hidden="true" tabindex="-1"></a>haz_index_sub_poverty <span class="ot">&lt;-</span> haz_index_pov <span class="sc">%&gt;%</span> </span>
<span id="cb214-2"><a href="#cb214-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, county_id, state, county, poverty_type) <span class="sc">%&gt;%</span></span>
<span id="cb214-3"><a href="#cb214-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">index_air_hazard =</span> <span class="fu">weighted.mean</span>(index_air_hazard, total_pop, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb214-4"><a href="#cb214-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">na_pop =</span> <span class="fu">sum</span>(na_pop, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb214-5"><a href="#cb214-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">subgroup_pop =</span> <span class="fu">sum</span>(total_pop, <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span>
<span id="cb214-6"><a href="#cb214-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb214-7"><a href="#cb214-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()<span class="sc">%&gt;%</span></span>
<span id="cb214-8"><a href="#cb214-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">na_perc =</span> na_pop <span class="sc">/</span> subgroup_pop) <span class="sc">%&gt;%</span></span>
<span id="cb214-9"><a href="#cb214-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(na_pop, subgroup_pop)) <span class="sc">%&gt;%</span></span>
<span id="cb214-10"><a href="#cb214-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(poverty_type))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>group_by: 5 grouping variables (year, county_id, state, county, poverty_type)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>summarise: now 12,768 rows and 8 columns, 4 group variables remaining (year, county_id, state, county)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>ungroup: no grouping variables</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>mutate: new variable 'na_perc' (double) with 30 unique values and 8% NA</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>select: dropped 2 variables (na_pop, subgroup_pop)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>filter: removed 1,367 rows (11%), 11,401 rows remaining</code></pre>
</div>
</div>
<p>Expand data set for every county/poverty_type</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb221"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb221-1"><a href="#cb221-1" aria-hidden="true" tabindex="-1"></a>haz_index_county_pov_expand  <span class="ot">&lt;-</span> haz_index_acs  <span class="sc">%&gt;%</span></span>
<span id="cb221-2"><a href="#cb221-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand</span>(year, county_id, poverty_type)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Join dataset on expanded dataset, join with geo varibale, and add subgroup type variables</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb222"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb222-1"><a href="#cb222-1" aria-hidden="true" tabindex="-1"></a>haz_by_poverty <span class="ot">&lt;-</span> haz_index_county_pov_expand  <span class="sc">%&gt;%</span> </span>
<span id="cb222-2"><a href="#cb222-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(haz_index_sub_poverty <span class="sc">%&gt;%</span></span>
<span id="cb222-3"><a href="#cb222-3" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">select</span>(year, county_id, state, county, poverty_type, index_air_hazard, na_perc),</span>
<span id="cb222-4"><a href="#cb222-4" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">by=</span><span class="fu">c</span>(<span class="st">"year"</span>, </span>
<span id="cb222-5"><a href="#cb222-5" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">"county_id"</span>,</span>
<span id="cb222-6"><a href="#cb222-6" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">"poverty_type"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb222-7"><a href="#cb222-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">subgroup =</span> poverty_type) <span class="sc">%&gt;%</span></span>
<span id="cb222-8"><a href="#cb222-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">subgroup_type =</span> <span class="st">"poverty"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb222-9"><a href="#cb222-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(subgroup)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>select: no changes</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>left_join: added 4 columns (state, county, index_air_hazard, na_perc)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>           &gt; rows only in x   16,877</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>           &gt; rows only in y  (     0)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>           &gt; matched rows     11,401</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>           &gt;                 ========</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>           &gt; rows total       28,278</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>rename: renamed one variable (subgroup)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>mutate: new variable 'subgroup_type' (character) with one unique value and 0% NA</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>filter: removed 9,426 rows (33%), 18,852 rows remaining</code></pre>
</div>
</div>
</section>
<section id="neighborhood-racial-majority" class="level3">
<h3 class="anchored" data-anchor-id="neighborhood-racial-majority">Neighborhood racial majority</h3>
<p>Create neighborhood racial majority weight.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb233"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb233-1"><a href="#cb233-1" aria-hidden="true" tabindex="-1"></a>haz_index_race <span class="ot">&lt;-</span> haz_index_acs <span class="sc">%&gt;%</span></span>
<span id="cb233-2"><a href="#cb233-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">na_pop =</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(index_air_hazard) <span class="sc">|</span> <span class="fu">is.na</span>(race_ind), total_pop, <span class="dv">0</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>mutate: changed 4 values (&lt;1%) of 'na_pop' (4 new NA)</code></pre>
</div>
</div>
<p>Calculate average county/race type index using tract population as the weight. <em>Note</em> this is a change from the original version. The previous program weighted each tract by the count of people of color for maj. POC tracts and the count of white individuals for not maj. white tracts. This version considers the total population of the tracts and weights based on that.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb235"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb235-1"><a href="#cb235-1" aria-hidden="true" tabindex="-1"></a>haz_index_sub_race <span class="ot">&lt;-</span> haz_index_race <span class="sc">%&gt;%</span></span>
<span id="cb235-2"><a href="#cb235-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, county_id, state, county, race_ind) <span class="sc">%&gt;%</span></span>
<span id="cb235-3"><a href="#cb235-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">index_air_hazard =</span> <span class="fu">weighted.mean</span>(index_air_hazard, total_pop, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb235-4"><a href="#cb235-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">na_pop =</span> <span class="fu">sum</span>(na_pop, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb235-5"><a href="#cb235-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">subgroup_pop =</span> <span class="fu">sum</span>(total_pop, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb235-6"><a href="#cb235-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb235-7"><a href="#cb235-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb235-8"><a href="#cb235-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">na_perc =</span> na_pop <span class="sc">/</span> subgroup_pop) <span class="sc">%&gt;%</span></span>
<span id="cb235-9"><a href="#cb235-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(na_pop, subgroup_pop)) <span class="sc">%&gt;%</span></span>
<span id="cb235-10"><a href="#cb235-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(race_ind))  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>group_by: 5 grouping variables (year, county_id, state, county, race_ind)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>summarise: now 16,537 rows and 8 columns, 4 group variables remaining (year, county_id, state, county)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>ungroup: no grouping variables</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>mutate: new variable 'na_perc' (double) with 51 unique values and 7% NA</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>select: dropped 2 variables (na_pop, subgroup_pop)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>filter: removed 1,195 rows (7%), 15,342 rows remaining</code></pre>
</div>
</div>
<p>Expand dataset for every year, county and race/ethnicity tract designation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb242"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb242-1"><a href="#cb242-1" aria-hidden="true" tabindex="-1"></a>haz_index_county_sub_expand_race <span class="ot">&lt;-</span> haz_index_acs <span class="sc">%&gt;%</span></span>
<span id="cb242-2"><a href="#cb242-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand</span>(year, county_id, race_ind)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Join to expanded, add geo variables, and add subgroup variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb243"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb243-1"><a href="#cb243-1" aria-hidden="true" tabindex="-1"></a>haz_by_race <span class="ot">&lt;-</span> haz_index_county_sub_expand_race <span class="sc">%&gt;%</span> </span>
<span id="cb243-2"><a href="#cb243-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(haz_index_sub_race <span class="sc">%&gt;%</span></span>
<span id="cb243-3"><a href="#cb243-3" aria-hidden="true" tabindex="-1"></a>              <span class="fu">select</span>(year, county_id, state, county, race_ind, index_air_hazard, na_perc),</span>
<span id="cb243-4"><a href="#cb243-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">by=</span><span class="fu">c</span>(<span class="st">"year"</span>, <span class="st">"county_id"</span>, <span class="st">"race_ind"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb243-5"><a href="#cb243-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">subgroup =</span> race_ind) <span class="sc">%&gt;%</span></span>
<span id="cb243-6"><a href="#cb243-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">subgroup_type =</span> <span class="st">"race-ethnicity"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb243-7"><a href="#cb243-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(subgroup)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>select: no changes</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>left_join: added 4 columns (state, county, index_air_hazard, na_perc)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>           &gt; rows only in x   22,362</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>           &gt; rows only in y  (     0)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>           &gt; matched rows     15,342</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>           &gt;                 ========</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>           &gt; rows total       37,704</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>rename: renamed one variable (subgroup)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>mutate: new variable 'subgroup_type' (character) with one unique value and 0% NA</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>filter: removed 9,426 rows (25%), 28,278 rows remaining</code></pre>
</div>
</div>
</section>
<section id="clean-county-data" class="level3">
<h3 class="anchored" data-anchor-id="clean-county-data">Clean county data</h3>
<p>Append data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb254"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb254-1"><a href="#cb254-1" aria-hidden="true" tabindex="-1"></a>airtox_county_all <span class="ot">&lt;-</span> haz_index_county_all <span class="sc">%&gt;%</span> </span>
<span id="cb254-2"><a href="#cb254-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(haz_by_poverty) <span class="sc">%&gt;%</span></span>
<span id="cb254-3"><a href="#cb254-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(haz_by_race)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Match file to data standards</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb255"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb255-1"><a href="#cb255-1" aria-hidden="true" tabindex="-1"></a>final_data_county <span class="ot">&lt;-</span> airtox_county_all <span class="sc">%&gt;%</span></span>
<span id="cb255-2"><a href="#cb255-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">environmental_quality =</span> <span class="fu">if_else</span>(na_perc <span class="sc">&gt;=</span> .<span class="dv">05</span>,<span class="dv">2</span>,<span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb255-3"><a href="#cb255-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(year,</span>
<span id="cb255-4"><a href="#cb255-4" aria-hidden="true" tabindex="-1"></a>          state,</span>
<span id="cb255-5"><a href="#cb255-5" aria-hidden="true" tabindex="-1"></a>          county,</span>
<span id="cb255-6"><a href="#cb255-6" aria-hidden="true" tabindex="-1"></a>          subgroup_type,</span>
<span id="cb255-7"><a href="#cb255-7" aria-hidden="true" tabindex="-1"></a>          subgroup) <span class="sc">%&gt;%</span></span>
<span id="cb255-8"><a href="#cb255-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(year, state, county, subgroup_type, subgroup, index_air_hazard, environmental_quality) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>mutate: new variable 'environmental_quality' (double) with 3 unique values and 36% NA</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>select: dropped 2 variables (county_id, na_perc)</code></pre>
</div>
</div>
<p>Round environmental indicator to nearest integer</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb258"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb258-1"><a href="#cb258-1" aria-hidden="true" tabindex="-1"></a>final_data_county_sub  <span class="ot">&lt;-</span> final_data_county  <span class="sc">%&gt;%</span> </span>
<span id="cb258-2"><a href="#cb258-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">index_air_hazard =</span> <span class="fu">round</span>(index_air_hazard, <span class="at">digits =</span> <span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>mutate: changed 24,128 values (43%) of 'index_air_hazard' (0 new NA)</code></pre>
</div>
</div>
<p>Create all version of data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb260"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb260-1"><a href="#cb260-1" aria-hidden="true" tabindex="-1"></a>final_data_county_all <span class="ot">&lt;-</span> final_data_county_sub <span class="sc">%&gt;%</span></span>
<span id="cb260-2"><a href="#cb260-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(subgroup <span class="sc">==</span> <span class="st">"All"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>filter: removed 47,130 rows (83%), 9,426 rows remaining</code></pre>
</div>
</div>
</section>
</section>
<section id="crosswalk-place" class="level2">
<h2 class="anchored" data-anchor-id="crosswalk-place">Crosswalk place</h2>
<p>Crosswalk the individual years of data onto the UMF geographic tract crosswalk for places file taken from the geographic-crosswalks folder. This will create a version of the data where all tracts that fall within places used in the main UMF data set are present in the final data (regardless of missing EPA data). Note that the EPA did not change which counties are included between 2014, 2018 and 2019.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb262"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb262-1"><a href="#cb262-1" aria-hidden="true" tabindex="-1"></a>crosswalk_place <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"geographic-crosswalks"</span>, <span class="st">"data"</span>, <span class="st">"geocorr2018_tract_to_place.csv"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb262-2"><a href="#cb262-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">county =</span> <span class="fu">str_sub</span>(county, <span class="at">start =</span> <span class="sc">-</span>3L, <span class="at">end =</span> <span class="sc">-</span>1L),</span>
<span id="cb262-3"><a href="#cb262-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">state =</span> <span class="fu">str_pad</span>(state, <span class="dv">2</span>, <span class="at">side =</span> <span class="st">"left"</span>, <span class="at">pad =</span> <span class="st">"0"</span>),</span>
<span id="cb262-4"><a href="#cb262-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">tract =</span> tract <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb262-5"><a href="#cb262-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">tract =</span> <span class="fu">str_pad</span>(tract, <span class="dv">6</span>, <span class="at">side =</span> <span class="st">"left"</span>, <span class="at">pad =</span> <span class="st">"0"</span>),</span>
<span id="cb262-6"><a href="#cb262-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">tract =</span> <span class="fu">paste0</span>(state, county, tract),</span>
<span id="cb262-7"><a href="#cb262-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">year1 =</span> <span class="st">"2019"</span>,</span>
<span id="cb262-8"><a href="#cb262-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">year2 =</span> <span class="st">"2018"</span>,</span>
<span id="cb262-9"><a href="#cb262-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">year3 =</span> <span class="st">"2014"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb262-10"><a href="#cb262-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">place =</span> placefp, tract, afact,  year1<span class="sc">:</span>year3) <span class="sc">%&gt;%</span> </span>
<span id="cb262-11"><a href="#cb262-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">!</span><span class="fu">c</span>(place, tract, afact), <span class="at">values_to =</span> <span class="st">"year"</span>, <span class="at">names_to =</span> <span class="st">"value"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb262-12"><a href="#cb262-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>value)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 123633 Columns: 9
-- Column specification --------------------------------------------------------
Delimiter: ","
chr (3): stab, cntyname, placenm
dbl (6): county, tract, state, placefp, pop10, afact

i Use `spec()` to retrieve the full column specification for this data.
i Specify the column types or set `show_col_types = FALSE` to quiet this message.
mutate: converted 'county' from double to character (0 new NA)

        converted 'tract' from double to character (0 new NA)

        converted 'state' from double to character (0 new NA)

        new variable 'year1' (character) with one unique value and 0% NA

        new variable 'year2' (character) with one unique value and 0% NA

        new variable 'year3' (character) with one unique value and 0% NA

select: renamed one variable (place) and dropped 6 variables

pivot_longer: reorganized (year1, year2, year3) into (value, year) [was 123633x6, now 370899x5]

select: dropped one variable (value)</code></pre>
</div>
</div>
<p>Pad the place variable with a leading zero.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb264"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb264-1"><a href="#cb264-1" aria-hidden="true" tabindex="-1"></a>crosswalk_place <span class="ot">&lt;-</span> crosswalk_place <span class="sc">%&gt;%</span> </span>
<span id="cb264-2"><a href="#cb264-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">place =</span> <span class="fu">str_pad</span>(place, <span class="dv">5</span>, <span class="at">side =</span> <span class="st">"left"</span>, <span class="at">pad =</span> <span class="st">"0"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb264-3"><a href="#cb264-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(year, place, tract, afact)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>mutate: converted 'place' from double to character (0 new NA)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>select: columns reordered (year, place, tract, afact)</code></pre>
</div>
</div>
<p>Merge the environmental index ACS data onto the city crosswalk file.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb267"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb267-1"><a href="#cb267-1" aria-hidden="true" tabindex="-1"></a>tract_place_hazard <span class="ot">&lt;-</span> crosswalk_place <span class="sc">%&gt;%</span> </span>
<span id="cb267-2"><a href="#cb267-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(haz_index_all, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"year"</span>, <span class="st">"tract"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb267-3"><a href="#cb267-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">place =</span> <span class="fu">as.character</span>(place),</span>
<span id="cb267-4"><a href="#cb267-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">state =</span> <span class="fu">str_sub</span>(tract, <span class="dv">1</span>, <span class="dv">2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb267-5"><a href="#cb267-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">place_id =</span> <span class="fu">str_c</span>(state, place))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>left_join: added one column (index_air_hazard)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>           &gt; rows only in x       137</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>           &gt; rows only in y  (     63)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>           &gt; matched rows     370,762</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>           &gt;                 =========</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>           &gt; rows total       370,899</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>mutate: new variable 'state' (character) with 51 unique values and 0% NA</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>mutate: new variable 'place_id' (character) with 29,291 unique values and 0% NA</code></pre>
</div>
<div class="sourceCode cell-code" id="cb276"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb276-1"><a href="#cb276-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anti_join</span>(crosswalk_place, haz_index_all, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"year"</span>, <span class="st">"tract"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb276-2"><a href="#cb276-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">state =</span> <span class="fu">str_sub</span>(tract, <span class="at">start =</span> <span class="dv">1</span>, <span class="at">end =</span> <span class="dv">2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb276-3"><a href="#cb276-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(state, year) <span class="sc">%&gt;%</span></span>
<span id="cb276-4"><a href="#cb276-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb276-5"><a href="#cb276-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>anti_join: added no columns</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>           &gt; rows only in x       137</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>           &gt; rows only in y  (     63)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>           &gt; matched rows    (370,762)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>           &gt;                 =========</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>           &gt; rows total           137</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>mutate: new variable 'state' (character) with 7 unique values and 0% NA</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>group_by: 2 grouping variables (state, year)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>count: now 21 rows and 3 columns, 2 group variables remaining (state, year)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 21 x 3
# Groups:   state, year [21]
   state year      n
   &lt;chr&gt; &lt;chr&gt; &lt;int&gt;
 1 36    2014     23
 2 36    2018     23
 3 36    2019     23
 4 04    2014     15
 5 04    2018     15
 6 04    2019     15
 7 06    2018      3
 8 06    2019      3
 9 06    2014      2
10 28    2014      2
# i 11 more rows</code></pre>
</div>
</div>
<p>Merge on ACS information.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb287"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb287-1"><a href="#cb287-1" aria-hidden="true" tabindex="-1"></a>haz_index_acs <span class="ot">&lt;-</span> tract_place_hazard <span class="sc">%&gt;%</span> </span>
<span id="cb287-2"><a href="#cb287-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(race_pov, <span class="at">by=</span><span class="fu">c</span>(<span class="st">"tract"</span> <span class="ot">=</span> <span class="st">"geoid"</span>, <span class="st">"year"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb287-3"><a href="#cb287-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">na_pop=</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(index_air_hazard), total_pop, <span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>left_join: added 3 columns (race_ind, poverty_type, total_pop)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>           &gt; rows only in x       146</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>           &gt; rows only in y  (  1,642)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>           &gt; matched rows     370,753</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>           &gt;                 =========</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>           &gt; rows total       370,899</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>mutate: new variable 'na_pop' (double) with 6 unique values and &lt;1% NA</code></pre>
</div>
</div>
</section>
<section id="create-place-level-index" class="level2">
<h2 class="anchored" data-anchor-id="create-place-level-index">Create place level index</h2>
<p>Import places/pop file and prep to limit to population cutoff places.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb295"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb295-1"><a href="#cb295-1" aria-hidden="true" tabindex="-1"></a>state_place_pop <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"geographic-crosswalks"</span>, <span class="st">"data"</span>, <span class="st">"place-populations.csv"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb295-2"><a href="#cb295-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">place_id =</span> <span class="fu">paste0</span>(state, place))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 3400 Columns: 6
-- Column specification --------------------------------------------------------
Delimiter: ","
chr (4): state, place, state_name, place_name
dbl (2): year, population

i Use `spec()` to retrieve the full column specification for this data.
i Specify the column types or set `show_col_types = FALSE` to quiet this message.
mutate: new variable 'place_id' (character) with 486 unique values and 0% NA</code></pre>
</div>
</div>
<p>Create “All” observations calculate place population for tracts and index_air_hazard weighting by amount of tract in place and tract total population</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb297"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb297-1"><a href="#cb297-1" aria-hidden="true" tabindex="-1"></a>all_enviro_place <span class="ot">&lt;-</span> haz_index_acs <span class="sc">%&gt;%</span></span>
<span id="cb297-2"><a href="#cb297-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tract_pop =</span> (total_pop<span class="sc">*</span>afact)) <span class="sc">%&gt;%</span> <span class="co">#to account for the fact that only part of the tract population is in the place</span></span>
<span id="cb297-3"><a href="#cb297-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, place_id, state, place) <span class="sc">%&gt;%</span></span>
<span id="cb297-4"><a href="#cb297-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">index_air_hazard =</span> <span class="fu">weighted.mean</span>(index_air_hazard, tract_pop, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb297-5"><a href="#cb297-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">na_pop =</span> <span class="fu">sum</span>(na_pop <span class="sc">*</span> afact),</span>
<span id="cb297-6"><a href="#cb297-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">place_pop =</span> <span class="fu">sum</span>(tract_pop <span class="sc">*</span> afact)) <span class="sc">%&gt;%</span> </span>
<span id="cb297-7"><a href="#cb297-7" aria-hidden="true" tabindex="-1"></a>        <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>mutate: new variable 'tract_pop' (double) with 251,876 unique values and &lt;1% NA</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>group_by: 4 grouping variables (year, place_id, state, place)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>summarise: now 87,873 rows and 7 columns, 3 group variables remaining (year, place_id, state)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>ungroup: no grouping variables</code></pre>
</div>
</div>
<p>Add a variable with percent of population missing for each place</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb302"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb302-1"><a href="#cb302-1" aria-hidden="true" tabindex="-1"></a>all_enviro_place <span class="ot">&lt;-</span> all_enviro_place <span class="sc">%&gt;%</span></span>
<span id="cb302-2"><a href="#cb302-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">na_perc =</span> na_pop <span class="sc">/</span> place_pop,</span>
<span id="cb302-3"><a href="#cb302-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">subgroup =</span> <span class="st">"All"</span>,</span>
<span id="cb302-4"><a href="#cb302-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">subgroup_type =</span> <span class="st">"all"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb302-5"><a href="#cb302-5" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(na_pop, place_pop))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>mutate: new variable 'na_perc' (double) with 7 unique values and &lt;1% NA</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>        new variable 'subgroup' (character) with one unique value and 0% NA</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>        new variable 'subgroup_type' (character) with one unique value and 0% NA</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>select: dropped 2 variables (na_pop, place_pop)</code></pre>
</div>
</div>
<section id="poverty-level" class="level3">
<h3 class="anchored" data-anchor-id="poverty-level">Poverty level</h3>
<p>Create place level weighted index by poverty level.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb307"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb307-1"><a href="#cb307-1" aria-hidden="true" tabindex="-1"></a>hazard_place_pov <span class="ot">&lt;-</span> haz_index_acs <span class="sc">%&gt;%</span></span>
<span id="cb307-2"><a href="#cb307-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">na_pop =</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(index_air_hazard) <span class="sc">|</span> <span class="fu">is.na</span>(poverty_type), total_pop, <span class="dv">0</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>mutate: changed 529 values (&lt;1%) of 'na_pop' (26 new NA)</code></pre>
</div>
</div>
<p>Create the index in each place by the poverty type subgroup.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb309"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb309-1"><a href="#cb309-1" aria-hidden="true" tabindex="-1"></a>hazard_place_sub_pov <span class="ot">&lt;-</span> hazard_place_pov <span class="sc">%&gt;%</span></span>
<span id="cb309-2"><a href="#cb309-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, place_id, state, place, poverty_type) <span class="sc">%&gt;%</span></span>
<span id="cb309-3"><a href="#cb309-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">index_air_hazard =</span> <span class="fu">weighted.mean</span>(index_air_hazard, total_pop<span class="sc">*</span>afact, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="co">#Multiplied weight by % in Tract</span></span>
<span id="cb309-4"><a href="#cb309-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">na_pop =</span> <span class="fu">sum</span>(na_pop<span class="sc">*</span>afact, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb309-5"><a href="#cb309-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">subgroup_pop =</span> <span class="fu">sum</span>(total_pop<span class="sc">*</span>afact, <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span>
<span id="cb309-6"><a href="#cb309-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb309-7"><a href="#cb309-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()<span class="sc">%&gt;%</span></span>
<span id="cb309-8"><a href="#cb309-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">na_perc =</span> na_pop <span class="sc">/</span> subgroup_pop) <span class="sc">%&gt;%</span></span>
<span id="cb309-9"><a href="#cb309-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(na_pop, subgroup_pop))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>group_by: 5 grouping variables (year, place_id, state, place, poverty_type)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>summarise: now 91,299 rows and 8 columns, 4 group variables remaining (year, place_id, state, place)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>ungroup: no grouping variables</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>mutate: new variable 'na_perc' (double) with 4 unique values and &lt;1% NA</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>select: dropped 2 variables (na_pop, subgroup_pop)</code></pre>
</div>
</div>
<p>Expand poverty/place data set for every place and poverty type</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb315"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb315-1"><a href="#cb315-1" aria-hidden="true" tabindex="-1"></a>hazard_place_pov_expand <span class="ot">&lt;-</span> haz_index_acs  <span class="sc">%&gt;%</span></span>
<span id="cb315-2"><a href="#cb315-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand</span>(year, place_id, poverty_type)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Join poverty data set.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb316"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb316-1"><a href="#cb316-1" aria-hidden="true" tabindex="-1"></a>hazard_by_pov_sub_place <span class="ot">&lt;-</span> hazard_place_pov_expand <span class="sc">%&gt;%</span> </span>
<span id="cb316-2"><a href="#cb316-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(hazard_place_sub_pov <span class="sc">%&gt;%</span></span>
<span id="cb316-3"><a href="#cb316-3" aria-hidden="true" tabindex="-1"></a>              <span class="fu">select</span>(year, place_id, poverty_type, index_air_hazard, na_perc),</span>
<span id="cb316-4"><a href="#cb316-4" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">by=</span><span class="fu">c</span>(<span class="st">"year"</span>,</span>
<span id="cb316-5"><a href="#cb316-5" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">"place_id"</span>,</span>
<span id="cb316-6"><a href="#cb316-6" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">"poverty_type"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb316-7"><a href="#cb316-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">subgroup =</span> poverty_type) <span class="sc">%&gt;%</span></span>
<span id="cb316-8"><a href="#cb316-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">subgroup_type =</span> <span class="st">"poverty"</span>,</span>
<span id="cb316-9"><a href="#cb316-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">state =</span> <span class="fu">str_sub</span>(place_id, <span class="dv">1</span>, <span class="dv">2</span>),</span>
<span id="cb316-10"><a href="#cb316-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">place =</span> <span class="fu">str_sub</span>(place_id, <span class="dv">3</span>, <span class="dv">8</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb316-11"><a href="#cb316-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(subgroup))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>select: dropped 2 variables (state, place)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>left_join: added 2 columns (index_air_hazard, na_perc)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>           &gt; rows only in x   172,320</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>           &gt; rows only in y  (      0)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>           &gt; matched rows      91,299</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>           &gt;                 =========</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>           &gt; rows total       263,619</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>rename: renamed one variable (subgroup)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>mutate: new variable 'subgroup_type' (character) with one unique value and 0% NA</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>        new variable 'state' (character) with 51 unique values and 0% NA</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>        new variable 'place' (character) with 19,279 unique values and 0% NA</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>filter: removed 87,873 rows (33%), 175,746 rows remaining</code></pre>
</div>
</div>
</section>
<section id="neighborhood-race-status" class="level3">
<h3 class="anchored" data-anchor-id="neighborhood-race-status">Neighborhood race status</h3>
<p>Create place level count of missing population by race/ethnicity majority.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb329"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb329-1"><a href="#cb329-1" aria-hidden="true" tabindex="-1"></a>hazard_place_race <span class="ot">&lt;-</span> haz_index_acs <span class="sc">%&gt;%</span></span>
<span id="cb329-2"><a href="#cb329-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">na_pop =</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(index_air_hazard) <span class="sc">|</span> <span class="fu">is.na</span>(race_ind), total_pop, <span class="dv">0</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>mutate: changed 26 values (&lt;1%) of 'na_pop' (26 new NA)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb331"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb331-1"><a href="#cb331-1" aria-hidden="true" tabindex="-1"></a>hazard_place_sub_race <span class="ot">&lt;-</span> hazard_place_race <span class="sc">%&gt;%</span> </span>
<span id="cb331-2"><a href="#cb331-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, place_id, state, place, race_ind) <span class="sc">%&gt;%</span></span>
<span id="cb331-3"><a href="#cb331-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">index_air_hazard =</span> <span class="fu">weighted.mean</span>(index_air_hazard, total_pop<span class="sc">*</span>afact, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb331-4"><a href="#cb331-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">na_pop =</span> <span class="fu">sum</span>(na_pop<span class="sc">*</span>afact, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb331-5"><a href="#cb331-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">subgroup_pop =</span> <span class="fu">sum</span>(total_pop<span class="sc">*</span>afact, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb331-6"><a href="#cb331-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb331-7"><a href="#cb331-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb331-8"><a href="#cb331-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">na_perc =</span> na_pop <span class="sc">/</span> subgroup_pop) <span class="sc">%&gt;%</span>  </span>
<span id="cb331-9"><a href="#cb331-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(na_pop, subgroup_pop)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>group_by: 5 grouping variables (year, place_id, state, place, race_ind)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>summarise: now 101,675 rows and 8 columns, 4 group variables remaining (year, place_id, state, place)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>ungroup: no grouping variables</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>mutate: new variable 'na_perc' (double) with 6 unique values and &lt;1% NA</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>select: dropped 2 variables (na_pop, subgroup_pop)</code></pre>
</div>
</div>
<p>Expand data set for every place/race/ethnicity</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb337"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb337-1"><a href="#cb337-1" aria-hidden="true" tabindex="-1"></a>hazard_place_race_expand <span class="ot">&lt;-</span> haz_index_acs  <span class="sc">%&gt;%</span></span>
<span id="cb337-2"><a href="#cb337-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand</span>(year, place_id, race_ind)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Join to expanded, add GEO variables, and add subgroup variables</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb338"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb338-1"><a href="#cb338-1" aria-hidden="true" tabindex="-1"></a>hazard_by_race_sub_place <span class="ot">&lt;-</span> hazard_place_race_expand <span class="sc">%&gt;%</span> </span>
<span id="cb338-2"><a href="#cb338-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(hazard_place_sub_race <span class="sc">%&gt;%</span> </span>
<span id="cb338-3"><a href="#cb338-3" aria-hidden="true" tabindex="-1"></a>              <span class="fu">select</span>(year, place_id, race_ind, index_air_hazard, na_perc),</span>
<span id="cb338-4"><a href="#cb338-4" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">by=</span><span class="fu">c</span>(<span class="st">"year"</span>,</span>
<span id="cb338-5"><a href="#cb338-5" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">"place_id"</span>,</span>
<span id="cb338-6"><a href="#cb338-6" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">"race_ind"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb338-7"><a href="#cb338-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">subgroup =</span> race_ind) <span class="sc">%&gt;%</span></span>
<span id="cb338-8"><a href="#cb338-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">subgroup_type =</span> <span class="st">"race-ethnicity"</span>,</span>
<span id="cb338-9"><a href="#cb338-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">state =</span> <span class="fu">str_sub</span>(place_id, <span class="dv">1</span>, <span class="dv">2</span>),</span>
<span id="cb338-10"><a href="#cb338-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">place =</span> <span class="fu">str_sub</span>(place_id, <span class="dv">3</span>, <span class="dv">8</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb338-11"><a href="#cb338-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(subgroup))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>select: dropped 2 variables (state, place)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>left_join: added 2 columns (index_air_hazard, na_perc)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>           &gt; rows only in x   249,817</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>           &gt; rows only in y  (      0)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>           &gt; matched rows     101,675</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>           &gt;                 =========</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>           &gt; rows total       351,492</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>rename: renamed one variable (subgroup)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>mutate: new variable 'subgroup_type' (character) with one unique value and 0% NA</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>        new variable 'state' (character) with 51 unique values and 0% NA</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>        new variable 'place' (character) with 19,279 unique values and 0% NA</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>filter: removed 87,873 rows (25%), 263,619 rows remaining</code></pre>
</div>
</div>
</section>
<section id="clean-data-1" class="level3">
<h3 class="anchored" data-anchor-id="clean-data-1">Clean data</h3>
<p>Append data</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb351"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb351-1"><a href="#cb351-1" aria-hidden="true" tabindex="-1"></a>bind_data_place <span class="ot">&lt;-</span> all_enviro_place <span class="sc">%&gt;%</span></span>
<span id="cb351-2"><a href="#cb351-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(hazard_by_pov_sub_place) <span class="sc">%&gt;%</span></span>
<span id="cb351-3"><a href="#cb351-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(hazard_by_race_sub_place) <span class="sc">%&gt;%</span></span>
<span id="cb351-4"><a href="#cb351-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb351-5"><a href="#cb351-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">environmental_quality =</span> <span class="fu">if_else</span>(na_perc <span class="sc">&gt;=</span> .<span class="dv">05</span>,<span class="dv">2</span>,<span class="dv">1</span>)</span>
<span id="cb351-6"><a href="#cb351-6" aria-hidden="true" tabindex="-1"></a>          ) <span class="sc">%&gt;%</span></span>
<span id="cb351-7"><a href="#cb351-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>na_perc) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>mutate: new variable 'environmental_quality' (double) with 2 unique values and 47% NA</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>select: dropped one variable (na_perc)</code></pre>
</div>
</div>
<p>Keep only the places in the places_pop file (these are the places used in the UMF project).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb354"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb354-1"><a href="#cb354-1" aria-hidden="true" tabindex="-1"></a>final_data_place <span class="ot">&lt;-</span> bind_data_place <span class="sc">%&gt;%</span></span>
<span id="cb354-2"><a href="#cb354-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(place_id <span class="sc">%in%</span> state_place_pop<span class="sc">$</span>place_id) <span class="sc">%&gt;%</span></span>
<span id="cb354-3"><a href="#cb354-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(subgroup)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>filter: removed 518,544 rows (98%), 8,694 rows remaining</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>filter: no rows removed</code></pre>
</div>
</div>
<p>Select to match data structure</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb357"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb357-1"><a href="#cb357-1" aria-hidden="true" tabindex="-1"></a>final_data_place<span class="ot">&lt;-</span>  final_data_place <span class="sc">%&gt;%</span></span>
<span id="cb357-2"><a href="#cb357-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">arrange</span>(year,</span>
<span id="cb357-3"><a href="#cb357-3" aria-hidden="true" tabindex="-1"></a>          state,</span>
<span id="cb357-4"><a href="#cb357-4" aria-hidden="true" tabindex="-1"></a>          place,</span>
<span id="cb357-5"><a href="#cb357-5" aria-hidden="true" tabindex="-1"></a>          subgroup_type,</span>
<span id="cb357-6"><a href="#cb357-6" aria-hidden="true" tabindex="-1"></a>          subgroup)<span class="sc">%&gt;%</span></span>
<span id="cb357-7"><a href="#cb357-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(year, state, place, subgroup_type, subgroup, index_air_hazard, environmental_quality) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>select: dropped one variable (place_id)</code></pre>
</div>
</div>
<p>Round environmental indicator to nearest integer</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb359"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb359-1"><a href="#cb359-1" aria-hidden="true" tabindex="-1"></a>final_data_place <span class="ot">&lt;-</span> final_data_place <span class="sc">%&gt;%</span> </span>
<span id="cb359-2"><a href="#cb359-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">index_air_hazard =</span> <span class="fu">round</span>(index_air_hazard, <span class="at">digits =</span> <span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>mutate: changed 6,483 values (75%) of 'index_air_hazard' (0 new NA)</code></pre>
</div>
</div>
<p>Crate a file with just the all subgroup</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb361"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb361-1"><a href="#cb361-1" aria-hidden="true" tabindex="-1"></a>final_data_place_all <span class="ot">&lt;-</span> final_data_place <span class="sc">%&gt;%</span></span>
<span id="cb361-2"><a href="#cb361-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(subgroup <span class="sc">==</span> <span class="st">"All"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>filter: removed 7,245 rows (83%), 1,449 rows remaining</code></pre>
</div>
</div>
<p>#save files</p>
</section>
</section>
<section id="county" class="level2">
<h2 class="anchored" data-anchor-id="county">County</h2>
<p>Save county all and county subgroup data for 2019</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb363"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb363-1"><a href="#cb363-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(final_data_county_all, here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"06_neighborhoods"</span>, <span class="st">"environment"</span>, <span class="st">"data"</span>, <span class="st">"final"</span>, <span class="st">"environment_county_longitudinal.csv"</span>))</span>
<span id="cb363-2"><a href="#cb363-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(final_data_county_sub, here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"06_neighborhoods"</span>, <span class="st">"environment"</span>, <span class="st">"data"</span>, <span class="st">"final"</span>, <span class="st">"environment_county_race_poverty_longitudinal.csv"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="place" class="level2">
<h2 class="anchored" data-anchor-id="place">Place</h2>
<p>Save place all and place subgroup data for 2019</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb364"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb364-1"><a href="#cb364-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(final_data_place_all, here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"06_neighborhoods"</span>, <span class="st">"environment"</span>, <span class="st">"data"</span>, <span class="st">"final"</span>, <span class="st">"environment_place_longitudinal.csv"</span>))</span>
<span id="cb364-2"><a href="#cb364-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(final_data_place, here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"06_neighborhoods"</span>, <span class="st">"environment"</span>, <span class="st">"data"</span>, <span class="st">"final"</span>, <span class="st">"environment_place_race_poverty_longitudinal.csv"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>