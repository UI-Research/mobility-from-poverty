<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Vincent Pancini">
<meta name="dcterms.date" content="2025-03-11">

<title>Neonatal Health</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="neonatal-health-all_files/libs/clipboard/clipboard.min.js"></script>
<script src="neonatal-health-all_files/libs/quarto-html/quarto.js"></script>
<script src="neonatal-health-all_files/libs/quarto-html/popper.min.js"></script>
<script src="neonatal-health-all_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="neonatal-health-all_files/libs/quarto-html/anchor.min.js"></script>
<link href="neonatal-health-all_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="neonatal-health-all_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="neonatal-health-all_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="neonatal-health-all_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="neonatal-health-all_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Neonatal Health</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Vincent Pancini </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">March 11, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<style>
@import url('https://fonts.googleapis.com/css?family=Lato&display=swap');
</style>
<p><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato"></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen =</span> <span class="dv">999</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(urbnthemes)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidylog)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(testthat)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">set_urbn_defaults</span>(<span class="at">style =</span> <span class="st">"print"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="background-and-changes" class="level1">
<h1>1. Background and changes</h1>
<p>This section provides background for the data used to create this metric, changes from previous updates, and considerations for future updates.</p>
<section id="changes-from-last-update" class="level2">
<h2 class="anchored" data-anchor-id="changes-from-last-update">1.1 Changes from last update</h2>
<ul>
<li>The code for this metric was previously written in Stata. I’ve rewritten it in R and simplified it to be more streamlined and intuitive.</li>
<li>This update includes the latest year of data available (2023) as well as all years back to 2016.</li>
<li>In the last round of updates, the calculation of the quality value included counties with between [10, 29] low birthweight births as a criterion for a quality value of <code>2</code>. We removed that criterion in this round of updates.</li>
</ul>
</section>
<section id="background" class="level2">
<h2 class="anchored" data-anchor-id="background">1.2 Background</h2>
<p>The data for this metric are national natality data produced by the National Center for Health Statistics (NCHS) at the Centers for Disease Control and Prevention (CDC). We access these natality data through <a href="https://wonder.cdc.gov/natality.html">CDC WONDER</a>, an online system that makes CDC data available to the public.</p>
<p>We download two sets of births data from this source: all births and low birthweight births (under 2500 grams). To create the metric, we divide the number of low birthweight births by the total number of births to calculate the county-level share of low birthweight births. Additionally, we create this metric for 8 subgroups: 4 for race/ethnicity (Non-Hispanic white, Non-Hispanic Black, Hispanic, and Non-Hispanic other), and 4 for mother’s education (less than high school, high school graduate or GED, some college, and bachelor’s degree or greater). Therefore, each year requires 18 data extracts downloaded from CDC WONDER.</p>
</section>
<section id="considerations-for-future-updates" class="level2">
<h2 class="anchored" data-anchor-id="considerations-for-future-updates">1.3 Considerations for future updates</h2>
<ul>
<li>In the CDC WONDER data used for this metric, county-level data are shown for counties with populations of 100,000 persons or more. All counties with fewer than 100,000 persons are shown combined together under the label “Unidentified Counties” for the state. Historically, we just assign the aggregate values for “Unidentified Counties” in each state to the rest of the counties for each year (e.g., all of the unidentified counties are assigned the same value). Future updates may want to consider a more sophisticated imputation strategy that imputes based on the proportion of the county’s population to the state population or another imputation method to not double-count births. One strategy would be to:
<ul>
<li>Create a variable that is the total state population for each year by aggregating the county-level population values</li>
<li>Create a variable that is the share of the state’s population in each county by dividing county population/state population</li>
<li>Assign the “Unidentified Counties” values for all births and low birthweight births for each state/year to the Urban counties that do not have a match in the CDC WONDER natality data (e.g., the counties that are “Unidentified”) in the CDC WONDER data (this is a step we already take).</li>
<li>Multiply the counts of all birthweight births and low birthweight births by the county population share before constructing the rate</li>
</ul></li>
</ul>
<p>One challenge of this approach would be getting subgroup population denominators. I’m not sure if we can construct the education-level population denominators from the ACS.</p>
</section>
</section>
<section id="manually-download-natality-data-from-cdc-wonder" class="level1">
<h1>2. Manually download natality data from CDC WONDER</h1>
<p>This section explains the manual download process to create data extracts for these data from CDC WONDER.</p>
<p>There is an API available for CDC WONDER data. However, only national data are available for query by the API. Queries for natality statistics from the National Vital Statistics System cannot limit or group results by any location field such as county. Therefore, we must manually download the data.</p>
<p>The raw data used to create this metric are available to Urban Institute researchers on Box at <a href="https://urbanorg.box.com/s/iq9njfxchv937ij93vnndl2fnt6trm89">Data/Metrics_2025_round/04_health/neonatal-health/data</a>.</p>
<section id="navigate-to-extract-page" class="level2">
<h2 class="anchored" data-anchor-id="navigate-to-extract-page">2.1 Navigate to extract page</h2>
<ol type="1">
<li><p>Navigate to <a href="https://wonder.cdc.gov/">CDC WONDER</a> and select <a href="https://wonder.cdc.gov/natality.html">Births</a>.</p></li>
<li><p>Under “Current Final Natality Data” select <a href="https://wonder.cdc.gov/natality-current.html">Natality for 2007 - 2023</a>.</p></li>
<li><p>Select “I Agree” at the bottom of the page to agree to terms of data use.</p></li>
</ol>
</section>
<section id="create-extracts-for-all-births-in-each-year-no-subgroups" class="level2">
<h2 class="anchored" data-anchor-id="create-extracts-for-all-births-in-each-year-no-subgroups">2.2 Create extracts for all births in each year (no subgroups)</h2>
<ol type="1">
<li>Organize table layout:</li>
</ol>
<ul>
<li>Group Results By: County</li>
<li>Measures: Births</li>
<li>Title: “all_births_YYYY” where YYYY is the relevant year.</li>
</ul>
<ol start="2" type="1">
<li>Select maternal residence:</li>
</ol>
<ul>
<li>Keep default options</li>
</ul>
<p>2.a. Select urban classifications: + Keep default options</p>
<ol start="3" type="1">
<li>Select other maternal characteristics:</li>
</ol>
<ul>
<li>Keep default options</li>
</ul>
<ol start="4" type="1">
<li>Select birth characteristics:</li>
</ol>
<ul>
<li>Year: 2023 or relevant year (select only 1 year at a time)</li>
<li>Infant Birth Weight 12: Select all options except “All Weights” and “Unknown or Not Stated”</li>
<li>Keep other default options</li>
</ul>
<ol start="5" type="1">
<li>Select maternal risk factors:</li>
</ol>
<ul>
<li>Keep default options</li>
</ul>
<ol start="6" type="1">
<li>Other options:</li>
</ol>
<ul>
<li>Export Results</li>
<li>Show Totals</li>
<li>Show Zero Values</li>
<li>Show Suppressed Values</li>
<li>Precision: 2 decimal places</li>
<li>Data Access Timeout: 10 minutes</li>
</ul>
<p>After creating the extract to the above specifications: - Select <code>Send</code> at the bottom of the page to submit the extract. This will automatically download a <code>.txt</code> file titled <code>all_births_YYYY.txt</code> to your Downloads folder. This step should result in 1 data extract for each single year. - Move the <code>.txt</code> file from your Downloads folder to the <code>mobility-from-poverty\04_health\neonatal-health\data\all</code> directory.</p>
</section>
<section id="create-extracts-for-low-birthweight-births-in-each-year-no-subgroups" class="level2">
<h2 class="anchored" data-anchor-id="create-extracts-for-low-birthweight-births-in-each-year-no-subgroups">2.3 Create extracts for low birthweight births in each year (no subgroups)</h2>
<ol type="1">
<li>Organize table layout:</li>
</ol>
<ul>
<li>Group Results By: County</li>
<li>Measures: Births</li>
<li>Title: “lbw_births_YYYY” where YYYY is the relevant year.</li>
</ul>
<ol start="2" type="1">
<li>Select maternal residence:</li>
</ol>
<ul>
<li>Keep default options</li>
</ul>
<p>2.a. Select urban classifications: + Keep default options</p>
<ol start="3" type="1">
<li>Select other maternal characteristics:</li>
</ol>
<ul>
<li>Keep default options</li>
</ul>
<ol start="4" type="1">
<li>Select birth characteristics:</li>
</ol>
<ul>
<li>Year: 2023 or relevant year (select only 1 year at a time)</li>
<li>Infant Birth Weight 12: Select all options &lt;2500 grams (499 grams or less; 500 - 999 grams; 1000 - 1499 grams; 1500 - 1999 grams; 2000 - 2499 grams)</li>
<li>Keep other default options</li>
</ul>
<ol start="5" type="1">
<li>Select maternal risk factors:</li>
</ol>
<ul>
<li>Keep default options</li>
</ul>
<ol start="6" type="1">
<li>Other options:</li>
</ol>
<ul>
<li>Export Results</li>
<li>Show Totals</li>
<li>Show Zero Values</li>
<li>Show Suppressed Values</li>
<li>Precision: 2 decimal places</li>
<li>Data Access Timeout: 10 minutes</li>
</ul>
<p>After creating the extract to the above specifications: - Select <code>Send</code> at the bottom of the page to submit the extract. This will automatically download a <code>.txt</code> file titled <code>lbw_births_YYYY.txt</code> to your Downloads folder. This step should result in 1 data extract (2 total including the extract from the previous step) for each single year. - Move the <code>.txt</code> file from your Downloads folder to the <code>mobility-from-poverty\04_health\neonatal-health\data\all</code> directory.</p>
</section>
<section id="create-extracts-for-all-births-in-each-year-by-subgroup" class="level2">
<h2 class="anchored" data-anchor-id="create-extracts-for-all-births-in-each-year-by-subgroup">2.4 Create extracts for all births in each year by subgroup</h2>
<ol type="1">
<li>Organize table layout:</li>
</ol>
<ul>
<li>Group Results By: County</li>
<li>Measures: Births</li>
<li>Title: “all_births_subgrouptype_subgroup_YYYY” where YYYY is the relevant year, subgrouptype is race or momed, and subgroup is nhwhite, nhblack, hisp, nhother, lths, hs, somecol, or baplus</li>
</ul>
<ol start="2" type="1">
<li>Select maternal residence:</li>
</ol>
<ul>
<li>Keep default options</li>
</ul>
<p>2.a. Select urban classifications: + Keep default options</p>
<ol start="3" type="1">
<li>Select other maternal characteristics:</li>
</ol>
<ul>
<li>For the race/ethnicity subgroups, create four separate extracts based on the following specifications:
<ul>
<li>nhwhite
<ul>
<li>Mother’s Single Race: White</li>
<li>Mother’s Hispanic Origin: Not Hispanic or Latino</li>
</ul></li>
<li>nhblack
<ul>
<li>Mother’s Single Race: Black or African American</li>
<li>Mother’s Hispanic Origin: Not Hispanic or Latino</li>
</ul></li>
<li>hisp
<ul>
<li>Mother’s Single Race: All Races</li>
<li>Mother’s Hispanic Origin: Hispanic or Latino</li>
</ul></li>
<li>nhother
<ul>
<li>Mother’s Single Race: American Indian or Alaska Native; Asian; Native Hawaiian or Other Pacific Islander; More than one race</li>
<li>Mother’s Hispanic Origin: Not Hispanic or Latino</li>
</ul></li>
</ul></li>
<li>For the mother’s education subgroups, create four separate extracts based on the following specifications:
<ul>
<li>lths
<ul>
<li>Mother’s Education: 8th grade or less; 9th through 12th grade with no diploma</li>
</ul></li>
<li>hs
<ul>
<li>Mother’s Education: High school graduate or GED completed</li>
</ul></li>
<li>somecol
<ul>
<li>Mother’s Education: Some college credit, but not a degree; Associate degree (AA, AS)</li>
</ul></li>
<li>baplus
<ul>
<li>Mother’s Education: Bachelor’s degree (BA, AB, BS); Master’s degree (MA, MS, MEng, MEd, MSW, MBA); Doctorate (PhD, EdD) or Professional Degree (MD, DDS, DVM, LLB, JD)</li>
</ul></li>
</ul></li>
</ul>
<ol start="4" type="1">
<li>Select birth characteristics:</li>
</ol>
<ul>
<li>Year: 2023 or relevant year (select only 1 year at a time)</li>
<li>Infant Birth Weight 12: Select all options except “All Weights” and “Unknown or Not Stated”</li>
<li>Keep other default options</li>
</ul>
<ol start="5" type="1">
<li>Select maternal risk factors:</li>
</ol>
<ul>
<li>Keep default options</li>
</ul>
<ol start="6" type="1">
<li>Other options:</li>
</ol>
<ul>
<li>Export Results</li>
<li>Show Totals</li>
<li>Show Zero Values</li>
<li>Show Suppressed Values</li>
<li>Precision: 2 decimal places</li>
<li>Data Access Timeout: 10 minutes</li>
</ul>
<p>After creating the extract to the above specifications: - Select <code>Send</code> at the bottom of the page to submit the extract. This will automatically download a <code>.txt</code> file titled <code>all_births_subgrouptype_subgroup_YYYY.txt</code> to your Downloads folder. This step should result in 8 data extracts after repeated for each subgroup (10 total extracts including the extracts from the previous steps) for each single year. - Move the <code>.txt</code> files from your Downloads folder to the <code>mobility-from-poverty\04_health\neonatal-health\data\subgroups</code> directory.</p>
</section>
<section id="create-extracts-for-low-birthweight-births-in-each-year-by-subgroup" class="level2">
<h2 class="anchored" data-anchor-id="create-extracts-for-low-birthweight-births-in-each-year-by-subgroup">2.5 Create extracts for low birthweight births in each year by subgroup</h2>
<ol type="1">
<li>Organize table layout:</li>
</ol>
<ul>
<li>Group Results By: County</li>
<li>Measures: Births</li>
<li><ul>
<li>Title: “lbw_births_subgrouptype_subgroup_YYYY” where YYYY is the relevant year, subgrouptype is race or momed, and subgroup is nhwhite, nhblack, hisp, nhother, lths, hs, somecol, or baplus</li>
</ul></li>
</ul>
<ol start="2" type="1">
<li>Select maternal residence:</li>
</ol>
<ul>
<li>Keep default options</li>
</ul>
<p>2.a. Select urban classifications: + Keep default options</p>
<ol start="3" type="1">
<li>Select other maternal characteristics:</li>
</ol>
<ul>
<li>For the race/ethnicity subgroups, create four separate extracts based on the following specifications:
<ul>
<li>nhwhite
<ul>
<li>Mother’s Single Race: White</li>
<li>Mother’s Hispanic Origin: Not Hispanic or Latino</li>
</ul></li>
<li>nhblack
<ul>
<li>Mother’s Single Race: Black or African American</li>
<li>Mother’s Hispanic Origin: Not Hispanic or Latino</li>
</ul></li>
<li>hisp
<ul>
<li>Mother’s Single Race: All Races</li>
<li>Mother’s Hispanic Origin: Hispanic or Latino</li>
</ul></li>
<li>nhother
<ul>
<li>Mother’s Single Race: American Indian or Alaska Native; Asian; Native Hawaiian or Other Pacific Islander; More than one race</li>
<li>Mother’s Hispanic Origin: Not Hispanic or Latino</li>
</ul></li>
</ul></li>
<li>For the mother’s education subgroups, create four separate extracts based on the following specifications:
<ul>
<li>lths
<ul>
<li>Mother’s Education: 8th grade or less; 9th through 12th grade with no diploma</li>
</ul></li>
<li>hs
<ul>
<li>Mother’s Education: High school graduate or GED completed</li>
</ul></li>
<li>somecol
<ul>
<li>Mother’s Education: Some college credit, but not a degree; Associate degree (AA, AS)</li>
</ul></li>
<li>baplus
<ul>
<li>Mother’s Education: Bachelor’s degree (BA, AB, BS); Master’s degree (MA, MS, MEng, MEd, MSW, MBA); Doctorate (PhD, EdD) or Professional Degree (MD, DDS, DVM, LLB, JD)</li>
</ul></li>
</ul></li>
</ul>
<ol start="4" type="1">
<li>Select birth characteristics:</li>
</ol>
<ul>
<li>Year: 2023 or relevant year (select only 1 year at a time)</li>
<li>Infant Birth Weight 12: Select all options &lt;2500 grams (499 grams or less; 500 - 999 grams; 1000 - 1499 grams; 1500 - 1999 grams; 2000 - 2499 grams)</li>
<li>Keep other default options</li>
</ul>
<ol start="5" type="1">
<li>Select maternal risk factors:</li>
</ol>
<ul>
<li>Keep default options</li>
</ul>
<ol start="6" type="1">
<li>Other options:</li>
</ol>
<ul>
<li>Export Results</li>
<li>Show Totals</li>
<li>Show Zero Values</li>
<li>Show Suppressed Values</li>
<li>Precision: 2 decimal places</li>
<li>Data Access Timeout: 10 minutes</li>
</ul>
<p>After creating the extract to the above specifications: - Select <code>Send</code> at the bottom of the page to submit the extract. This will automatically download a <code>.txt</code> file titled <code>lbw_births_subgrouptype_subgroup_YYYY.txt</code> to your Downloads folder. This step should result in 8 data extracts after repeated for each subgroup (18 total extracts including the extracts from the previous steps) for each single year. - Move the <code>.txt</code> files from your Downloads folder to the <code>mobility-from-poverty\04_health\neonatal-health\data\subgroups</code> directory.</p>
</section>
</section>
<section id="import-clean-and-merge-cdc-wonder-files-all" class="level1">
<h1>3. Import, clean, and merge CDC WONDER files (All)</h1>
<section id="import-all-births-and-low-birthweight-births-no-subgroups" class="level2">
<h2 class="anchored" data-anchor-id="import-all-births-and-low-birthweight-births-no-subgroups">3.1 Import all births and low birthweight births (no subgroups)</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>paths <span class="ot">&lt;-</span> <span class="fu">list.files</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"04_health"</span>, <span class="st">"neonatal-health"</span>, <span class="st">"data"</span>, <span class="st">"all"</span>),</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">pattern =</span> <span class="st">"[.]txt$"</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>births_raw <span class="ot">&lt;-</span> paths <span class="sc">|&gt;</span> </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="fu">basename</span>(paths)) <span class="sc">|&gt;</span>  <span class="co"># Name elements of paths by their filenames</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_dfr</span>(</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="sc">~</span> utils<span class="sc">::</span><span class="fu">read.delim</span>(.x) <span class="sc">|&gt;</span> </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">Births =</span> <span class="fu">as.character</span>(Births)  <span class="co"># Convert Births to character for consistency</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">.id =</span> <span class="st">"filename"</span>  <span class="co"># Add the filename as a column</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">year =</span> <span class="fu">parse_number</span>(filename),  <span class="co"># Extract year from filename</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">birth_type =</span> <span class="fu">str_extract</span>(filename, <span class="st">"^(all|lbw)"</span>), <span class="co"># Extract subgroup from filename</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>.txt</code> files from CDC WONDER all have a <code>Notes</code> section at the bottom of the file with information about the data. We remove these rows by filtering out observations with missing county information.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>births_clean <span class="ot">&lt;-</span> births_raw <span class="sc">|&gt;</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">county_name =</span> County,</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">county_fips =</span> County.Code,</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">births =</span> Births,</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    year,</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    birth_type</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(county_fips))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="import-all-births-and-low-birthweight-births-for-subgroups-raceethnicity-and-mothers-education" class="level2">
<h2 class="anchored" data-anchor-id="import-all-births-and-low-birthweight-births-for-subgroups-raceethnicity-and-mothers-education">3.2 Import all births and low birthweight births for subgroups (race/ethnicity and mother’s education)</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>paths_subgroups <span class="ot">&lt;-</span> <span class="fu">list.files</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"04_health"</span>, <span class="st">"neonatal-health"</span>, <span class="st">"data"</span>, <span class="st">"subgroups"</span>),</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">pattern =</span> <span class="st">"[.]txt$"</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>births_subgroups_raw <span class="ot">&lt;-</span> paths_subgroups <span class="sc">|&gt;</span> </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="fu">basename</span>(paths_subgroups)) <span class="sc">|&gt;</span>  <span class="co"># Name elements of paths by their filenames</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map_dfr</span>(</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="sc">~</span> utils<span class="sc">::</span><span class="fu">read.delim</span>(.x) <span class="sc">|&gt;</span> </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">Births =</span> <span class="fu">as.character</span>(Births)  <span class="co"># Convert Births to character for consistency</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">.id =</span> <span class="st">"filename"</span>  <span class="co"># Add the filename as a column</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">year =</span> <span class="fu">parse_number</span>(filename),  <span class="co"># Extract year from filename</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">birth_type =</span> <span class="fu">str_extract</span>(filename, <span class="st">"^(all|lbw)"</span>),  <span class="co"># Extract subgroup from filename</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">subgroup_type =</span> <span class="fu">str_extract</span>(filename, <span class="st">"(race|momed)"</span>),</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">subgroup =</span> <span class="fu">case_when</span>(</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(filename, <span class="st">"nhwhite"</span>) <span class="sc">~</span> <span class="st">"nhwhite"</span>,</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(filename, <span class="st">"nhblack"</span>) <span class="sc">~</span> <span class="st">"nhblack"</span>,</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(filename, <span class="st">"hisp"</span>) <span class="sc">~</span> <span class="st">"hisp"</span>,</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(filename, <span class="st">"nhother"</span>) <span class="sc">~</span> <span class="st">"nhother"</span>,</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(filename, <span class="st">"lths"</span>) <span class="sc">~</span> <span class="st">"lths"</span>,</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(filename, <span class="st">"somecol"</span>) <span class="sc">~</span> <span class="st">"somecol"</span>,</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(filename, <span class="st">"baplus"</span>) <span class="sc">~</span> <span class="st">"baplus"</span>,</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(filename, <span class="st">"hs"</span>) <span class="sc">~</span> <span class="st">"hs"</span>,</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>.txt</code> files from CDC WONDER all have a <code>Notes</code> section at the bottom of the file with information about the data. We remove these rows by filtering out observations with missing county information.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>births_subgroups_clean <span class="ot">&lt;-</span> births_subgroups_raw <span class="sc">|&gt;</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">county_name =</span> County,</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">county_fips =</span> County.Code,</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">births =</span> Births,</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    year,</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    birth_type,</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    subgroup_type,</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    subgroup</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(county_fips))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="use-crosswalk-to-add-missing-counties-to-data" class="level1">
<h1>4. Use crosswalk to add missing counties to data</h1>
<p>todo(): The 2022 counties for Connecticut don’t match between the CDC WONDER data and Urban’s county population file.</p>
<section id="reshape-data-from-long-to-wide" class="level2">
<h2 class="anchored" data-anchor-id="reshape-data-from-long-to-wide">4.1 Reshape data from long to wide</h2>
<p>We want the subgroups (for race/ethnicity and mother’s education) for all births and low birthweight births to be wide, and for the data to only be long by county/year</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>births_wide <span class="ot">&lt;-</span> births_clean <span class="sc">|&gt;</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">id_cols =</span> <span class="fu">c</span>(year, county_name, county_fips),</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> birth_type,</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> births,</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_prefix =</span> <span class="st">"births_"</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>births_subgroups_wide <span class="ot">&lt;-</span> births_subgroups_clean <span class="sc">|&gt;</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>subgroup_type) <span class="sc">|&gt;</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">id_cols =</span> <span class="fu">c</span>(year, county_name, county_fips, subgroup),</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> birth_type,</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> births,</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_prefix =</span> <span class="st">"births_"</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">id_cols =</span> <span class="fu">c</span>(year, county_name, county_fips),</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> subgroup,</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_sep =</span> <span class="st">"_"</span>,</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> <span class="fu">c</span>(births_all, births_lbw)</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="join-births-data-together" class="level2">
<h2 class="anchored" data-anchor-id="join-births-data-together">4.2 Join births data together</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>master_births <span class="ot">&lt;-</span> tidylog<span class="sc">::</span><span class="fu">full_join</span>(</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> births_wide,</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> births_subgroups_wide,</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"year"</span>, <span class="st">"county_name"</span>, <span class="st">"county_fips"</span>)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>After 2013, births data for Cape May County, NJ (34009); Portsmouth city, VA (51740) were recoded to the “Unidentified Counties” category within the state, because these counties did not meet minimum population standards (<a href="https://wonder.cdc.gov/wonder/help/natality.html#">source</a>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>master_births <span class="sc">|&gt;</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(births_all <span class="sc">==</span> <span class="st">"Missing County"</span>) <span class="sc">|&gt;</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, county_fips)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 21
# Groups:   year, county_fips [12]
    year county_name         county_fips births_all births_lbw births_all_baplus
   &lt;dbl&gt; &lt;chr&gt;                     &lt;int&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;            
 1  2016 Cape May County, NJ       34009 Missing C… Missing C… Missing County   
 2  2016 Portsmouth city, VA       51740 Missing C… Missing C… Missing County   
 3  2017 Cape May County, NJ       34009 Missing C… Missing C… Missing County   
 4  2017 Portsmouth city, VA       51740 Missing C… Missing C… Missing County   
 5  2018 Cape May County, NJ       34009 Missing C… Missing C… Missing County   
 6  2018 Portsmouth city, VA       51740 Missing C… Missing C… Missing County   
 7  2019 Cape May County, NJ       34009 Missing C… Missing C… Missing County   
 8  2019 Portsmouth city, VA       51740 Missing C… Missing C… Missing County   
 9  2020 Cape May County, NJ       34009 Missing C… Missing C… Missing County   
10  2020 Portsmouth city, VA       51740 Missing C… Missing C… Missing County   
11  2021 Cape May County, NJ       34009 Missing C… Missing C… Missing County   
12  2021 Portsmouth city, VA       51740 Missing C… Missing C… Missing County   
# ℹ 15 more variables: births_all_hs &lt;chr&gt;, births_all_lths &lt;chr&gt;,
#   births_all_somecol &lt;chr&gt;, births_all_hisp &lt;chr&gt;, births_all_nhblack &lt;chr&gt;,
#   births_all_nhother &lt;chr&gt;, births_all_nhwhite &lt;chr&gt;,
#   births_lbw_baplus &lt;chr&gt;, births_lbw_hs &lt;chr&gt;, births_lbw_lths &lt;chr&gt;,
#   births_lbw_somecol &lt;chr&gt;, births_lbw_hisp &lt;chr&gt;, births_lbw_nhblack &lt;chr&gt;,
#   births_lbw_nhother &lt;chr&gt;, births_lbw_nhwhite &lt;chr&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>master_births <span class="ot">&lt;-</span> master_births <span class="sc">|&gt;</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>county_fips <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">34009</span>, <span class="dv">51740</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>master_births_clean <span class="ot">&lt;-</span> master_births <span class="sc">|&gt;</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">county_fips =</span> <span class="fu">str_pad</span>(<span class="fu">as.character</span>(county_fips),</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">width =</span> <span class="dv">5</span>,</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">side =</span> <span class="st">"left"</span>,</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>                          <span class="at">pad =</span> <span class="st">"0"</span>),</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">state =</span> <span class="fu">substr</span>(county_fips, <span class="dv">1</span>, <span class="dv">2</span>),</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">county =</span> <span class="fu">substr</span>(county_fips, <span class="dv">3</span>, <span class="dv">5</span>)</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(county_name, county_fips))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In the 2022 and 2023 CDC WONDER data, Connecticut’s outdated 8 counties are still used (09001, 09003, 09005, 09007, 09009, 09011, 09013, 09015), but in Urban’s universe of counties the updated 9 planning regions are used (09110, 09120, 09130, 09140, 09150, 09160, 09170, 09180, 09190). CDC WONDER intends to move to the updated planning regions in the future, so we leave these years as missing until that transition takes place.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>master_births_clean <span class="sc">|&gt;</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(state<span class="sc">==</span><span class="st">"09"</span>) <span class="sc">|&gt;</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(year, state, county)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 72 × 3
    year state county
   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
 1  2016 09    001   
 2  2016 09    003   
 3  2016 09    005   
 4  2016 09    007   
 5  2016 09    009   
 6  2016 09    011   
 7  2016 09    013   
 8  2016 09    015   
 9  2016 09    999   
10  2017 09    001   
# ℹ 62 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>master_births_clean <span class="ot">&lt;-</span> master_births_clean <span class="sc">|&gt;</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(state<span class="sc">==</span><span class="st">"09"</span> <span class="sc">&amp;</span> year <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2022</span>, <span class="dv">2023</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="bring-in-crosswalk-containing-all-counties-and-join-births" class="level2">
<h2 class="anchored" data-anchor-id="bring-in-crosswalk-containing-all-counties-and-join-births">4.3 Bring in crosswalk containing all counties and join births</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>urban_counties <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"geographic-crosswalks"</span>, <span class="st">"data"</span>, <span class="st">"county-populations.csv"</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year<span class="sc">&gt;=</span><span class="dv">2016</span>) <span class="sc">|&gt;</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(state_name, county_name))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>urban_counties_clean <span class="ot">&lt;-</span> urban_counties <span class="sc">|&gt;</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Remove CT counties in 2022 and 2023</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(state<span class="sc">==</span><span class="st">"09"</span> <span class="sc">&amp;</span> year <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2022</span>, <span class="dv">2023</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In the CDC WONDER births data, all counties with fewer than 100,000 persons are shown combined together under the label “Unidentified Counties” for the state. So, we expect a lot of unmatched observations. The code below shows that there should be 390 unmatched observations (unidentified counties) from the births data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>master_births_clean <span class="sc">|&gt;</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(county<span class="sc">==</span><span class="st">"999"</span>) <span class="sc">|&gt;</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
      n
  &lt;int&gt;
1   390</code></pre>
</div>
</div>
<p>Below, we check the total number of counties in the population file and the total number of counties in the births data for each year. This shows us that we should expect 20,516 observations in only the Urban county population file</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>urban_counties_clean <span class="sc">|&gt;</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">|&gt;</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 2
# Groups:   year [8]
   year     n
  &lt;dbl&gt; &lt;int&gt;
1  2016  3142
2  2017  3142
3  2018  3142
4  2019  3142
5  2020  3143
6  2021  3143
7  2022  3135
8  2023  3135</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>master_births_clean <span class="sc">|&gt;</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(county<span class="sc">!=</span><span class="st">"999"</span>) <span class="sc">|&gt;</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">|&gt;</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 2
# Groups:   year [8]
   year     n
  &lt;dbl&gt; &lt;int&gt;
1  2016   578
2  2017   578
3  2018   578
4  2019   578
5  2020   578
6  2021   578
7  2022   570
8  2023   570</code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Checking the total number of counties in each year and subtracting those that are included in the births data</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>((<span class="dv">3142-578</span>)<span class="sc">*</span><span class="dv">4</span>) <span class="sc">+</span> ((<span class="dv">3143-578</span>)<span class="sc">*</span><span class="dv">2</span>) <span class="sc">+</span> ((<span class="dv">3135-570</span>)<span class="sc">*</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 20516</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>county_births <span class="ot">&lt;-</span> tidylog<span class="sc">::</span><span class="fu">full_join</span>(</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> urban_counties_clean,</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> master_births_clean,</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"year"</span>, <span class="st">"state"</span>, <span class="st">"county"</span>)</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Reshape the data to be long again by subgroup</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>county_births_long <span class="ot">&lt;-</span> county_births <span class="sc">|&gt;</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="fu">c</span>(<span class="st">"births_"</span>)),</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">".value"</span>, <span class="st">"subgroup"</span>),</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_pattern =</span> <span class="st">"(births_[^_]+)_?([^_]*)"</span>,</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"births"</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">subgroup =</span> <span class="fu">if_else</span>(subgroup<span class="sc">==</span><span class="st">""</span>, <span class="st">"all"</span>, subgroup)</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="assign-unidentified-county-values-to-counties-with-missing-values" class="level1">
<h1>5. Assign “unidentified county” values to counties with missing values</h1>
<p>Counties with fewer than 100,000 persons are shown combined together under the label “Unidentified Counties” for the state (<a href="https://wonder.cdc.gov/wonder/help/natality.html">source</a>).</p>
<p>In the code below, we replace every value from the counties that did not have a match in the Urban counties universe (i.e., the counties that were combined under the label “Unidentified Counties” in the CDC WONDER births data) for each state and apply the values from the state’s “Unidentified Counties” observation. This means that a lot of counties within states will have the same observations. Future updates may want to consider a more sophisticated imputation method.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>county_births_clean <span class="ot">&lt;-</span> county_births_long <span class="sc">|&gt;</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">unidentified_all =</span> <span class="fu">ifelse</span>(county<span class="sc">==</span><span class="st">"999"</span>, births_all, <span class="cn">NA</span>),</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">unidentified_lbw =</span> <span class="fu">ifelse</span>(county<span class="sc">==</span><span class="st">"999"</span>, births_lbw, <span class="cn">NA</span>)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, state, subgroup) <span class="sc">|&gt;</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">state_unidentified_all =</span> <span class="fu">ifelse</span>(<span class="fu">any</span>(county <span class="sc">==</span> <span class="dv">999</span>),</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>                                       unidentified_all[county <span class="sc">==</span> <span class="dv">999</span>],</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>                                       <span class="cn">NA</span>),</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">births_all =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(births_all),</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>                           state_unidentified_all,</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>                           births_all),</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">state_unidentified_lbw =</span> <span class="fu">ifelse</span>(<span class="fu">any</span>(county <span class="sc">==</span> <span class="dv">999</span>), </span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>                                    unidentified_lbw[county <span class="sc">==</span> <span class="dv">999</span>], </span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>                                    <span class="cn">NA</span>),</span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">births_lbw =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(births_lbw), </span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>                        state_unidentified_lbw, </span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>                        births_lbw)</span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(unidentified_all, unidentified_lbw)) <span class="sc">|&gt;</span></span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>county <span class="sc">==</span> <span class="dv">999</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If the value for all births and low birthweight births match the state unidentified values, we know that the births data from that county were initially missing, so we create a flag to keep track of these counties. Because the “Unidentified Counties” label is based on total county population, it will apply to all births and lbw births, so we could generate the flag based on either/or of these variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Show that observations for each birth group are missing (i.e., "unidentified") when the other is missing</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="fu">is.na</span>(county_births_long<span class="sc">$</span>births_all) <span class="sc">==</span> <span class="fu">is.na</span>(county_births_long<span class="sc">$</span>births_lbw)))</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>county_births_clean <span class="ot">&lt;-</span> county_births_clean <span class="sc">|&gt;</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">unidentified_county =</span> <span class="fu">if_else</span>(</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>      births_all<span class="sc">==</span>state_unidentified_all <span class="sc">&amp;</span> births_lbw<span class="sc">==</span>state_unidentified_lbw, </span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>      <span class="dv">1</span>, </span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>      <span class="dv">0</span>)</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(state_unidentified_all, state_unidentified_lbw))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The unidentified_county flag is missing for Delaware and Washington, DC because these states did not have any unidentified county observations. We replace these with 0.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>county_births_clean <span class="sc">|&gt;</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(unidentified_county)) <span class="sc">|&gt;</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(state) <span class="sc">|&gt;</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
# Groups:   state [2]
  state     n
  &lt;chr&gt; &lt;int&gt;
1 10      216
2 11       72</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>county_births_clean <span class="ot">&lt;-</span> county_births_clean <span class="sc">|&gt;</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">unidentified_county =</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(unidentified_county), <span class="dv">0</span>, unidentified_county)</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Birth counts are marked “Suppressed” when the figure represents fewer than ten (1-9) births. We create a flag for these observations, because eventually we will have to change the values to missing, and we want to be explicit about the cause of their missingness being from data suppression.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>county_births_clean <span class="ot">&lt;-</span> county_births_clean <span class="sc">|&gt;</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Generate flag for suppressed values</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">suppressed_county =</span> <span class="fu">if_else</span>(</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>      births_all <span class="sc">==</span> <span class="st">"Suppressed"</span> <span class="sc">|</span> births_lbw <span class="sc">==</span> <span class="st">"Suppressed"</span>,</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>      <span class="dv">1</span>,</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>      <span class="dv">0</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">births_all =</span> <span class="fu">if_else</span>(births_all<span class="sc">==</span><span class="st">"Suppressed"</span>, <span class="cn">NA</span>, births_all),</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">births_lbw =</span> <span class="fu">if_else</span>(births_lbw<span class="sc">==</span><span class="st">"Suppressed"</span>, <span class="cn">NA</span>, births_lbw)</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(county_births_clean<span class="sc">$</span>births_all))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 187</code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(county_births_clean<span class="sc">$</span>births_lbw))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 7088</code></pre>
</div>
</div>
</section>
<section id="create-neonatal-health-share-low-birthweight-metric" class="level1">
<h1>6. Create neonatal health share low birthweight metric</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>county_births_clean <span class="ot">&lt;-</span> county_births_clean <span class="sc">|&gt;</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">births_all =</span> <span class="fu">as.numeric</span>(births_all),</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">births_lbw =</span> <span class="fu">as.numeric</span>(births_lbw)</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(county_births_clean<span class="sc">$</span>births_all))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 187</code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(county_births_clean<span class="sc">$</span>births_lbw))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 7088</code></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>lbw_rates <span class="ot">&lt;-</span> county_births_clean <span class="sc">|&gt;</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">rate_low_birth_weight =</span> births_lbw <span class="sc">/</span> births_all</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If the denominator (all births) is less than 30, we assign the value to be missing</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>lbw_rates <span class="ot">&lt;-</span> lbw_rates <span class="sc">|&gt;</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">rate_low_birth_weight =</span> <span class="fu">if_else</span>((births_all <span class="sc">&lt;</span> <span class="dv">30</span>), <span class="cn">NA</span>, rate_low_birth_weight)</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>lbw_rates <span class="sc">|&gt;</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">|&gt;</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">quantiles =</span> <span class="fu">list</span>(<span class="fu">quantile</span>(rate_low_birth_weight, </span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>                              <span class="at">probs =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.2</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>, <span class="fl">0.8</span>, <span class="fl">0.9</span>, <span class="fl">0.99</span>, <span class="dv">1</span>), </span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>                              <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(quantiles)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 9
   year   `0%`  `20%`  `40%`  `60%` `80%` `90%` `99%` `100%`
  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
1  2016 0      0.0660 0.0754 0.0859 0.103 0.120 0.159  0.323
2  2017 0      0.0668 0.0772 0.0870 0.102 0.125 0.159  0.333
3  2018 0      0.0677 0.0771 0.0861 0.104 0.126 0.167  0.355
4  2019 0      0.0678 0.0769 0.0859 0.103 0.124 0.170  0.25 
5  2020 0      0.0670 0.0769 0.0858 0.103 0.120 0.170  0.263
6  2021 0      0.0693 0.0797 0.0887 0.106 0.127 0.167  0.275
7  2022 0      0.0713 0.0807 0.0910 0.106 0.127 0.177  0.306
8  2023 0.0344 0.0708 0.0803 0.0884 0.108 0.132 0.174  0.263</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>lbw_rates <span class="sc">|&gt;</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(subgroup) <span class="sc">|&gt;</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">quantiles =</span> <span class="fu">list</span>(<span class="fu">quantile</span>(rate_low_birth_weight, </span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>                              <span class="at">probs =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.2</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>, <span class="fl">0.8</span>, <span class="fl">0.9</span>, <span class="fl">0.99</span>, <span class="dv">1</span>), </span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>                              <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(quantiles)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9 × 9
  subgroup   `0%`  `20%`  `40%`  `60%`  `80%`  `90%`  `99%` `100%`
  &lt;chr&gt;     &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
1 all      0.0375 0.0696 0.0782 0.0848 0.0965 0.102  0.125   0.162
2 baplus   0.0258 0.0545 0.0594 0.0641 0.0706 0.0777 0.0938  0.156
3 hisp     0      0.0667 0.0721 0.0778 0.0836 0.0886 0.111   0.25 
4 hs       0.0343 0.0788 0.0877 0.0965 0.109  0.115  0.145   0.192
5 lths     0      0.0819 0.0916 0.105  0.117  0.127  0.163   0.233
6 nhblack  0      0.119  0.142  0.150  0.161  0.167  0.196   0.355
7 nhother  0      0.0782 0.0873 0.0946 0.103  0.112  0.140   0.263
8 nhwhite  0.0269 0.0645 0.0717 0.0769 0.0828 0.0871 0.0980  0.126
9 somecol  0.0314 0.0682 0.0766 0.0819 0.0941 0.101  0.125   0.175</code></pre>
</div>
</div>
</section>
<section id="data-quality" class="level1">
<h1>7. Data Quality</h1>
<p>This section creates a variable to indicate the quality of the rate of low birthweight births. A value of <code>1</code> indicates a high-quality calculated metric for the observation, a value of <code>2</code> indicates medium-quality (limited issues with the calculated metric for the observation), and a value of <code>3</code> indicates low-quality (serious issues with the calculated metric for the observation).</p>
<p>In the last round of updates, the calculation of the quality value included counties with between [10, 29] low birthweight births as a criterion for a quality value of <code>2</code>. We removed that criterion in this round of updates.</p>
<p>We use the number and ratio of unidentified counties within each state in the construction of the quality values. We create these variables first before assigning quality values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>lbw_rates <span class="ot">&lt;-</span> lbw_rates <span class="sc">|&gt;</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(year, state, subgroup) <span class="sc">|&gt;</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">num_unidentified_counties =</span> <span class="fu">sum</span>(unidentified_county),</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">num_counties =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ratio =</span> num_unidentified_counties <span class="sc">/</span> num_counties)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The data quality value should be:</p>
<ul>
<li><p><code>NA</code> if the rate of low birthweight births is missing, OR if the denominator (<code>births_all</code>) is missing.</p></li>
<li><p><code>3</code> if the county was originally unidentified (counties with populations under 100,000 for which the metric reflects the pooled share low birthweight for all “Unidentified Counties” in the state and are not county-specific) or suppressed, OR if the denominator (<code>births_all</code>) is between [30, 100) (we want to indicate poor data quality for counties with small denominators).</p></li>
<li><p><code>2</code> if the number of unidentified counties in the state is between (0, 5) OR the percentage of unidentified counties in the state is less than 0.5 and the total number of counties is less than or equal to 15 OR the denominator (<code>births_all</code>) is between [100, 200)</p></li>
<li><p><code>1</code> if the county was not unidentified or suppressed OR the denominator (<code>births_all</code>) is greater than or equal to 200</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>lbw_rates <span class="ot">&lt;-</span> lbw_rates <span class="sc">|&gt;</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">quality3 =</span> <span class="fu">if_else</span>(</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>      unidentified_county<span class="sc">==</span><span class="dv">1</span> <span class="sc">|</span> births_all <span class="sc">&lt;</span><span class="dv">100</span> <span class="sc">&amp;</span> births_all<span class="sc">&gt;=</span><span class="dv">30</span> <span class="sc">|</span> suppressed_county<span class="sc">==</span><span class="dv">1</span>, </span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>      <span class="dv">1</span>, </span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>      <span class="dv">0</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>lbw_rates <span class="ot">&lt;-</span> lbw_rates <span class="sc">|&gt;</span></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">quality2 =</span> <span class="fu">if_else</span>(</span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>       births_all <span class="sc">&lt;</span> <span class="dv">200</span> <span class="sc">&amp;</span> births_all <span class="sc">&gt;=</span><span class="dv">100</span> <span class="sc">|</span></span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a>      num_unidentified_counties <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> num_unidentified_counties <span class="sc">&lt;</span> <span class="dv">5</span> <span class="sc">|</span></span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a>      num_counties <span class="sc">&lt;=</span> <span class="dv">15</span> <span class="sc">&amp;</span> ratio <span class="sc">&lt;</span> <span class="fl">0.5</span>,</span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a>      <span class="dv">1</span>, </span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a>      <span class="dv">0</span></span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true" tabindex="-1"></a>lbw_rates <span class="ot">&lt;-</span> lbw_rates <span class="sc">|&gt;</span></span>
<span id="cb50-22"><a href="#cb50-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb50-23"><a href="#cb50-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">quality1 =</span> <span class="fu">if_else</span>(</span>
<span id="cb50-24"><a href="#cb50-24" aria-hidden="true" tabindex="-1"></a>      births_all <span class="sc">&gt;=</span> <span class="dv">200</span> <span class="sc">|</span> unidentified_county<span class="sc">==</span><span class="dv">0</span> <span class="sc">&amp;</span> suppressed_county<span class="sc">==</span><span class="dv">0</span>,</span>
<span id="cb50-25"><a href="#cb50-25" aria-hidden="true" tabindex="-1"></a>      <span class="dv">1</span>, </span>
<span id="cb50-26"><a href="#cb50-26" aria-hidden="true" tabindex="-1"></a>      <span class="dv">0</span></span>
<span id="cb50-27"><a href="#cb50-27" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb50-28"><a href="#cb50-28" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb50-29"><a href="#cb50-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-30"><a href="#cb50-30" aria-hidden="true" tabindex="-1"></a>lbw_rates <span class="ot">&lt;-</span> lbw_rates <span class="sc">|&gt;</span></span>
<span id="cb50-31"><a href="#cb50-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb50-32"><a href="#cb50-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">qualityNA =</span> <span class="fu">if_else</span>(</span>
<span id="cb50-33"><a href="#cb50-33" aria-hidden="true" tabindex="-1"></a>      births_all <span class="sc">&lt;</span> <span class="dv">30</span> <span class="sc">|</span> <span class="fu">is.na</span>(rate_low_birth_weight),</span>
<span id="cb50-34"><a href="#cb50-34" aria-hidden="true" tabindex="-1"></a>      <span class="dv">1</span>, </span>
<span id="cb50-35"><a href="#cb50-35" aria-hidden="true" tabindex="-1"></a>      <span class="dv">0</span></span>
<span id="cb50-36"><a href="#cb50-36" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb50-37"><a href="#cb50-37" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Some of these criteria overlap, but we assign the quality values appropriately in the next code chunk.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>lbw_rates <span class="sc">|&gt;</span> </span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(quality1, quality2, quality3, qualityNA)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 14 × 5
   quality1 quality2 quality3 qualityNA      n
      &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;  &lt;int&gt;
 1        0        0        1         0    539
 2        0        0        1         1   5382
 3        0        1        1         0   1361
 4        0        1        1         1   1624
 5        1        0        0         0  30227
 6        1        0        0         1    100
 7        1        0        1         0 179510
 8        1        0        1         1     52
 9        1        1        0         0   6373
10        1        1        0         1     14
11        1        1        1         0    732
12        1        1        1         1     15
13       NA        1        1         1     59
14       NA       NA        1         1    128</code></pre>
</div>
</div>
<p>Construct the quality values based on the hierarchy of lowest quality to highest quality.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>lbw_rates <span class="ot">&lt;-</span> lbw_rates <span class="sc">|&gt;</span> </span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">rate_low_birth_weight_quality =</span> <span class="fu">case_when</span>(</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>      qualityNA<span class="sc">==</span><span class="dv">1</span> <span class="sc">~</span> <span class="cn">NA_real_</span>,</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>      quality3<span class="sc">==</span><span class="dv">1</span> <span class="sc">~</span> <span class="dv">3</span>,</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>      quality2<span class="sc">==</span><span class="dv">1</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>      quality1<span class="sc">==</span><span class="dv">1</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>      <span class="co"># A value to check if any of the observations don't meet any of our criteria</span></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="dv">9</span></span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Check quality values for non-subgroup rates</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>lbw_rates <span class="sc">|&gt;</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(subgroup <span class="sc">==</span> <span class="st">"all"</span>) <span class="sc">|&gt;</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(rate_low_birth_weight_quality)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  rate_low_birth_weight_quality     n
                          &lt;dbl&gt; &lt;int&gt;
1                             1  4168
2                             2   440
3                             3 20516</code></pre>
</div>
</div>
<p>Check quality values for subgroup rates</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>lbw_rates <span class="sc">|&gt;</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(subgroup <span class="sc">!=</span> <span class="st">"all"</span>) <span class="sc">|&gt;</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(rate_low_birth_weight_quality)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 2
  rate_low_birth_weight_quality      n
                          &lt;dbl&gt;  &lt;int&gt;
1                             1  26059
2                             2   5933
3                             3 161626
4                            NA   7374</code></pre>
</div>
</div>
</section>
<section id="confidence-intervals" class="level1">
<h1>8. Confidence Intervals</h1>
<p>Following the guidance provided in the User Guide to the 2010 Natality Public Use File, we use the following process to compute 95 percent confidence intervals for the neonatal health measure.</p>
<p>The neonatal health measure is share low birthweight births in a county. Because this is a percentage, we follow the guidelines for computing 95-percent confidence intervals for percents and proportions.</p>
<section id="tests-for-confidence-intervals" class="level2">
<h2 class="anchored" data-anchor-id="tests-for-confidence-intervals">8.1 Tests for confidence intervals</h2>
<p>First, we confirm that the conditions are met:</p>
<p>Bp ≥ 5 and Bq ≥ 5</p>
<p>Where:</p>
<p>B = number of all births with non-missing birthweight data in the denominator p = percent of low birthweight births divided by 100 q = 1 – p</p>
<p>If these conditions are met, we compute the confidence intervals using the following formulas:</p>
<p>Lower Limit = p−1.96(√((p×q)/B))</p>
<p>Upper Limit = p+1.96(√((p×q)/B))</p>
<p>Where:</p>
<p>p = percent of low birthweight births divided by 100 q = 1 – p B = number of all births with non-missing birthweight data in the denominator</p>
<p>These steps are applied to births to all mothers and subgroup mothers</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate and test conditions from User Guide</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>lbw_rates <span class="ot">&lt;-</span> lbw_rates <span class="sc">|&gt;</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">test_1 =</span> rate_low_birth_weight <span class="sc">*</span> births_all,</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">test_2 =</span> (<span class="dv">1</span> <span class="sc">-</span> rate_low_birth_weight) <span class="sc">*</span> births_all</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The (non-missing) observations for which test 1 isn’t passed are because there are 0 low birthweight births, and therefore the rate is 0.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>lbw_rates <span class="sc">|&gt;</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(test_1 <span class="sc">&gt;=</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  `test_1 &gt;= 5`      n
  &lt;lgl&gt;          &lt;int&gt;
1 FALSE             44
2 TRUE          218698
3 NA              7374</code></pre>
</div>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>lbw_rates <span class="sc">|&gt;</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(test_1 <span class="sc">&lt;</span> <span class="dv">5</span>) <span class="sc">|&gt;</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(rate_low_birth_weight, births_lbw)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  rate_low_birth_weight births_lbw     n
                  &lt;dbl&gt;      &lt;dbl&gt; &lt;int&gt;
1                     0          0    44</code></pre>
</div>
</div>
<p>All (non-missing) observations pass test 2.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>lbw_rates <span class="sc">|&gt;</span> </span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(test_2 <span class="sc">&gt;=</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  `test_2 &gt;= 5`      n
  &lt;lgl&gt;          &lt;int&gt;
1 TRUE          218742
2 NA              7374</code></pre>
</div>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>lbw_rates <span class="sc">|&gt;</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(test_2 <span class="sc">&lt;</span> <span class="dv">5</span>) <span class="sc">|&gt;</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(rate_low_birth_weight)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 0 × 2
# ℹ 2 variables: rate_low_birth_weight &lt;dbl&gt;, n &lt;int&gt;</code></pre>
</div>
</div>
</section>
<section id="construct-confidence-intervals" class="level2">
<h2 class="anchored" data-anchor-id="construct-confidence-intervals">8.2 Construct confidence intervals</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>lbw_rates <span class="ot">&lt;-</span> lbw_rates <span class="sc">|&gt;</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">rate_low_birth_weight_lb =</span> (rate_low_birth_weight) <span class="sc">-</span>  (<span class="fl">1.96</span><span class="sc">*</span><span class="fu">sqrt</span>(rate_low_birth_weight<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>rate_low_birth_weight)<span class="sc">/</span>births_all)),</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">rate_low_birth_weight_ub =</span> (rate_low_birth_weight) <span class="sc">+</span>  (<span class="fl">1.96</span><span class="sc">*</span><span class="fu">sqrt</span>(rate_low_birth_weight<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>rate_low_birth_weight)<span class="sc">/</span>births_all))</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="validate-confidence-intervals" class="level2">
<h2 class="anchored" data-anchor-id="validate-confidence-intervals">8.3 Validate confidence intervals</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">"If rate is missing, then lower bound is also missing"</span>, {</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check that wherever rate_low_birth_weight is NA, rate_low_birth_weight_lb is also NA</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="fu">is.na</span>(lbw_rates<span class="sc">$</span>rate_low_birth_weight) <span class="sc">==</span> <span class="fu">is.na</span>(lbw_rates<span class="sc">$</span>rate_low_birth_weight_lb)))</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Test passed 🥇</code></pre>
</div>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">"Lower bound is less than estimate"</span>, {</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Subset to rows where rate_low_birth_weight is not NA and not 0</span></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>  relevant_rows <span class="ot">&lt;-</span> <span class="sc">!</span><span class="fu">is.na</span>(lbw_rates<span class="sc">$</span>rate_low_birth_weight) <span class="sc">&amp;</span></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>    lbw_rates<span class="sc">$</span>rate_low_birth_weight <span class="sc">!=</span> <span class="dv">0</span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Apply the condition only to those rows</span></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(lbw_rates<span class="sc">$</span>rate_low_birth_weight_lb[relevant_rows] <span class="sc">&lt;</span> lbw_rates<span class="sc">$</span>rate_low_birth_weight[relevant_rows]))</span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Test passed 😸</code></pre>
</div>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">"Lower bound is a percentage"</span>, {</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Subset to rows where rate_low_birth_weight is not NA and not 0</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>  relevant_rows <span class="ot">&lt;-</span> <span class="sc">!</span><span class="fu">is.na</span>(lbw_rates<span class="sc">$</span>rate_low_birth_weight) <span class="sc">&amp;</span></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>    lbw_rates<span class="sc">$</span>rate_low_birth_weight <span class="sc">!=</span> <span class="dv">0</span></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Apply the condition only to those rows</span></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(lbw_rates<span class="sc">$</span>rate_low_birth_weight_lb[relevant_rows] <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span>  lbw_rates<span class="sc">$</span>rate_low_birth_weight_lb[relevant_rows] <span class="sc">&lt;</span> <span class="dv">1</span>))</span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Test passed 😸</code></pre>
</div>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">"Upper bound is greater than estimate"</span>, {</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Subset to rows where rate_low_birth_weight is not NA and not 0</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>  relevant_rows <span class="ot">&lt;-</span> <span class="sc">!</span><span class="fu">is.na</span>(lbw_rates<span class="sc">$</span>rate_low_birth_weight) <span class="sc">&amp;</span></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>    lbw_rates<span class="sc">$</span>rate_low_birth_weight <span class="sc">!=</span> <span class="dv">0</span></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Apply the condition only to those rows</span></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(lbw_rates<span class="sc">$</span>rate_low_birth_weight_ub[relevant_rows] <span class="sc">&gt;</span> lbw_rates<span class="sc">$</span>rate_low_birth_weight[relevant_rows]))</span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Test passed 😀</code></pre>
</div>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">"Upper bound is a percentage"</span>, {</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Subset to rows where rate_low_birth_weight is not NA and not 0</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>  relevant_rows <span class="ot">&lt;-</span> <span class="sc">!</span><span class="fu">is.na</span>(lbw_rates<span class="sc">$</span>rate_low_birth_weight) <span class="sc">&amp;</span></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>    lbw_rates<span class="sc">$</span>rate_low_birth_weight <span class="sc">!=</span> <span class="dv">0</span></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Apply the condition only to those rows</span></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(lbw_rates<span class="sc">$</span>rate_low_birth_weight_ub[relevant_rows] <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span>  lbw_rates<span class="sc">$</span>rate_low_birth_weight_ub[relevant_rows] <span class="sc">&lt;</span> <span class="dv">1</span>))</span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Test passed 😀</code></pre>
</div>
</div>
</section>
</section>
<section id="save-and-write-out-data" class="level1">
<h1>9. Save and write out data</h1>
<p>We removed Connecticut counties in 2022 and 2023 earlier in the file, because the counties for these years in the CDC WONDER data do not match our target counties. We add them back to the final file below</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the counties, years, and subgroups</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>state <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"09"</span>)</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>counties <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"110"</span>, <span class="st">"120"</span>, <span class="st">"130"</span>, <span class="st">"140"</span>, <span class="st">"150"</span>, <span class="st">"160"</span>, <span class="st">"170"</span>, <span class="st">"180"</span>, <span class="st">"190"</span>)</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>years <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2022</span>, <span class="dv">2023</span>)</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>subgroups <span class="ot">&lt;-</span> <span class="fu">unique</span>(lbw_rates<span class="sc">$</span>subgroup)</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a new data frame with the necessary combinations</span></span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>ct_2022_2023 <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">state =</span> state, </span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">county =</span> counties,</span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">year =</span> years,</span>
<span id="cb78-12"><a href="#cb78-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">subgroup =</span> subgroups</span>
<span id="cb78-13"><a href="#cb78-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb78-14"><a href="#cb78-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-15"><a href="#cb78-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Set variables to missing for these observations</span></span>
<span id="cb78-16"><a href="#cb78-16" aria-hidden="true" tabindex="-1"></a>ct_2022_2023 <span class="ot">&lt;-</span> ct_2022_2023 <span class="sc">%&gt;%</span></span>
<span id="cb78-17"><a href="#cb78-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb78-18"><a href="#cb78-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">rate_low_birth_weight =</span> <span class="cn">NA</span>,</span>
<span id="cb78-19"><a href="#cb78-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">rate_low_birth_weight_lb =</span> <span class="cn">NA</span>, </span>
<span id="cb78-20"><a href="#cb78-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">rate_low_birth_weight_ub =</span> <span class="cn">NA</span>, </span>
<span id="cb78-21"><a href="#cb78-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">rate_low_birth_weight_quality =</span> <span class="cn">NA</span></span>
<span id="cb78-22"><a href="#cb78-22" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb78-23"><a href="#cb78-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-24"><a href="#cb78-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Append rows to the existing data</span></span>
<span id="cb78-25"><a href="#cb78-25" aria-hidden="true" tabindex="-1"></a>lbw_rates <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(lbw_rates, ct_2022_2023)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove unnecessary variables and sort by year, state, and county</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>final_all <span class="ot">&lt;-</span> lbw_rates <span class="sc">|&gt;</span></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(subgroup<span class="sc">==</span><span class="st">"all"</span>) <span class="sc">|&gt;</span></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>    year, </span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>    state, </span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>    county, </span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a>    rate_low_birth_weight, </span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a>    rate_low_birth_weight_lb, </span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a>    rate_low_birth_weight_ub, </span>
<span id="cb79-11"><a href="#cb79-11" aria-hidden="true" tabindex="-1"></a>    rate_low_birth_weight_quality</span>
<span id="cb79-12"><a href="#cb79-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb79-13"><a href="#cb79-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(year, state, county)</span>
<span id="cb79-14"><a href="#cb79-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-15"><a href="#cb79-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-16"><a href="#cb79-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Write out final data</span></span>
<span id="cb79-17"><a href="#cb79-17" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(<span class="at">x =</span> final_all,</span>
<span id="cb79-18"><a href="#cb79-18" aria-hidden="true" tabindex="-1"></a>          <span class="at">file =</span> here<span class="sc">::</span><span class="fu">here</span>(</span>
<span id="cb79-19"><a href="#cb79-19" aria-hidden="true" tabindex="-1"></a>            <span class="st">"04_health"</span>,</span>
<span id="cb79-20"><a href="#cb79-20" aria-hidden="true" tabindex="-1"></a>            <span class="st">"neonatal-health"</span>,</span>
<span id="cb79-21"><a href="#cb79-21" aria-hidden="true" tabindex="-1"></a>            <span class="st">"data"</span>,</span>
<span id="cb79-22"><a href="#cb79-22" aria-hidden="true" tabindex="-1"></a>            <span class="st">"final"</span>,</span>
<span id="cb79-23"><a href="#cb79-23" aria-hidden="true" tabindex="-1"></a>            <span class="st">"rate_low_birth_weight_metric_all_county.csv"</span></span>
<span id="cb79-24"><a href="#cb79-24" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb79-25"><a href="#cb79-25" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove unnecessary variables and sort by year, state, county, and subgroup</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>final_subgroup <span class="ot">&lt;-</span> lbw_rates <span class="sc">|&gt;</span></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">subgroup_type =</span> <span class="fu">case_when</span>(</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>      subgroup <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"nhwhite"</span>, <span class="st">"nhblack"</span>, <span class="st">"hisp"</span>, <span class="st">"nhother"</span>) <span class="sc">~</span> <span class="st">"race-ethncity"</span>,</span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>      subgroup <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"lths"</span>, <span class="st">"hs"</span>, <span class="st">"somecol"</span>, <span class="st">"baplus"</span>) <span class="sc">~</span> <span class="st">"mothers-education"</span>,</span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>      subgroup <span class="sc">==</span> <span class="st">"all"</span> <span class="sc">~</span> <span class="st">"all"</span>,</span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA</span></span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">subgroup =</span> <span class="fu">case_when</span>(</span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a>      subgroup <span class="sc">==</span> <span class="st">"all"</span> <span class="sc">~</span> <span class="st">"All"</span>,</span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a>      subgroup <span class="sc">==</span> <span class="st">"nhwhite"</span> <span class="sc">~</span> <span class="st">"White, Hon-Hispanic"</span>,</span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a>      subgroup <span class="sc">==</span> <span class="st">"nhblack"</span> <span class="sc">~</span> <span class="st">"Black, Non-Hispanic"</span>,</span>
<span id="cb80-14"><a href="#cb80-14" aria-hidden="true" tabindex="-1"></a>      subgroup <span class="sc">==</span> <span class="st">"hisp"</span> <span class="sc">~</span> <span class="st">"Hispanic"</span>,</span>
<span id="cb80-15"><a href="#cb80-15" aria-hidden="true" tabindex="-1"></a>      subgroup <span class="sc">==</span> <span class="st">"nhother"</span> <span class="sc">~</span> <span class="st">"Other Races and Ethnicities"</span>,</span>
<span id="cb80-16"><a href="#cb80-16" aria-hidden="true" tabindex="-1"></a>      subgroup <span class="sc">==</span> <span class="st">"lths"</span> <span class="sc">~</span> <span class="st">"Less than High School"</span>,</span>
<span id="cb80-17"><a href="#cb80-17" aria-hidden="true" tabindex="-1"></a>      subgroup <span class="sc">==</span> <span class="st">"hs"</span> <span class="sc">~</span> <span class="st">"GED/High School Degree"</span>,</span>
<span id="cb80-18"><a href="#cb80-18" aria-hidden="true" tabindex="-1"></a>      subgroup <span class="sc">==</span> <span class="st">"somecol"</span> <span class="sc">~</span> <span class="st">"Some College"</span>,</span>
<span id="cb80-19"><a href="#cb80-19" aria-hidden="true" tabindex="-1"></a>      subgroup <span class="sc">==</span> <span class="st">"baplus"</span> <span class="sc">~</span> <span class="st">"College Degree or Higher"</span>,</span>
<span id="cb80-20"><a href="#cb80-20" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb80-21"><a href="#cb80-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb80-22"><a href="#cb80-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb80-23"><a href="#cb80-23" aria-hidden="true" tabindex="-1"></a>    year, </span>
<span id="cb80-24"><a href="#cb80-24" aria-hidden="true" tabindex="-1"></a>    state, </span>
<span id="cb80-25"><a href="#cb80-25" aria-hidden="true" tabindex="-1"></a>    county, </span>
<span id="cb80-26"><a href="#cb80-26" aria-hidden="true" tabindex="-1"></a>    subgroup_type,</span>
<span id="cb80-27"><a href="#cb80-27" aria-hidden="true" tabindex="-1"></a>    subgroup,</span>
<span id="cb80-28"><a href="#cb80-28" aria-hidden="true" tabindex="-1"></a>    rate_low_birth_weight, </span>
<span id="cb80-29"><a href="#cb80-29" aria-hidden="true" tabindex="-1"></a>    rate_low_birth_weight_lb, </span>
<span id="cb80-30"><a href="#cb80-30" aria-hidden="true" tabindex="-1"></a>    rate_low_birth_weight_ub, </span>
<span id="cb80-31"><a href="#cb80-31" aria-hidden="true" tabindex="-1"></a>    rate_low_birth_weight_quality</span>
<span id="cb80-32"><a href="#cb80-32" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb80-33"><a href="#cb80-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(year, state, county, subgroup_type, subgroup)</span>
<span id="cb80-34"><a href="#cb80-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-35"><a href="#cb80-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-36"><a href="#cb80-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Write out final data - subgroups</span></span>
<span id="cb80-37"><a href="#cb80-37" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(<span class="at">x =</span> final_subgroup,</span>
<span id="cb80-38"><a href="#cb80-38" aria-hidden="true" tabindex="-1"></a>          <span class="at">file =</span> here<span class="sc">::</span><span class="fu">here</span>(</span>
<span id="cb80-39"><a href="#cb80-39" aria-hidden="true" tabindex="-1"></a>            <span class="st">"04_health"</span>,</span>
<span id="cb80-40"><a href="#cb80-40" aria-hidden="true" tabindex="-1"></a>            <span class="st">"neonatal-health"</span>,</span>
<span id="cb80-41"><a href="#cb80-41" aria-hidden="true" tabindex="-1"></a>            <span class="st">"data"</span>,</span>
<span id="cb80-42"><a href="#cb80-42" aria-hidden="true" tabindex="-1"></a>            <span class="st">"final"</span>,</span>
<span id="cb80-43"><a href="#cb80-43" aria-hidden="true" tabindex="-1"></a>            <span class="st">"rate_low_birth_weight_metric_subgroup_county.csv"</span></span>
<span id="cb80-44"><a href="#cb80-44" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb80-45"><a href="#cb80-45" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>