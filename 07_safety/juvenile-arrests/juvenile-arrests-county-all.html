<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Vincent Pancini">
<meta name="dcterms.date" content="2024-03-12">

<title>Juvenile Arrests - County</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="juvenile-arrests-county-all_files/libs/clipboard/clipboard.min.js"></script>
<script src="juvenile-arrests-county-all_files/libs/quarto-html/quarto.js"></script>
<script src="juvenile-arrests-county-all_files/libs/quarto-html/popper.min.js"></script>
<script src="juvenile-arrests-county-all_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="juvenile-arrests-county-all_files/libs/quarto-html/anchor.min.js"></script>
<link href="juvenile-arrests-county-all_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="juvenile-arrests-county-all_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="juvenile-arrests-county-all_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="juvenile-arrests-county-all_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="juvenile-arrests-county-all_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Juvenile Arrests - County</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Vincent Pancini </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">March 12, 2024</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<style>
@import url('https://fonts.googleapis.com/css?family=Lato&display=swap');
</style>
<p><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato"></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen =</span> <span class="dv">999</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidylog)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(urbnthemes)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">set_urbn_defaults</span>(<span class="at">style =</span> <span class="st">"print"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This file creates the county-level metric for juvenile arrests per 100,000 juveniles (age 10-17) for years 2021-2022.</p>
<p>This file relies on data created in <code>01_agency_geo_county.Rmd</code>. You must run <code>01_agency_geo_county.Rmd</code> before running this file.</p>
<p>The rest of this file is organized as follows:</p>
<ol type="1">
<li>Background</li>
<li>Manually download NIBRS arrest data from openICPSR</li>
<li>Read in and clean NIBRS arrest data</li>
<li>Aggregate agency-level arrests to the county level</li>
<li>Calculate reporting rate for all agencies</li>
<li>Calculate rates of juvenile arrests per 100,000 juveniles</li>
<li>Construct quality indicators</li>
<li>Validation</li>
<li>Save and write out data</li>
</ol>
<p>All data used in this file are available on Box <a href="https://urbanorg.box.com/s/poqnegsa6i74phcdr1eap7tacpe4x1gf">here</a>. Data stored on Box are only available to Urban Institute researchers.</p>
<p>This file assumes that you have cloned the GitHub repository for this project to your local computer. You can find the project repository <a href="https://github.com/UI-Research/mobility-from-poverty">here</a> and learn how to clone a repository <a href="https://docs.github.com/en/repositories/creating-and-managing-repositories/cloning-a-repository">here</a>.</p>
<section id="background" class="level2">
<h2 class="anchored" data-anchor-id="background">1. Background</h2>
<p>This section provides background for the data used to create this metric.</p>
<p>The data for this metric come from the FBI’s <a href="https://bjs.ojp.gov/national-incident-based-reporting-system-nibrs">National Incident-Based Reporting System (NIBRS)</a>. This is the national standard for law enforcement crime data reporting in the United States. Processing the raw NIBRS data would take a lot of work.</p>
<p>Instead of downloading the raw data directly, we use criminologist Jacob Kaplan’s Concatenated Files: National Incident-Based Reporting System (NIBRS) Data, 1991-2022. We use the latest version, Version 9. These data are available for download via <a href="https://www.openicpsr.org/openicpsr/project/118281/version/V9/view">openICPSR</a>.</p>
<p>The NIBRS data are separated into segments. For this metric, we use the following two segments:</p>
<ul>
<li>Arrestee segment</li>
<li>Group B Arrest Report segment</li>
</ul>
<p>Note that data for a single year may change with each version release (e.g., 2021 NIBRS data included in Version 8 may not match 2021 NIBRS data released in Version 9). I think this is because as more agencies switch from reporting through UCR to NIBRS, they also provide historical information. Future updates should make sure to run past years with the most recent version as well.</p>
<p>To learn more about NIBRS data, consult Jacob Kaplan’s book titled <a href="https://nibrsbook.com/">National Incident-Based Reporting System (NIBRS) Data: A Practitioner’s Guide</a>. For these metrics, the most important thing to know about these data is that most police agencies do not report NIBRS data prior to 2021. In 2019, only 8,500 out of approximately 18,000 police agencies in the United States (covering about 45% of the US population) reported NIBRS data. Instead, agencies primarily reported <a href="https://ucrbook.com/">UCR data</a> for 2020 and before. However, the FBI has moved entirely to NIBRS data starting in 2021 and no longer collects UCR data, which is why we use NIBRS data instead (<a href="https://nibrsbook.com/overview-of-the-data.html">source</a>).</p>
<p>We do not want to use NIBRS data for some years and UCR data for others. However, because of lack of reporting, <strong>there are a lot of missing values prior to 2021 for NIBRS data</strong>. Future updates of the safety metrics may want to include historical NIBRS data back to 2014 and should keep this in mind.</p>
<p>Note that the age bracket of ages 10 to 17 was chosen for this metric because the majority of states have an age of adult criminal liability of 18, at least one state has a minimum age of criminal liability of 12, and arrests of very young children are unlikely.</p>
<p>Each instance of an arrest, citation, or summons for an offense is counted as an arrest. An individual can be arrested more than once, and therefore rates constructed are of <em>arrests</em> and not of persons arrested. Arrest rates are calculated for all offense types available in NIBRS data, including offenses against property, persons, and society.</p>
</section>
<section id="manually-download-nibrs-arrest-data-from-openicpsr" class="level2">
<h2 class="anchored" data-anchor-id="manually-download-nibrs-arrest-data-from-openicpsr">2. Manually download NIBRS arrest data from openICPSR</h2>
<p>This section describes the steps for manually downloading the NIBRS data segments necessary for this metric.</p>
<p>Accessing these data requires an ICPSR account. Therefore, we do not directly download the data in the code. Manually downloading these data is a five-step process, but you will only need to do each of these steps once for the creation of this metric:</p>
<ol type="1">
<li>Create an ICPSR account <a href="https://www.icpsr.umich.edu/cgi-bin/newacct">here</a>.</li>
<li>Navigate to Jacob Kaplan’s project page for his NIBRS Concatenated Files <a href="https://www.openicpsr.org/openicpsr/project/118281/version/V9/view">here</a>.</li>
<li>Select <code>nibrs_1991_2022_arrestee_segment_rds.zip</code>
<ul>
<li>Select <code>Download this file</code></li>
<li>Select <code>I Agree</code> on the <code>Terms of Use</code></li>
<li>Move the zip file from your <code>Downloads</code> folder to the appropriate directory</li>
</ul></li>
<li>Navigate back to the <a href="https://www.openicpsr.org/openicpsr/project/118281/version/V9/view">project page</a></li>
<li>Select <code>nibrs_group_b_arrest_report_segment_2022_rds.zip</code>
<ul>
<li>Select <code>Download this file</code></li>
<li>Select <code>I Agree</code> on the <code>Terms of Use</code></li>
<li>Move the zip file from your <code>Downloads</code> folder to the appropriate directory</li>
</ul></li>
</ol>
</section>
<section id="read-in-and-clean-nibrs-arrest-data" class="level2">
<h2 class="anchored" data-anchor-id="read-in-and-clean-nibrs-arrest-data">3. Read in and clean NIBRS arrest data</h2>
<p>This section extracts the necessary files from each zip file downloaded in the previous step and reads the files into the R environment. Each zip file contains data files for 1991-2022. However, we only want 2021-2022. Note that future updates of this metric may want to include historical NIBRS data back to 2014 and should update this section to include all years.</p>
<section id="read-in-nibrs-data" class="level3">
<h3 class="anchored" data-anchor-id="read-in-nibrs-data">3.1 Read in NIBRS data</h3>
<section id="a-extract-files-for-2021-2022-from-the-zip-files-for-both-segments" class="level4">
<h4 class="anchored" data-anchor-id="a-extract-files-for-2021-2022-from-the-zip-files-for-both-segments">3.1a Extract files for 2021-2022 from the zip files for both segments</h4>
<p>Extract each file for the years 2021-2022 from the Group A <code>arrestee</code> segment and from the Group B <code>arrest_report</code> segment.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify range of years</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>start_year <span class="ot">&lt;-</span> <span class="dv">2021</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>end_year <span class="ot">&lt;-</span> <span class="dv">2022</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a vector of years between start_year and end_year</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>my_years <span class="ot">&lt;-</span> <span class="fu">seq</span>(start_year, end_year)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract years 2014-2022 for the arrestee segment</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (year <span class="cf">in</span> my_years) {</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unzip</span>(</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">zipfile =</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"07_safety"</span>, <span class="st">"juvenile-arrests"</span>, <span class="st">"data"</span>, <span class="st">"nibrs_1991_2022_arrestee_segment_rds.zip"</span>),</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">files =</span> <span class="fu">paste0</span>(<span class="st">"nibrs_arrestee_segment_"</span>, year, <span class="st">".rds"</span>),</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">exdir =</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"07_safety"</span>, <span class="st">"juvenile-arrests"</span>, <span class="st">"data"</span>, <span class="st">"nibrs_1991_2022_arrestee_segment_rds"</span>)</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract years 2014-2022 for the Group B arrest report segment</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (year <span class="cf">in</span> my_years) {</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unzip</span>(</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">zipfile =</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"07_safety"</span>, <span class="st">"juvenile-arrests"</span>, <span class="st">"data"</span>, <span class="st">"nibrs_1991_2022_group_b_arrest_report_segment_rds.zip"</span>),</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">files =</span> <span class="fu">paste0</span>(<span class="st">"nibrs_group_b_arrest_report_segment_"</span>, year, <span class="st">".rds"</span>),</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">exdir =</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"07_safety"</span>, <span class="st">"juvenile-arrests"</span>, <span class="st">"data"</span>, <span class="st">"nibrs_1991_2022_group_b_arrest_report_segment_rds"</span>)</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove zip files</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a><span class="fu">unlink</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"07_safety"</span>, <span class="st">"juvenile-arrests"</span>, <span class="st">"data"</span>, <span class="st">"nibrs_1991_2022_arrestee_segment_rds.zip"</span>))</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a><span class="fu">unlink</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"07_safety"</span>, <span class="st">"juvenile-arrests"</span>, <span class="st">"data"</span>, <span class="st">"nibrs_1991_2022_group_b_arrest_report_segment_rds.zip"</span>))</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean up environment</span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(start_year, end_year, my_year)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="b-read-in-and-append-2021-2022-nibrs-data-for-both-groups" class="level4">
<h4 class="anchored" data-anchor-id="b-read-in-and-append-2021-2022-nibrs-data-for-both-groups">3.1b Read in and append 2021-2022 NIBRS data for both groups</h4>
<p>For each segment, read in the files for years 2021-2022 and append them. We also limit the appended files to relevant variables. Note that when including historical data back to 2014, this section has a very long run time. The reviewer or future updates may want to consider writing a more efficient approach if possible.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># List all files in the Arrestee segment folder (Group A)</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>file_list <span class="ot">&lt;-</span> <span class="fu">list.files</span>(here<span class="sc">::</span><span class="fu">here</span>(</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"07_safety"</span>, <span class="st">"juvenile-arrests"</span>, <span class="st">"data"</span>, <span class="st">"nibrs_1991_2022_arrestee_segment_rds"</span>),</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">pattern =</span> <span class="st">"[.]rds$"</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Read in Group A files and append them</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>arrests_a <span class="ot">&lt;-</span> file_list <span class="sc">%&gt;%</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(basename) <span class="sc">%&gt;%</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map_df</span>(readRDS)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Select only necessary variables from Group A and limit observations to under age 18</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>arrests_a <span class="ot">&lt;-</span> arrests_a <span class="sc">%&gt;%</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(year, </span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>         ori, <span class="co"># ORI is a unique agency identifier</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>         ucr_arrest_offense_code,</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>         age_of_arrestee,</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>         sex_of_arrestee, </span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>         race_of_arrestee, </span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>         ethnicity_of_arrestee) <span class="sc">%&gt;%</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">group =</span> <span class="st">"A"</span>,</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>         <span class="at">age =</span> <span class="fu">as.numeric</span>(age_of_arrestee))</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a><span class="co"># List all files in the Arrest Report Segment folder (Group B)</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>file_list <span class="ot">&lt;-</span> <span class="fu">list.files</span>(here<span class="sc">::</span><span class="fu">here</span>(</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>  <span class="st">"07_safety"</span>, <span class="st">"juvenile-arrests"</span>, <span class="st">"data"</span>, <span class="st">"nibrs_1991_2022_group_b_arrest_report_segment_rds"</span>),</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">pattern =</span> <span class="st">"[.]rds$"</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Read in Group B files and append them</span></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>arrests_b <span class="ot">&lt;-</span> file_list <span class="sc">%&gt;%</span></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(basename) <span class="sc">%&gt;%</span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map_df</span>(readRDS)</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Select only necessary variables from Group B and limit observations to under age 18</span></span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>arrests_b <span class="ot">&lt;-</span> arrests_b <span class="sc">%&gt;%</span></span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(year, </span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>         ori, <span class="co"># ORI is a unique agency identifier</span></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>         ucr_arrest_offense_code, </span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>         age_of_arrestee, </span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>         sex_of_arrestee, </span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>         race_of_arrestee, </span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>         ethnicity_of_arrestee) <span class="sc">%&gt;%</span></span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">group =</span> <span class="st">"B"</span>,</span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>         <span class="at">age =</span> <span class="fu">as.numeric</span>(age_of_arrestee))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="c-append-the-2021-2022-group-a-file-and-the-2014-2022-group-b-file." class="level4">
<h4 class="anchored" data-anchor-id="c-append-the-2021-2022-group-a-file-and-the-2014-2022-group-b-file.">3.1c Append the 2021-2022 Group A file and the 2014-2022 Group B file.</h4>
<p>Append Group A and Group B files for all arrests</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Append files</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>arrests_all <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(arrests_a, arrests_b)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that because the process of extracting and reading in these files takes so long, I write out the appended all arrests data here. Then I read this file back in when returning to this program so that I don’t have to constantly re-run the previous steps.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Write out all arrests data</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(arrests_all, <span class="at">file =</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"07_safety"</span>, <span class="st">"juvenile-arrests"</span>, <span class="st">"data"</span>, <span class="st">"arrests_all_21_22.csv"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read all arrests data back in for ease of future use</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>arrests_all <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"07_safety"</span>, <span class="st">"juvenile-arrests"</span>, <span class="st">"data"</span>, <span class="st">"arrests_all_21_22.csv"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="d-create-subset-of-data-for-just-juveniles" class="level4">
<h4 class="anchored" data-anchor-id="d-create-subset-of-data-for-just-juveniles">3.1d Create subset of data for just juveniles</h4>
<p>Subset the arrests data to just those under the age of 18</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a subset of just juvenile arrests</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>arrests <span class="ot">&lt;-</span> arrests_all <span class="sc">%&gt;%</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(age <span class="sc">&lt;</span> <span class="dv">18</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that because the process of extracting and reading in these files takes so long, I write out appended juvenile arrests data here. Then I read this file back in when returning to this program so that I don’t have to constantly re-run the previous steps.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Write out juvenile arrests data</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(arrests_juv, <span class="at">file =</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"07_safety"</span>, <span class="st">"juvenile-arrests"</span>, <span class="st">"data"</span>, <span class="st">"arrests_juv_21_22.csv"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read juvenile arrests data back in for ease of future use</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>arrests <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"07_safety"</span>, <span class="st">"juvenile-arrests"</span>, <span class="st">"data"</span>, <span class="st">"arrests_juv_21_22.csv"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove obsolete files</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(arrests_a, arrests_b)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="fu">gc</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="identify-violent-crimes-and-property-crimes" class="level3">
<h3 class="anchored" data-anchor-id="identify-violent-crimes-and-property-crimes">3.2 Identify violent crimes and property crimes</h3>
<p>Group A offense codes are categorized into crimes against property, crimes against persons (violent crimes), or crimes against society. Group B offense codes do not receive any of these categorizations. We are interested in property crimes and violent crimes. Using Section 2.3 of the <a href="https://bjs.ojp.gov/sites/g/files/xyckuh236/files/sarble/data_common/nibrs-user-manual-2021-1041521.pdf">2021.1 National Incident-Based Reporting System User Manual</a>, we create a data frame of all offense, crime type, and group combinations. We then use this data to identify property crimes and violent crimes in our data.</p>
<p>Count the number of distinct offense codes across all years.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Count number of observations in each offense code</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>arrests <span class="sc">%&gt;%</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(ucr_arrest_offense_code)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                               ucr_arrest_offense_code      n
1                                                   all other offenses 113652
2                                                       animal cruelty    203
3                                                                arson   1724
4                                assault offenses - aggravated assault  28308
5                                      assault offenses - intimidation  16475
6                                    assault offenses - simple assault 125714
7                                                              bribery     14
8                                       burglary/breaking and entering  15107
9                                               counterfeiting/forgery    639
10                                curfew/loitering/vagrancy violations  11363
11                            destruction/damage/vandalism of property  32738
12                                                  disorderly conduct  47002
13                                         driving under the influence   7131
14                  drug/narcotic offenses - drug equipment violations   9981
15                   drug/narcotic offenses - drug/narcotic violations  65596
16                                                        embezzlement    594
17                                                 extortion/blackmail     77
18                                                   failure to appear     77
19                                         family offenses, nonviolent   2944
20                              fraud offenses - credit card/atm fraud   1093
21            fraud offenses - false pretenses/swindle/confidence game   1570
22                          fraud offenses - hacking/computer invasion     27
23                                     fraud offenses - identity theft    223
24                                      fraud offenses - impersonation    609
25                                         fraud offenses - wire fraud     45
26                     fugitive offenses - flight to avoid prosecution      1
27                                gambling offenses - betting/wagering     24
28                   gambling offenses - gambling equipment violations      1
29          gambling offenses - operating/promoting/assisting gambling     12
30                                gambling offenses - sports tampering      2
31                             human trafficking - commercial sex acts     13
32                           human trafficking - involuntary servitude      8
33                                                kidnapping/abduction    700
34                          larceny/theft offenses - all other larceny  17285
35                             larceny/theft offenses - pocket-picking    518
36                            larceny/theft offenses - purse-snatching    205
37                                larceny/theft offenses - shoplifting  29376
38                        larceny/theft offenses - theft from building   3378
39 larceny/theft offenses - theft from coin-operated machine or device     65
40                   larceny/theft offenses - theft from motor vehicle   8680
41   larceny/theft offenses - theft of motor vehicle parts/accessories    454
42                                               liquor law violations  22705
43                                                 motor vehicle theft  15673
44                                    murder/nonnegligent manslaughter   1576
45                                              negligent manslaughter    120
46                                        pornography/obscene material   2580
47         prostitution offenses - assisting or promoting prostitution     26
48                                prostitution offenses - prostitution     88
49                     prostitution offenses - purchasing prostitution      5
50                                                             robbery  12997
51                                                             runaway   3377
52           sex offenses - fondling (incident liberties/child molest)   3518
53                                               sex offenses - incest     69
54                                                 sex offenses - rape   2385
55                        sex offenses - sexual assault with an object    291
56                                               sex offenses - sodomy    912
57                                       sex offenses - statutory rape    529
58                 stolen property offenses (receiving, selling, etc.)  10622
59                                           trespass of real property  13480
60                                  weapon law violations - explosives      1
61                       weapon law violations - weapon law violations  21979</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The following code only pertains to the year 2015. I am leaving the code here (commented out) for the benefit of future updates that may pull historical data:</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co"># # Note that 2015 contains nonconventional codes like `c09`, `m10`, and `n90`. I can't find any documentation for what these codes represent, and the counts are relatively small, so they get ignored in the next step.</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co"># # Looking at the results above gave me unexpected results like `c09`, `m10`, and `n90`. I've identified that these all occur in 2015</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="co"># arrests %&gt;%</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(year==2015) %&gt;%</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="co">#   count(ucr_arrest_offense_code)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Create a data frame that lists all offense, crime type, and group combinations using Section 2.3 of the <a href="https://bjs.ojp.gov/sites/g/files/xyckuh236/files/sarble/data_common/nibrs-user-manual-2021-1041521.pdf">2021.1 National Incident-Based Reporting System User Manual</a>. Note that the full frame includes crimes against society, but these are not used in our analysis.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create data frame for all offense, type, and group combinations.</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>codes <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>offense, <span class="sc">~</span>crime_against, <span class="sc">~</span>group,</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"animal cruelty"</span>,                                                     <span class="st">"society"</span>,  <span class="st">"A"</span>,    </span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"arson"</span>,                                                              <span class="st">"property"</span>, <span class="st">"A"</span>,    </span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"assault offenses - aggravated assault"</span>,                              <span class="st">"person"</span>,   <span class="st">"A"</span>,    </span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"assault offenses - simple assault"</span>,                                  <span class="st">"person"</span>,   <span class="st">"A"</span>,    </span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"assault offenses - intimidation"</span>,                                      <span class="st">"person"</span>, <span class="st">"A"</span>,    </span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"bribery"</span>,                                                              <span class="st">"property"</span>,   <span class="st">"A"</span>,    </span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">"burglary/breaking and entering"</span>,                                     <span class="st">"property"</span>, <span class="st">"A"</span>,    </span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">"commerce violations - import violations"</span>,                              <span class="st">"society"</span>,    <span class="st">"A"</span>,    </span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">"commerce violations - export violations"</span>,                              <span class="st">"society"</span>,    <span class="st">"A"</span>,    </span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>  <span class="st">"commerce violations - federal liquor offenses"</span>,                      <span class="st">"society"</span>,  <span class="st">"A"</span>,    </span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>  <span class="st">"commerce violations - federal tobacco offenses"</span>,                     <span class="st">"society"</span>,  <span class="st">"A"</span>,    </span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>  <span class="st">"commerce violations - wildlife trafficking"</span>,                         <span class="st">"society"</span>,  <span class="st">"A"</span>,    </span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>  <span class="st">"counterfeiting/forgery"</span>,                                             <span class="st">"property"</span>, <span class="st">"A"</span>,    </span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>  <span class="st">"destruction/damage/vandalism of property"</span>,                             <span class="st">"property"</span>,   <span class="st">"A"</span>,    </span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>  <span class="st">"drug/narcotic offenses - drug/narcotic violations"</span>,                  <span class="st">"society"</span>,  <span class="st">"A"</span>,    </span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>  <span class="st">"drug/narcotic offenses - drug equipment violations"</span>,                 <span class="st">"society"</span>,  <span class="st">"A"</span>,    </span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>  <span class="st">"embezzlement"</span>,                                                         <span class="st">"property"</span>,   <span class="st">"A"</span>,    </span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>  <span class="st">"espionage"</span>,                                                          <span class="st">"society"</span>,  <span class="st">"A"</span>,    </span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>  <span class="st">"extortion/blackmail"</span>,                                                  <span class="st">"property"</span>,   <span class="st">"A"</span>,    </span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>  <span class="st">"fraud offenses - false pretenses/swindle/confidence game"</span>,             <span class="st">"property"</span>,   <span class="st">"A"</span>,    </span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>  <span class="st">"fraud offenses - credit card/atm fraud"</span>,                             <span class="st">"property"</span>, <span class="st">"A"</span>,    </span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>  <span class="st">"fraud offenses - impersonation"</span>,                                     <span class="st">"property"</span>, <span class="st">"A"</span>,    </span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>  <span class="st">"fraud offenses - welfare fraud"</span>,                                     <span class="st">"property"</span>, <span class="st">"A"</span>,    </span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>  <span class="st">"fraud offenses - wire fraud"</span>,                                          <span class="st">"property"</span>,   <span class="st">"A"</span>,    </span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>  <span class="st">"fraud offenses - identity theft"</span>,                                      <span class="st">"property"</span>,   <span class="st">"A"</span>,    </span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>  <span class="st">"fraud offenses - hacking/computer invasion"</span>,                         <span class="st">"property"</span>, <span class="st">"A"</span>,    </span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>  <span class="st">"fraud offenses - money laundering"</span>,                                  <span class="st">"society"</span>,  <span class="st">"A"</span>,    </span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>  <span class="st">"fugitive offenses - harboring escapee/concealing from arrest"</span>,         <span class="st">"society"</span>,    <span class="st">"A"</span>,    </span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>  <span class="st">"fugitive offenses - flight to avoid prosecution"</span>,                      <span class="st">"society"</span>,    <span class="st">"A"</span>,    </span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>  <span class="st">"fugitive offenses - flight to avoid deportation"</span>,                      <span class="st">"society"</span>,    <span class="st">"A"</span>,    </span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>  <span class="st">"gambling offenses - betting/wagering"</span>,                                 <span class="st">"society"</span>,    <span class="st">"A"</span>,    </span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a>  <span class="st">"gambling offenses - operating/promoting/assisting gambling"</span>,         <span class="st">"society"</span>,  <span class="st">"A"</span>,    </span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a>  <span class="st">"gambling offenses - gambling equipment violations"</span>,                  <span class="st">"society"</span>,  <span class="st">"A"</span>,    </span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a>  <span class="st">"gambling offenses - sports tampering"</span>,                                 <span class="st">"society"</span>,    <span class="st">"A"</span>,    </span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a>  <span class="st">"murder/nonnegligent manslaughter"</span>,                                     <span class="st">"person"</span>, <span class="st">"A"</span>,    </span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a>  <span class="st">"negligent manslaughter"</span>,                                             <span class="st">"person"</span>,   <span class="st">"A"</span>,    </span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a>  <span class="st">"homicide offenses - justifiable homicide"</span>,                             <span class="st">"not a crime"</span>,    <span class="st">"A"</span>,    </span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a>  <span class="st">"human trafficking - commercial sex acts"</span>,                              <span class="st">"person"</span>, <span class="st">"A"</span>,    </span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a>  <span class="st">"human trafficking - involuntary servitude"</span>,                          <span class="st">"person"</span>,   <span class="st">"A"</span>,    </span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a>  <span class="st">"immigration violations - illegal entry into the united states"</span>,      <span class="st">"society"</span>,  <span class="st">"A"</span>,    </span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a>  <span class="st">"immigration violations - false citizenship"</span>,                         <span class="st">"society"</span>,  <span class="st">"A"</span>,    </span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a>  <span class="st">"immigration violations - smuggling aliens"</span>,                          <span class="st">"society"</span>,  <span class="st">"A"</span>,    </span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a>  <span class="st">"immigration violations - reentry after deportation"</span>,                 <span class="st">"society"</span>,  <span class="st">"A"</span>,    </span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a>  <span class="st">"kidnapping/abduction"</span>,                                                 <span class="st">"person"</span>, <span class="st">"A"</span>,    </span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a>  <span class="st">"larceny/theft offenses - pocket-picking"</span>,                              <span class="st">"property"</span>,   <span class="st">"A"</span>,    </span>
<span id="cb14-49"><a href="#cb14-49" aria-hidden="true" tabindex="-1"></a>  <span class="st">"larceny/theft offenses - purse-snatching"</span>,                             <span class="st">"property"</span>,   <span class="st">"A"</span>,    </span>
<span id="cb14-50"><a href="#cb14-50" aria-hidden="true" tabindex="-1"></a>  <span class="st">"larceny/theft offenses - shoplifting"</span>,                                 <span class="st">"property"</span>,   <span class="st">"A"</span>,    </span>
<span id="cb14-51"><a href="#cb14-51" aria-hidden="true" tabindex="-1"></a>  <span class="st">"larceny/theft offenses - theft from building"</span>,                         <span class="st">"property"</span>,   <span class="st">"A"</span>,    </span>
<span id="cb14-52"><a href="#cb14-52" aria-hidden="true" tabindex="-1"></a>  <span class="st">"larceny/theft offenses - theft from coin-operated machine or device"</span>, <span class="st">"property"</span>,    <span class="st">"A"</span>,    </span>
<span id="cb14-53"><a href="#cb14-53" aria-hidden="true" tabindex="-1"></a>  <span class="st">"larceny/theft offenses - theft from motor vehicle"</span>,                  <span class="st">"property"</span>, <span class="st">"A"</span>,    </span>
<span id="cb14-54"><a href="#cb14-54" aria-hidden="true" tabindex="-1"></a>  <span class="st">"larceny/theft offenses - theft of motor vehicle parts/accessories"</span>,  <span class="st">"property"</span>, <span class="st">"A"</span>,    </span>
<span id="cb14-55"><a href="#cb14-55" aria-hidden="true" tabindex="-1"></a>  <span class="st">"larceny/theft offenses - all other larceny"</span>,                         <span class="st">"property"</span>, <span class="st">"A"</span>,    </span>
<span id="cb14-56"><a href="#cb14-56" aria-hidden="true" tabindex="-1"></a>  <span class="st">"motor vehicle theft"</span>,                                                  <span class="st">"property"</span>,   <span class="st">"A"</span>,    </span>
<span id="cb14-57"><a href="#cb14-57" aria-hidden="true" tabindex="-1"></a>  <span class="st">"pornography/obscene material"</span>,                                         <span class="st">"society"</span>,    <span class="st">"A"</span>,    </span>
<span id="cb14-58"><a href="#cb14-58" aria-hidden="true" tabindex="-1"></a>  <span class="st">"prostitution offenses - prostitution"</span>,                                 <span class="st">"society"</span>,    <span class="st">"A"</span>,    </span>
<span id="cb14-59"><a href="#cb14-59" aria-hidden="true" tabindex="-1"></a>  <span class="st">"prostitution offenses - assisting or promoting prostitution"</span>,          <span class="st">"society"</span>,    <span class="st">"A"</span>,    </span>
<span id="cb14-60"><a href="#cb14-60" aria-hidden="true" tabindex="-1"></a>  <span class="st">"prostitution offenses - purchasing prostitution"</span>,                      <span class="st">"society"</span>,    <span class="st">"A"</span>,    </span>
<span id="cb14-61"><a href="#cb14-61" aria-hidden="true" tabindex="-1"></a>  <span class="st">"robbery"</span>,                                                              <span class="st">"property"</span>,   <span class="st">"A"</span>,    </span>
<span id="cb14-62"><a href="#cb14-62" aria-hidden="true" tabindex="-1"></a>  <span class="st">"sex offenses - rape"</span>,                                                  <span class="st">"person"</span>, <span class="st">"A"</span>,    </span>
<span id="cb14-63"><a href="#cb14-63" aria-hidden="true" tabindex="-1"></a>  <span class="st">"sex offenses - sodomy"</span>,                                              <span class="st">"person"</span>,   <span class="st">"A"</span>,    </span>
<span id="cb14-64"><a href="#cb14-64" aria-hidden="true" tabindex="-1"></a>  <span class="st">"sex offenses - sexual assault with an object"</span>,                         <span class="st">"person"</span>, <span class="st">"A"</span>,    </span>
<span id="cb14-65"><a href="#cb14-65" aria-hidden="true" tabindex="-1"></a>  <span class="st">"sex offenses - fondling (incident liberties/child molest)"</span>,          <span class="st">"person"</span>,   <span class="st">"A"</span>,    </span>
<span id="cb14-66"><a href="#cb14-66" aria-hidden="true" tabindex="-1"></a>  <span class="st">"sex offenses - incest"</span>,                                              <span class="st">"person"</span>,   <span class="st">"A"</span>,    </span>
<span id="cb14-67"><a href="#cb14-67" aria-hidden="true" tabindex="-1"></a>  <span class="st">"sex offenses - statutory rape"</span>,                                      <span class="st">"person"</span>,   <span class="st">"A"</span>,    </span>
<span id="cb14-68"><a href="#cb14-68" aria-hidden="true" tabindex="-1"></a>  <span class="st">"sex offenses - failure to register as a sex offender"</span>,                 <span class="st">"society"</span>,    <span class="st">"A"</span>,    </span>
<span id="cb14-69"><a href="#cb14-69" aria-hidden="true" tabindex="-1"></a>  <span class="st">"stolen property offenses (receiving, selling, etc.)"</span>,                  <span class="st">"property"</span>,   <span class="st">"A"</span>,    </span>
<span id="cb14-70"><a href="#cb14-70" aria-hidden="true" tabindex="-1"></a>  <span class="st">"treason"</span>,                                                              <span class="st">"society"</span>,    <span class="st">"A"</span>,    </span>
<span id="cb14-71"><a href="#cb14-71" aria-hidden="true" tabindex="-1"></a>  <span class="st">"weapon law violations - weapon law violations"</span>,                      <span class="st">"society"</span>,  <span class="st">"A"</span>,    </span>
<span id="cb14-72"><a href="#cb14-72" aria-hidden="true" tabindex="-1"></a>  <span class="st">"weapon law violations - violation of national firearm act of 1934"</span>,  <span class="st">"society"</span>,  <span class="st">"A"</span>,    </span>
<span id="cb14-73"><a href="#cb14-73" aria-hidden="true" tabindex="-1"></a>  <span class="st">"weapon law violations - weapons of mass destruction"</span>,                  <span class="st">"society"</span>,    <span class="st">"A"</span>,    </span>
<span id="cb14-74"><a href="#cb14-74" aria-hidden="true" tabindex="-1"></a>  <span class="st">"weapon law violations - explosives"</span>,                                 <span class="st">"society"</span>,  <span class="st">"A"</span>,    </span>
<span id="cb14-75"><a href="#cb14-75" aria-hidden="true" tabindex="-1"></a>  <span class="st">"failure to appear"</span>,                                                   <span class="st">""</span>,    <span class="st">"B"</span>,    </span>
<span id="cb14-76"><a href="#cb14-76" aria-hidden="true" tabindex="-1"></a>  <span class="st">"curfew/loitering/vagrancy violations"</span>,                                  <span class="st">""</span>,  <span class="st">"B"</span>,    </span>
<span id="cb14-77"><a href="#cb14-77" aria-hidden="true" tabindex="-1"></a>  <span class="st">"disorderly conduct"</span>,                                                  <span class="st">""</span>,    <span class="st">"B"</span>,    </span>
<span id="cb14-78"><a href="#cb14-78" aria-hidden="true" tabindex="-1"></a>  <span class="st">"driving under the influence"</span>,                                           <span class="st">""</span>,  <span class="st">"B"</span>,    </span>
<span id="cb14-79"><a href="#cb14-79" aria-hidden="true" tabindex="-1"></a>  <span class="st">"family offenses, nonviolent"</span>,                                           <span class="st">""</span>,  <span class="st">"B"</span>,    </span>
<span id="cb14-80"><a href="#cb14-80" aria-hidden="true" tabindex="-1"></a>  <span class="st">"federal resource violations"</span>,                                           <span class="st">""</span>,  <span class="st">"B"</span>,    </span>
<span id="cb14-81"><a href="#cb14-81" aria-hidden="true" tabindex="-1"></a>  <span class="st">"liquor law violations"</span>,                                               <span class="st">""</span>,    <span class="st">"B"</span>,    </span>
<span id="cb14-82"><a href="#cb14-82" aria-hidden="true" tabindex="-1"></a>  <span class="st">"perjury"</span>,                                                               <span class="st">""</span>,  <span class="st">"B"</span>,    </span>
<span id="cb14-83"><a href="#cb14-83" aria-hidden="true" tabindex="-1"></a>  <span class="st">"trespass of real property"</span>,                                           <span class="st">""</span>,    <span class="st">"B"</span>,    </span>
<span id="cb14-84"><a href="#cb14-84" aria-hidden="true" tabindex="-1"></a>  <span class="st">"all other offenses"</span>,                                                  <span class="st">""</span>,    <span class="st">"B"</span>,    </span>
<span id="cb14-85"><a href="#cb14-85" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The following three codes were removed in 2021</span></span>
<span id="cb14-86"><a href="#cb14-86" aria-hidden="true" tabindex="-1"></a>  <span class="st">"bad checks"</span>,                                                          <span class="st">""</span>,    <span class="st">""</span>,</span>
<span id="cb14-87"><a href="#cb14-87" aria-hidden="true" tabindex="-1"></a>  <span class="st">"drunkenness"</span>,                                                         <span class="st">""</span>,    <span class="st">""</span>, </span>
<span id="cb14-88"><a href="#cb14-88" aria-hidden="true" tabindex="-1"></a>  <span class="st">"peeping tom"</span>,                                                           <span class="st">""</span>,  <span class="st">""</span>, </span>
<span id="cb14-89"><a href="#cb14-89" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The following code was removed in 2008</span></span>
<span id="cb14-90"><a href="#cb14-90" aria-hidden="true" tabindex="-1"></a>  <span class="st">"runaway"</span>,                                                             <span class="st">""</span>,    <span class="st">""</span>, </span>
<span id="cb14-91"><a href="#cb14-91" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Using the data frame above, group offenses into violent crimes and property crimes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract offenses into vectors for property crimes and violent crimes</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>property <span class="ot">&lt;-</span> <span class="fu">subset</span>(codes, crime_against<span class="sc">==</span><span class="st">"property"</span>)<span class="sc">$</span>offense</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>violent <span class="ot">&lt;-</span> <span class="fu">subset</span>(codes, crime_against<span class="sc">==</span><span class="st">"person"</span>)<span class="sc">$</span>offense</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create indicator variables for property and violent crimes</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>arrests <span class="ot">&lt;-</span> arrests <span class="sc">%&gt;%</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">property =</span> <span class="fu">ifelse</span>(ucr_arrest_offense_code <span class="sc">%in%</span> property, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">violent =</span> <span class="fu">ifelse</span>(ucr_arrest_offense_code <span class="sc">%in%</span> violent, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove obsolete objects</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(codes, property, violent)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>322,230 observations (49%) are not in either category of arrests. These are all crimes against society, Group B offenses, or offense codes that are not classified.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>arrests <span class="sc">%&gt;%</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(property, violent) <span class="sc">%&gt;%</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
# Groups:   property, violent [3]
  property violent      n
     &lt;dbl&gt;   &lt;dbl&gt;  &lt;int&gt;
1        0       0 322230
2        0       1 180618
3        1       0 153713</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>arrests <span class="sc">%&gt;%</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(property<span class="sc">==</span><span class="dv">0</span> <span class="sc">&amp;</span> violent<span class="sc">==</span><span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(ucr_arrest_offense_code)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                       ucr_arrest_offense_code      n
1                                           all other offenses 113652
2                                               animal cruelty    203
3                         curfew/loitering/vagrancy violations  11363
4                                           disorderly conduct  47002
5                                  driving under the influence   7131
6           drug/narcotic offenses - drug equipment violations   9981
7            drug/narcotic offenses - drug/narcotic violations  65596
8                                            failure to appear     77
9                                  family offenses, nonviolent   2944
10             fugitive offenses - flight to avoid prosecution      1
11                        gambling offenses - betting/wagering     24
12           gambling offenses - gambling equipment violations      1
13  gambling offenses - operating/promoting/assisting gambling     12
14                        gambling offenses - sports tampering      2
15                                       liquor law violations  22705
16                                pornography/obscene material   2580
17 prostitution offenses - assisting or promoting prostitution     26
18                        prostitution offenses - prostitution     88
19             prostitution offenses - purchasing prostitution      5
20                                                     runaway   3377
21                                   trespass of real property  13480
22                          weapon law violations - explosives      1
23               weapon law violations - weapon law violations  21979</code></pre>
</div>
</div>
</section>
<section id="recode-race-ethnicity-and-sex-for-group-b" class="level3">
<h3 class="anchored" data-anchor-id="recode-race-ethnicity-and-sex-for-group-b">3.3 Recode race, ethnicity, and sex for Group B</h3>
<p>The values for <code>race_of_arrestee</code> and <code>ethnicity_of_arrestee</code> are different between the Group A and Group B files. The races and ethnicities for Group B observations are coded using single letters and are therefore not very clear. I can’t find a codebook anywhere for these variables, so I make my best guess at recoding them to match the codes used for Group A. Note that this step was not included in the 2021 update.</p>
<p>Note that if there is a codebook available, we should confirm this is correct. It shouldn’t matter for the violent crime or property crime arrests because Group B arrests are excluded from those categories, but it would matter for total arrests.</p>
<p>Recode race and ethnicity for Group B observations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Group B codes for race and ethnicity do not match those used for Group A</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>arrests <span class="sc">%&gt;%</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(group, race_of_arrestee, ethnicity_of_arrestee) <span class="sc">%&gt;%</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 48 × 4
# Groups:   group, race_of_arrestee, ethnicity_of_arrestee [48]
   group race_of_arrestee               ethnicity_of_arrestee       n
   &lt;chr&gt; &lt;chr&gt;                          &lt;chr&gt;                   &lt;int&gt;
 1 A     american indian/alaskan native hispanic origin           433
 2 A     american indian/alaskan native not of hispanic origin   6775
 3 A     american indian/alaskan native unknown                  1066
 4 A     american indian/alaskan native &lt;NA&gt;                      964
 5 A     asian                          hispanic origin           173
 6 A     asian                          not of hispanic origin   3295
 7 A     asian                          unknown                   412
 8 A     asian                          &lt;NA&gt;                      443
 9 A     black                          hispanic origin          2825
10 A     black                          not of hispanic origin 142347
# ℹ 38 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># No arrests for Group B are classified as violent or property crimes</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>arrests <span class="sc">%&gt;%</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(group, property, violent) <span class="sc">%&gt;%</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 4
# Groups:   group, property, violent [4]
  group property violent      n
  &lt;chr&gt;    &lt;dbl&gt;   &lt;dbl&gt;  &lt;int&gt;
1 A            0       0 119626
2 A            0       1 180618
3 A            1       0 153713
4 B            0       0 202604</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Making my best guess to match Group B race/ethnicity codes to Group A codes</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Recode race</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>arrests <span class="ot">&lt;-</span> arrests <span class="sc">%&gt;%</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">race_of_arrestee =</span> <span class="fu">if_else</span>(race_of_arrestee<span class="sc">==</span><span class="st">"w"</span>, <span class="st">"white"</span>, race_of_arrestee),</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">race_of_arrestee =</span> <span class="fu">if_else</span>(race_of_arrestee<span class="sc">==</span><span class="st">"b"</span>, <span class="st">"black"</span>, race_of_arrestee),</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">race_of_arrestee =</span> <span class="fu">if_else</span>(race_of_arrestee<span class="sc">==</span><span class="st">"i"</span>, <span class="st">"american indian/alaskan native"</span>, race_of_arrestee),</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">race_of_arrestee =</span> <span class="fu">if_else</span>(race_of_arrestee<span class="sc">==</span><span class="st">"a"</span>, <span class="st">"asian"</span>, race_of_arrestee),</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">race_of_arrestee =</span> <span class="fu">if_else</span>(race_of_arrestee<span class="sc">==</span><span class="st">"p"</span>, <span class="st">"native hawaiian or other pacific islander"</span>, race_of_arrestee),</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">race_of_arrestee =</span> <span class="fu">if_else</span>(race_of_arrestee<span class="sc">==</span><span class="st">"u"</span>, <span class="st">"unknown"</span>, race_of_arrestee)</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a><span class="do">## Recode ethnicity</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>arrests <span class="ot">&lt;-</span> arrests <span class="sc">%&gt;%</span></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">ethnicity_of_arrestee =</span> <span class="fu">if_else</span>(ethnicity_of_arrestee<span class="sc">==</span><span class="st">"h"</span>, <span class="st">"hispanic origin"</span>, ethnicity_of_arrestee),</span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">ethnicity_of_arrestee =</span> <span class="fu">if_else</span>(ethnicity_of_arrestee<span class="sc">==</span><span class="st">"n"</span>, <span class="st">"not of hispanic origin"</span>, ethnicity_of_arrestee),</span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">ethnicity_of_arrestee =</span> <span class="fu">if_else</span>(ethnicity_of_arrestee<span class="sc">==</span><span class="st">"u"</span>, <span class="st">"unknown"</span>, ethnicity_of_arrestee)</span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The following code only pertains to the year 2015. I am leaving the code here (commented out) for the benefit of future updates that may pull historical data:</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 2015 has 1953 observations with a race code of `f`. There is no codebook and I'm unclear what this means. Additionally, observations with a race code of `f` or `unknown` have ethnicity codes of `a`, `b`, `i`, and `w`. There are 3,877 observations with these ethnicity codes for the `unknown` race group.</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="co"># # Check race and ethnicity codes for 2015</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="co"># arrests %&gt;%</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(year==2015) %&gt;%</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(race_of_arrestee, ethnicity_of_arrestee) %&gt;%</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="co">#   count()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>58,052 observations have <code>unknown</code> ethnicity and 75,253 have missing ethnicity</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>arrests <span class="sc">%&gt;%</span> </span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ethnicity_of_arrestee) <span class="sc">%&gt;%</span> </span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 2
# Groups:   ethnicity_of_arrestee [4]
  ethnicity_of_arrestee       n
  &lt;chr&gt;                   &lt;int&gt;
1 hispanic origin        108242
2 not of hispanic origin 415014
3 unknown                 58052
4 &lt;NA&gt;                    75253</code></pre>
</div>
</div>
<p>Recode sex for Group B observations</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>arrests <span class="sc">%&gt;%</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(group, sex_of_arrestee) <span class="sc">%&gt;%</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 3
# Groups:   group, sex_of_arrestee [4]
  group sex_of_arrestee      n
  &lt;chr&gt; &lt;chr&gt;            &lt;int&gt;
1 A     female          134124
2 A     male            319833
3 B     f                72468
4 B     male            130136</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>arrests <span class="ot">&lt;-</span> arrests <span class="sc">%&gt;%</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">sex_of_arrestee =</span> <span class="fu">if_else</span>(sex_of_arrestee<span class="sc">==</span><span class="st">"f"</span>, <span class="st">"female"</span>, sex_of_arrestee)</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="aggregate-arrest-counts-to-the-reporting-agency-level" class="level3">
<h3 class="anchored" data-anchor-id="aggregate-arrest-counts-to-the-reporting-agency-level">3.4 Aggregate arrest counts to the reporting agency level</h3>
<p>Aggregate arrests by agency and finish race construction</p>
<p>Note that this metric includes the following subgroups by race, sex, and age subgroups, so those subgroups are also aggregated in this section:</p>
<ul>
<li>Race: white, Black, Hispanic, Asian/other</li>
<li>Sex: male, female</li>
<li>Age: ages 10-14, ages 15-17</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>arrests_agency <span class="ot">&lt;-</span> arrests <span class="sc">%&gt;%</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(age <span class="sc">&gt;=</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, ori) <span class="sc">%&gt;%</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">arr_total =</span> <span class="fu">n</span>(),</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">arr_prop =</span> <span class="fu">sum</span>(property<span class="sc">==</span><span class="dv">1</span>),</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">arr_viol =</span> <span class="fu">sum</span>(violent<span class="sc">==</span><span class="dv">1</span>),</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Race subgroups</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">race_aian =</span> <span class="fu">sum</span>(race_of_arrestee <span class="sc">==</span> <span class="st">"american indian/alaskan native"</span>),</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">race_asian =</span> <span class="fu">sum</span>(race_of_arrestee <span class="sc">==</span> <span class="st">"asian"</span>),</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">race_black =</span> <span class="fu">sum</span>(race_of_arrestee <span class="sc">==</span> <span class="st">"black"</span>),</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">race_nhpi =</span> <span class="fu">sum</span>(race_of_arrestee <span class="sc">==</span> <span class="st">"native hawaiian or other pacific islander"</span>),</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">race_unkno =</span> <span class="fu">sum</span>(race_of_arrestee <span class="sc">==</span> <span class="st">"unknown"</span>),</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">race_white =</span> <span class="fu">sum</span>(race_of_arrestee <span class="sc">==</span> <span class="st">"white"</span>),</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">ethn_hispanic =</span> <span class="fu">sum</span>(ethnicity_of_arrestee <span class="sc">==</span> <span class="st">"hispanic origin"</span>),</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">ethn_nonhisp =</span> <span class="fu">sum</span>(ethnicity_of_arrestee <span class="sc">==</span> <span class="st">"not of hispanic origin"</span>),</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sex subgroups</span></span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">sex_male =</span> <span class="fu">sum</span>(sex_of_arrestee <span class="sc">==</span> <span class="st">"male"</span>),</span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">sex_female =</span> <span class="fu">sum</span>(sex_of_arrestee <span class="sc">==</span> <span class="st">"female"</span>),</span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Age subgroups</span></span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">age_10_14 =</span> <span class="fu">sum</span>(age <span class="sc">&gt;=</span> <span class="dv">10</span> <span class="sc">&amp;</span> age <span class="sc">&lt;=</span> <span class="dv">14</span>),</span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">age_15_17 =</span> <span class="fu">sum</span>(age <span class="sc">&gt;=</span> <span class="dv">15</span> <span class="sc">&amp;</span> age <span class="sc">&lt;=</span> <span class="dv">17</span>),</span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Creating indicators for whether the agency has any group A arrests or any group B arrests</span></span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">group_a =</span> <span class="fu">max</span>(group<span class="sc">==</span><span class="st">"A"</span>),</span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">group_b =</span> <span class="fu">max</span>(group<span class="sc">==</span><span class="st">"B"</span>)</span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Construct last race/ethnicity subgroup</span></span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">race_asian_other =</span> race_aian <span class="sc">+</span> race_asian <span class="sc">+</span> race_nhpi)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>1,458 agencies across all years only have Group B arrests of juveniles</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>arrests_agency <span class="sc">%&gt;%</span> </span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(group_a, group_b)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
  group_a group_b     n
    &lt;int&gt;   &lt;int&gt; &lt;int&gt;
1       0       1  1458
2       1       0  4258
3       1       1 10558</code></pre>
</div>
</div>
<p>Make narrow version with just needed variables</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>arrests_agency <span class="ot">&lt;-</span> arrests_agency <span class="sc">%&gt;%</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>    year,</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>    ori, </span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>    arr_total, </span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># arr_viol, </span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># arr_prop, </span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">starts_with</span>(<span class="st">"race"</span>), </span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>    ethn_hispanic,</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">starts_with</span>(<span class="st">"sex"</span>),</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">starts_with</span>(<span class="st">"age"</span>)</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="aggregate-agency-level-arrests-to-the-county-level" class="level2">
<h2 class="anchored" data-anchor-id="aggregate-agency-level-arrests-to-the-county-level">4. Aggregate agency-level arrests to the county level</h2>
<p>This section aggregates the agency-level arrest counts from the agency-level to the county-level.</p>
<p>Our data are currently long by year/agency. However, we want to know the arrest counts at the county level, not the agency level. In the <code>01_agency_geo_county.Rmd</code> program, we constructed a file that linked reporting agencies to counties. For agencies that served more than one county, the file includes a weight to assign proportions of agency-level counts to each county based on population. We can use that file to aggregate counts from agencies to counties.</p>
<section id="load-universe-of-countyagency-pairs-with-weights" class="level3">
<h3 class="anchored" data-anchor-id="load-universe-of-countyagency-pairs-with-weights">4.1 Load universe of county/agency pairs with weights</h3>
<p>First load the universe of agencies linked to counties with weight for each county. This file was created in <code>01_agency_geo_county.Rmd</code> and is long by unique agency/county pairs.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>agency_weights <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"07_safety"</span>, <span class="st">"modified data"</span>, <span class="st">"all_agency_county.csv"</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="join-agency-level-arrests-for-all-years-onto-the-county-agency-file" class="level3">
<h3 class="anchored" data-anchor-id="join-agency-level-arrests-for-all-years-onto-the-county-agency-file">4.2 Join agency-level arrests for all years onto the county-agency file</h3>
<p>Join arrests onto the full universe of county-agencies and multiply counts by the agency-county weight.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Join agency-level juvenile arrests onto universe of agencies</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>arrests_agency_county <span class="ot">&lt;-</span> <span class="fu">left_join</span>(</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> agency_weights,</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> arrests_agency, </span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"ori"</span>, <span class="st">"year"</span>)</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Multiply stats by agency-county weight</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(arr_total<span class="sc">:</span>age_15_17, <span class="sc">~</span>.x <span class="sc">*</span> weight))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There are a lot of unmatched observations. Some agencies do not report NIBRS data, so we expect a lot of missings. 23,948 observations are only in our universe of agencies with county-agency weights. My first thought is that since this is the universe of <em>all</em> agencies, some agencies may not have reported arrests and are therefore not in the arrests data. Secondly, many agencies have arrests, but not for those under the age of 18, so those agencies would also be in the full universe. This is illustrated later in the file when we repeat the join with all agencies.</p>
<p>1,127 observations are only in the 2021-2022 agency-level juvenile arrests data. My first thought is that since we only used the Batch Header File from 2022 to construct the universe of agencies and agency-county weights, it may be missing agencies from other years.</p>
<p>To test this second hypothesis, I repeat the join for 2022 only. There is a proportional number of unmatched observations from each data set for 2022 as compared to 2021-2022. So, I think this is okay.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>test_2022 <span class="ot">&lt;-</span> <span class="fu">left_join</span>(</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> agency_weights <span class="sc">%&gt;%</span> <span class="fu">filter</span>(year<span class="sc">==</span><span class="dv">2022</span>),</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> arrests_agency <span class="sc">%&gt;%</span> <span class="fu">filter</span>(year<span class="sc">==</span><span class="dv">2022</span>), </span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"ori"</span>, <span class="st">"year"</span>)</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove obsolete file</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(test_2022)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="summarize-agency-level-arrests-to-the-county-level" class="level3">
<h3 class="anchored" data-anchor-id="summarize-agency-level-arrests-to-the-county-level">4.3 Summarize agency-level arrests to the county level</h3>
<p>Now that we have joined our agency-level juvenile arrests data onto the full universe of county-agencies, which links agencies to counties and assigns weights for agencies that serve more than one county, we can aggregate the counts from the agency to the county level.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Count number of arrests from reporting agencies in each county</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>arrests_county <span class="ot">&lt;-</span> arrests_agency_county <span class="sc">%&gt;%</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, GEOID, state, county) <span class="sc">%&gt;%</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">across</span>(arr_total<span class="sc">:</span>age_15_17, <span class="sc">~</span><span class="fu">sum</span>(.x, <span class="at">na.rm=</span><span class="cn">TRUE</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Test that subgroups equal total</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test that sex subgroups equal total</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">near</span>(<span class="fu">rowSums</span>(<span class="fu">select</span>(arrests_county, sex_female, sex_male)), arrests_county<span class="sc">$</span>arr_total, <span class="at">tol =</span> <span class="fl">0.01</span>)</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test that age subgroups equal total</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">near</span>(<span class="fu">rowSums</span>(<span class="fu">select</span>(arrests_county, age_10_14, age_15_17)), arrests_county<span class="sc">$</span>arr_total, <span class="at">tol =</span> <span class="fl">0.01</span>)</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test that race subgroups equal total</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">near</span>(<span class="fu">rowSums</span>(<span class="fu">select</span>(arrests_county, <span class="fu">matches</span>(<span class="st">"race_asian_other|race_black|race_white|race_unkno"</span>))), arrests_county<span class="sc">$</span>arr_total, <span class="at">tol =</span> <span class="fl">0.01</span>)</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="calculate-reporting-rate-for-all-agencies" class="level2">
<h2 class="anchored" data-anchor-id="calculate-reporting-rate-for-all-agencies">5. Calculate reporting rate for all agencies</h2>
<p>The quality indicator for this metric is based on the number of agencies reporting. We can’t use the agency-level juvenile arrests data for this, because agencies may have zero juvenile arrests and thus be excluded but still have reported arrests for other ages. Instead, we use the full arrests file (i.e., all arrests and not just juvenile arrests) to calculate agency reporting rates.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sum total arrests by year and reporting agency</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>arrests_all_agency <span class="ot">&lt;-</span> arrests_all <span class="sc">%&gt;%</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, ori) <span class="sc">%&gt;%</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">arr_total_any =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Join total number of arrests for each agency onto the county/agency weight file.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Join by year and reporting agency</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>arrests_all_agency_county <span class="ot">&lt;-</span> <span class="fu">left_join</span>(</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> agency_weights,</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> arrests_all_agency,</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"year"</span>, <span class="st">"ori"</span>)</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There are a lot of unmatched observations. Some agencies do not report NIBRS data, so we expect a lot of missings. 17,397 observations are only in our universe of agencies with county-agency weights. My first thought is that since this is the universe of <em>all</em> agencies, some agencies may not have reported arrests and are therefore not in the arrests data.</p>
<p>1,985 observations are only in the 2021-2022 agency-level arrests data. My first thought is that since we only used the Batch Header File from 2022 to construct the universe of agencies and agency-county weights, it may be missing agencies from other years.</p>
<p>To test this second hypothesis, I repeat the join for 2022 only. There is a proportional number of unmatched observations from each data set for 2022 as compared to 2021-2022. So, I think this is okay.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Join by reporting agency for only 2022</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>test_2022 <span class="ot">&lt;-</span> <span class="fu">left_join</span>(</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> agency_weights <span class="sc">%&gt;%</span> <span class="fu">filter</span>(year<span class="sc">==</span><span class="dv">2022</span>),</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> arrests_all_agency <span class="sc">%&gt;%</span> <span class="fu">filter</span>(year<span class="sc">==</span><span class="dv">2022</span>),</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"year"</span>, <span class="st">"ori"</span>)</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove obsolete file</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(test_2022)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now that we think the join worked, return to the joined all arrests with counties and county-agency weights file. Weight total arrests and indicate reporting by county-agency pairs.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>arrests_all_agency_county <span class="ot">&lt;-</span> arrests_all_agency_county <span class="sc">%&gt;%</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Weight total arrest by county weight</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">arr_total_any_wt =</span> arr_total_any <span class="sc">*</span> weight,</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Indicate reporting by county-agency</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">reporting =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(arr_total_any), <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Aggregate variables to the county level.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarize by county. We want both an unweighted and weighted count of agencies reporting, as well as percentage reporting</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>arrests_all_county <span class="ot">&lt;-</span> arrests_all_agency_county <span class="sc">%&gt;%</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, state, county) <span class="sc">%&gt;%</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">n</span>(), </span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_wt =</span> <span class="fu">sum</span>(weight), <span class="co"># check how weighted agencies compares to total agencies</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_reporting =</span> <span class="fu">sum</span>(reporting),</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_reporting_wt =</span> <span class="fu">sum</span>(reporting <span class="sc">*</span> weight),</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_core_city =</span> <span class="fu">sum</span>(core_city),</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_core_city_rpt =</span> <span class="fu">sum</span>(core_city<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> reporting<span class="sc">==</span><span class="dv">1</span>),</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">across</span>(arr_total_any, <span class="sc">~</span><span class="fu">sum</span>(.x, <span class="at">na.rm=</span><span class="cn">TRUE</span>))</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">agencies_reporting =</span> n_reporting <span class="sc">/</span> n,</span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">agencies_reporting_wt =</span> n_reporting_wt <span class="sc">/</span> n_wt,</span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">core_reporting =</span> n_core_city_rpt <span class="sc">/</span> n_core_city,</span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">core_reporting =</span> <span class="fu">ifelse</span>(<span class="fu">is.nan</span>(core_reporting), <span class="cn">NA</span>, core_reporting),</span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">GEOID =</span> <span class="fu">str_c</span>(state, county)</span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Join total arrests back to juvenile arrest file.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Join all arrests and juvenile arrests</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>arrests_county <span class="ot">&lt;-</span> <span class="fu">left_join</span>(</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> arrests_county, <span class="co"># juvenile arrests</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> arrests_all_county,</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"year"</span>, <span class="st">"GEOID"</span>, <span class="st">"state"</span>, <span class="st">"county"</span>)</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="calculate-rates-of-juvenile-arrests-per-100000-juveniles" class="level2">
<h2 class="anchored" data-anchor-id="calculate-rates-of-juvenile-arrests-per-100000-juveniles">6. Calculate rates of juvenile arrests per 100,000 juveniles</h2>
<p>Each instance of an arrest, citation, or summons for an offense is counted as an arrest. Note that an individual can be arrested more than once and therefore the rates constructed are of arrests, not of persons arrested. Arrest rates are calculated for all offense types available in NIBRS data, including offenses against property, persons, and society.</p>
<p>First load the demographic information for each county and for each year 2021-2022. This file was created using 5 year ACS data in <code>01_agency_geo_county.Rmd</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>county_demo <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"07_safety"</span>, <span class="st">"modified data"</span>, <span class="st">"all_county_demo.csv"</span>))</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename variables for sex and age subgroups to match existing naming conventions of this file.</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Note that future updates could consider renaming these variables when pulled from the ACS in `01_agency_geo_county.Rmd` but I didn't have the foresight so I'm just renaming them now</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>county_demo <span class="ot">&lt;-</span> county_demo <span class="sc">%&gt;%</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">age_1017_male =</span> sex_1017_m,</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">age_1017_female =</span> sex_1017_f,</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">age_1017_1014 =</span> age_1014_all,</span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">age_1017_1517 =</span> age_1517_all</span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Join the county-level juvenile arrest data onto the county-level population and demographic information from ACS. All 6,287 observations match.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>arrests_county_demo <span class="ot">&lt;-</span> <span class="fu">left_join</span>(</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> county_demo,</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> arrests_county,</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"year"</span>, <span class="st">"GEOID"</span>)</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Calculate arrest rates per 100,000 juveniles. We also calculate rates for the following subgroups:</p>
<ul>
<li>Race: white, Black, Hispanic, Asian/other</li>
<li>Sex: male, female</li>
<li>Age: ages 10-14, ages 15-17</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate arrest rates (per 100,000 people) and subgroups</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>arrest_rates_county <span class="ot">&lt;-</span> arrests_county_demo <span class="sc">%&gt;%</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Total ages 10-17</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">rate_juv_arrest =</span> arr_total <span class="sc">/</span> age_1017 <span class="sc">*</span> <span class="dv">100000</span>,</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Race/ethnicity subgroups</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">rate_juv_arrest_white =</span> race_white <span class="sc">/</span> age_1017_white <span class="sc">*</span> <span class="dv">100000</span>,</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">rate_juv_arrest_black =</span> race_black <span class="sc">/</span> age_1017_black <span class="sc">*</span> <span class="dv">100000</span>,</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">rate_juv_arrest_hispanic  =</span> ethn_hispanic <span class="sc">/</span> age_1017_hispanic <span class="sc">*</span> <span class="dv">100000</span>,</span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">rate_juv_arrest_asian_other =</span> race_asian_other <span class="sc">/</span> age_1017_asian_other <span class="sc">*</span> <span class="dv">100000</span>,</span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sex subgroups</span></span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">rate_juv_arrest_male =</span> sex_male <span class="sc">/</span> age_1017_male <span class="sc">*</span> <span class="dv">100000</span>,</span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">rate_juv_arrest_female =</span> sex_female <span class="sc">/</span> age_1017_female <span class="sc">*</span> <span class="dv">100000</span>,</span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Age subgroups</span></span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">rate_juv_arrest_1014 =</span> age_10_14 <span class="sc">/</span> age_1017_1014 <span class="sc">*</span> <span class="dv">100000</span>,</span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">rate_juv_arrest_1517 =</span> age_15_17 <span class="sc">/</span> age_1017_1517 <span class="sc">*</span> <span class="dv">100000</span></span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Replace the rates of observations with a population less than 30 with <code>NA</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Suppress data using populations &lt; 30 people</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>arrest_rates_county <span class="ot">&lt;-</span> arrest_rates_county <span class="sc">%&gt;%</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">rate_juv_arrest =</span> <span class="fu">ifelse</span>(age_1017 <span class="sc">&lt;</span> <span class="dv">30</span>, <span class="cn">NA</span>, rate_juv_arrest),</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">rate_juv_arrest_white =</span> <span class="fu">ifelse</span>(age_1017_white <span class="sc">&lt;</span> <span class="dv">30</span>, <span class="cn">NA</span>, rate_juv_arrest_white),</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">rate_juv_arrest_black =</span> <span class="fu">ifelse</span>(age_1017_black <span class="sc">&lt;</span> <span class="dv">30</span>, <span class="cn">NA</span>, rate_juv_arrest_black),</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">rate_juv_arrest_hispanic =</span> <span class="fu">ifelse</span>(age_1017_hispanic <span class="sc">&lt;</span> <span class="dv">30</span>, <span class="cn">NA</span>, rate_juv_arrest_hispanic),</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">rate_juv_arrest_asian_other =</span> <span class="fu">ifelse</span>(age_1017_asian_other <span class="sc">&lt;</span> <span class="dv">30</span>, <span class="cn">NA</span>, rate_juv_arrest_asian_other),</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">rate_juv_arrest_male =</span> <span class="fu">ifelse</span>(age_1017_male <span class="sc">&lt;</span> <span class="dv">30</span>, <span class="cn">NA</span>, rate_juv_arrest_male),</span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">rate_juv_arrest_female =</span> <span class="fu">ifelse</span>(age_1017_female <span class="sc">&lt;</span> <span class="dv">30</span>, <span class="cn">NA</span>, rate_juv_arrest_female),</span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">rate_juv_arrest_1014 =</span> <span class="fu">ifelse</span>(age_1017_1014 <span class="sc">&lt;</span> <span class="dv">30</span>, <span class="cn">NA</span>, rate_juv_arrest_1014),</span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">rate_juv_arrest_1517 =</span> <span class="fu">ifelse</span>(age_1017_1517 <span class="sc">&lt;</span> <span class="dv">30</span>, <span class="cn">NA</span>, rate_juv_arrest_1517)</span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="construct-quality-indicators" class="level2">
<h2 class="anchored" data-anchor-id="construct-quality-indicators">7. Construct quality indicators</h2>
<p>This section constructs an indicator used to assess the quality of data for each place. Places with 100% of agencies reporting are coded as 1; places with 80% or more of agencies reporting OR 100% of core agencies reporting are coded as 2; places with less than 80% of agencies reporting are coded as 3; places with 0% of agencies reporting (or no agencies in the place) are coded as <code>NA</code>.</p>
<p>Construct the quality indicator.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare all reporting plus core reporting</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>arrest_rates_county <span class="ot">&lt;-</span> arrest_rates_county <span class="sc">%&gt;%</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">rate_juv_arrest_quality =</span> <span class="fu">case_when</span>(</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>      agencies_reporting <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>      agencies_reporting <span class="sc">&gt;=</span> <span class="fl">0.8</span> <span class="sc">|</span> core_reporting<span class="sc">==</span><span class="dv">1</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>      agencies_reporting <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="dv">3</span>,</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>      agencies_reporting <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="cn">NA_real_</span></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">rate_juv_arrest_quality =</span> <span class="fu">ifelse</span>(age_1017 <span class="sc">&lt;</span> <span class="dv">30</span>, <span class="cn">NA</span>, rate_juv_arrest_quality)</span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>arrest_rates_county <span class="ot">&lt;-</span> arrest_rates_county <span class="sc">%&gt;%</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">"rate"</span>), </span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>                <span class="sc">~</span><span class="fu">ifelse</span>(<span class="fu">is.na</span>(rate_juv_arrest_quality), <span class="cn">NA</span>, .x)),</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>         )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The plurality of counties had less than 80 percent of agencies reporting.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>arrest_rates_county <span class="sc">%&gt;%</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> rate_juv_arrest_quality)) <span class="sc">+</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="juvenile-arrests-county-all_files/figure-html/unnamed-chunk-42-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="validation" class="level2">
<h2 class="anchored" data-anchor-id="validation">8. Validation</h2>
<p>This section performs several checks on the calculated rates of juvenile arrests.</p>
<p>Check the distribution of rates of juvenile arrests for 2021-2022, both overall and by subgroup. All rates are plausible.</p>
<p>Checking arrest rates for all juveniles</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  arrest_rates_county<span class="sc">$</span>rate_juv_arrest,</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">probs =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.2</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>, <span class="fl">0.8</span>, <span class="fl">0.9</span>, <span class="fl">0.99</span>, <span class="dv">1</span>),</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">na.rm =</span> <span class="cn">TRUE</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         0%         20%         40%         60%         80%         90% 
    0.00000    93.02326   383.72985   858.46509  1776.49537  2778.88700 
        99%        100% 
 7443.76843 19600.49938 </code></pre>
</div>
</div>
<p>Checking arrest rates for white juveniles</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>  arrest_rates_county<span class="sc">$</span>rate_juv_arrest_white,</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">probs =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.2</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>, <span class="fl">0.8</span>, <span class="fl">0.9</span>, <span class="fl">0.99</span>, <span class="dv">1</span>),</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">na.rm =</span> <span class="cn">TRUE</span></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         0%         20%         40%         60%         80%         90% 
    0.00000    45.89469   298.35903   707.86569  1553.82908  2549.16242 
        99%        100% 
 6566.81433 13704.81928 </code></pre>
</div>
</div>
<p>Checking arrest rates for Black juveniles. The maximum for all years is 178,274.24. Rates are of arrests, not persons arrested, so this value is plausible and indicates some people were arrested more than once.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>  arrest_rates_county<span class="sc">$</span>rate_juv_arrest_black,</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">probs =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.2</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>, <span class="fl">0.8</span>, <span class="fl">0.9</span>, <span class="fl">0.99</span>, <span class="dv">1</span>),</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">na.rm =</span> <span class="cn">TRUE</span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         0%         20%         40%         60%         80%         90% 
     0.0000    124.5678   1290.0190   2942.7912   7000.0000  12734.6261 
        99%        100% 
 57161.4907 178274.2380 </code></pre>
</div>
</div>
<p>Checking arrest rates for Hispanic juveniles</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>  arrest_rates_county<span class="sc">$</span>rate_juv_arrest_hispanic,</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">probs =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.2</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>, <span class="fl">0.8</span>, <span class="fl">0.9</span>, <span class="fl">0.99</span>, <span class="dv">1</span>),</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">na.rm =</span> <span class="cn">TRUE</span></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        0%        20%        40%        60%        80%        90%        99% 
    0.0000     0.0000     0.0000   229.4252  1013.6822  1909.0206  6343.7657 
      100% 
24528.3019 </code></pre>
</div>
</div>
<p>Checking arrest rates for Asian/other race juveniles</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>  arrest_rates_county<span class="sc">$</span>rate_juv_arrest_asian_other,</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">probs =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.2</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>, <span class="fl">0.8</span>, <span class="fl">0.9</span>, <span class="fl">0.99</span>, <span class="dv">1</span>),</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">na.rm =</span> <span class="cn">TRUE</span></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        0%        20%        40%        60%        80%        90%        99% 
    0.0000     0.0000     0.0000     0.0000   126.8611   547.7720  8149.6454 
      100% 
71111.1111 </code></pre>
</div>
</div>
<p>Checking arrest rates for male juveniles</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>  arrest_rates_county<span class="sc">$</span>rate_juv_arrest_male,</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">probs =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.2</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>, <span class="fl">0.8</span>, <span class="fl">0.9</span>, <span class="fl">0.99</span>, <span class="dv">1</span>),</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">na.rm =</span> <span class="cn">TRUE</span></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        0%        20%        40%        60%        80%        90%        99% 
    0.0000   117.0859   549.8218  1197.7059  2416.0802  3770.2663  9067.7590 
      100% 
20558.3756 </code></pre>
</div>
</div>
<p>Checking arrest rates for female juveniles</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>  arrest_rates_county<span class="sc">$</span>rate_juv_arrest_female,</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">probs =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.2</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>, <span class="fl">0.8</span>, <span class="fl">0.9</span>, <span class="fl">0.99</span>, <span class="dv">1</span>),</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">na.rm =</span> <span class="cn">TRUE</span></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        0%        20%        40%        60%        80%        90%        99% 
    0.0000     0.0000   185.3826   503.2003  1168.5914  1942.0007  6160.2536 
      100% 
19591.8367 </code></pre>
</div>
</div>
<p>Checking arrest rates for juveniles aged 10-14</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>  arrest_rates_county<span class="sc">$</span>rate_juv_arrest_1014,</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">probs =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.2</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>, <span class="fl">0.8</span>, <span class="fl">0.9</span>, <span class="fl">0.99</span>, <span class="dv">1</span>),</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">na.rm =</span> <span class="cn">TRUE</span></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        0%        20%        40%        60%        80%        90%        99% 
    0.0000     0.0000   136.8322   411.5416   962.2885  1641.1577  4950.1961 
      100% 
16573.5568 </code></pre>
</div>
</div>
<p>Checking arrest rates for juveniles aged 15-17</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>  arrest_rates_county<span class="sc">$</span>rate_juv_arrest_1517,</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">probs =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.2</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>, <span class="fl">0.8</span>, <span class="fl">0.9</span>, <span class="fl">0.99</span>, <span class="dv">1</span>),</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">na.rm =</span> <span class="cn">TRUE</span></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        0%        20%        40%        60%        80%        90%        99% 
    0.0000   158.0267   715.1032  1593.9989  3163.1478  4884.1004 12728.2804 
      100% 
43060.4982 </code></pre>
</div>
</div>
<p>There is more missingness in 2021 than 2022. This makes sense, because more agencies report to NIBRS over time.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>arrest_rates_county <span class="sc">%&gt;%</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(rate_juv_arrest)) <span class="sc">%&gt;%</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
# Groups:   year [2]
   year     n
  &lt;dbl&gt; &lt;int&gt;
1  2021   454
2  2022   307</code></pre>
</div>
</div>
<p>The rate of missingness is the same for the quality variable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>arrest_rates_county <span class="sc">%&gt;%</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(rate_juv_arrest_quality)) <span class="sc">%&gt;%</span></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
# Groups:   year [2]
   year     n
  &lt;dbl&gt; &lt;int&gt;
1  2021   454
2  2022   307</code></pre>
</div>
</div>
</section>
<section id="save-and-write-out-data" class="level2">
<h2 class="anchored" data-anchor-id="save-and-write-out-data">9. Save and write out Data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>arrest_rates_county_all <span class="ot">&lt;-</span> arrest_rates_county <span class="sc">%&gt;%</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(year, state, county, <span class="fu">starts_with</span>(<span class="st">"rate"</span>), <span class="fu">starts_with</span>(<span class="st">"age_1017"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Create a subset without subgroup rates and write out this data set</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co"># File with only total juvenile arrest rates</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>juv_arrest_county <span class="ot">&lt;-</span> arrest_rates_county_all <span class="sc">%&gt;%</span></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>    year,</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>    state,</span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>    county,</span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>    rate_juv_arrest,</span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a>    rate_juv_arrest_quality</span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Write out this data set</span></span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a>juv_arrest_county <span class="sc">%&gt;%</span></span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_csv</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"07_safety"</span>,</span>
<span id="cb80-14"><a href="#cb80-14" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"final"</span>,</span>
<span id="cb80-15"><a href="#cb80-15" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"rate_arrests_county_all.csv"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Create a file that is long by subgroup and write it out</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co"># long form file with juvenile arrest rates by subgroup</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="co"># pivot longer subgroup populations</span></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a><span class="co"># create all row with overall juvenile population and arrest rate</span></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>juv_pop_all_subgroup <span class="ot">&lt;-</span> arrest_rates_county_all <span class="sc">%&gt;%</span></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">age_1017_all =</span> age_1017</span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a>    year, </span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a>    state,</span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a>    county, </span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a>    age_1017_all, </span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a>    age_1017_white, </span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a>    age_1017_black, </span>
<span id="cb81-15"><a href="#cb81-15" aria-hidden="true" tabindex="-1"></a>    age_1017_asian_other,</span>
<span id="cb81-16"><a href="#cb81-16" aria-hidden="true" tabindex="-1"></a>    age_1017_hispanic,</span>
<span id="cb81-17"><a href="#cb81-17" aria-hidden="true" tabindex="-1"></a>    age_1017_male,</span>
<span id="cb81-18"><a href="#cb81-18" aria-hidden="true" tabindex="-1"></a>    age_1017_female,</span>
<span id="cb81-19"><a href="#cb81-19" aria-hidden="true" tabindex="-1"></a>    age_1017_1014,</span>
<span id="cb81-20"><a href="#cb81-20" aria-hidden="true" tabindex="-1"></a>    age_1017_1517,</span>
<span id="cb81-21"><a href="#cb81-21" aria-hidden="true" tabindex="-1"></a>    rate_juv_arrest_quality</span>
<span id="cb81-22"><a href="#cb81-22" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb81-23"><a href="#cb81-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">contains</span>(<span class="st">"age_1017"</span>),</span>
<span id="cb81-24"><a href="#cb81-24" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"subgroup"</span>,</span>
<span id="cb81-25"><a href="#cb81-25" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"age_1017"</span>,</span>
<span id="cb81-26"><a href="#cb81-26" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_drop_na =</span> <span class="cn">TRUE</span>,</span>
<span id="cb81-27"><a href="#cb81-27" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_pattern =</span> <span class="st">"age_1017_(.*)"</span>)</span>
<span id="cb81-28"><a href="#cb81-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-29"><a href="#cb81-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-30"><a href="#cb81-30" aria-hidden="true" tabindex="-1"></a><span class="co"># pivot longer subgroup arrest rates</span></span>
<span id="cb81-31"><a href="#cb81-31" aria-hidden="true" tabindex="-1"></a>juv_arrest_all_subgroup <span class="ot">&lt;-</span> arrest_rates_county_all <span class="sc">%&gt;%</span></span>
<span id="cb81-32"><a href="#cb81-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rate_juv_arrest_all =</span> rate_juv_arrest) <span class="sc">%&gt;%</span></span>
<span id="cb81-33"><a href="#cb81-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb81-34"><a href="#cb81-34" aria-hidden="true" tabindex="-1"></a>    year, </span>
<span id="cb81-35"><a href="#cb81-35" aria-hidden="true" tabindex="-1"></a>    state, </span>
<span id="cb81-36"><a href="#cb81-36" aria-hidden="true" tabindex="-1"></a>    county, </span>
<span id="cb81-37"><a href="#cb81-37" aria-hidden="true" tabindex="-1"></a>    rate_juv_arrest_all, </span>
<span id="cb81-38"><a href="#cb81-38" aria-hidden="true" tabindex="-1"></a>    rate_juv_arrest_white, </span>
<span id="cb81-39"><a href="#cb81-39" aria-hidden="true" tabindex="-1"></a>    rate_juv_arrest_black,</span>
<span id="cb81-40"><a href="#cb81-40" aria-hidden="true" tabindex="-1"></a>    rate_juv_arrest_asian_other,</span>
<span id="cb81-41"><a href="#cb81-41" aria-hidden="true" tabindex="-1"></a>    rate_juv_arrest_hispanic,</span>
<span id="cb81-42"><a href="#cb81-42" aria-hidden="true" tabindex="-1"></a>    rate_juv_arrest_male,</span>
<span id="cb81-43"><a href="#cb81-43" aria-hidden="true" tabindex="-1"></a>    rate_juv_arrest_female,</span>
<span id="cb81-44"><a href="#cb81-44" aria-hidden="true" tabindex="-1"></a>    rate_juv_arrest_1014,</span>
<span id="cb81-45"><a href="#cb81-45" aria-hidden="true" tabindex="-1"></a>    rate_juv_arrest_1517</span>
<span id="cb81-46"><a href="#cb81-46" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb81-47"><a href="#cb81-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">contains</span>(<span class="st">"rate_juv_arrest_"</span>), </span>
<span id="cb81-48"><a href="#cb81-48" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"subgroup"</span>,</span>
<span id="cb81-49"><a href="#cb81-49" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"rate_juv_arrest"</span>,</span>
<span id="cb81-50"><a href="#cb81-50" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_drop_na =</span> <span class="cn">TRUE</span>,</span>
<span id="cb81-51"><a href="#cb81-51" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_pattern =</span> <span class="st">"rate_juv_arrest_(.*)"</span>)</span>
<span id="cb81-52"><a href="#cb81-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-53"><a href="#cb81-53" aria-hidden="true" tabindex="-1"></a><span class="co"># combine into one file</span></span>
<span id="cb81-54"><a href="#cb81-54" aria-hidden="true" tabindex="-1"></a><span class="co"># replace quality indicators with missing if subgroup population &lt; 30</span></span>
<span id="cb81-55"><a href="#cb81-55" aria-hidden="true" tabindex="-1"></a>juv_arrest_county_all_subgroup <span class="ot">&lt;-</span> <span class="fu">left_join</span>(</span>
<span id="cb81-56"><a href="#cb81-56" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> juv_pop_all_subgroup,</span>
<span id="cb81-57"><a href="#cb81-57" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> juv_arrest_all_subgroup,</span>
<span id="cb81-58"><a href="#cb81-58" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"year"</span>, <span class="st">"state"</span>, <span class="st">"county"</span>, <span class="st">"subgroup"</span>)</span>
<span id="cb81-59"><a href="#cb81-59" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb81-60"><a href="#cb81-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb81-61"><a href="#cb81-61" aria-hidden="true" tabindex="-1"></a>    <span class="at">subgroup_type =</span> <span class="fu">case_when</span>(</span>
<span id="cb81-62"><a href="#cb81-62" aria-hidden="true" tabindex="-1"></a>      subgroup <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"white"</span>, <span class="st">"black"</span>, <span class="st">"asian_other"</span>, <span class="st">"hispanic"</span>) <span class="sc">~</span> <span class="st">"race-ethnicity"</span>,</span>
<span id="cb81-63"><a href="#cb81-63" aria-hidden="true" tabindex="-1"></a>      subgroup <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"male"</span>, <span class="st">"female"</span>) <span class="sc">~</span> <span class="st">"sex"</span>,</span>
<span id="cb81-64"><a href="#cb81-64" aria-hidden="true" tabindex="-1"></a>      subgroup <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"1014"</span>, <span class="st">"1517"</span>) <span class="sc">~</span> <span class="st">"age"</span></span>
<span id="cb81-65"><a href="#cb81-65" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb81-66"><a href="#cb81-66" aria-hidden="true" tabindex="-1"></a>    <span class="at">rate_juv_arrest_quality =</span> <span class="fu">ifelse</span>(age_1017 <span class="sc">&lt;</span> <span class="dv">30</span>, <span class="cn">NA</span>, rate_juv_arrest_quality)) <span class="sc">%&gt;%</span></span>
<span id="cb81-67"><a href="#cb81-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>age_1017)</span>
<span id="cb81-68"><a href="#cb81-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-69"><a href="#cb81-69" aria-hidden="true" tabindex="-1"></a><span class="co"># Write out this data set</span></span>
<span id="cb81-70"><a href="#cb81-70" aria-hidden="true" tabindex="-1"></a>juv_arrest_county_all_subgroup <span class="sc">%&gt;%</span></span>
<span id="cb81-71"><a href="#cb81-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_csv</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"07_safety"</span>,</span>
<span id="cb81-72"><a href="#cb81-72" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"final"</span>,</span>
<span id="cb81-73"><a href="#cb81-73" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"rate_arrests_county_all_subgroup.csv"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>