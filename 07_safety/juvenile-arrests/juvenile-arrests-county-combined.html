<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Vincent Pancini">
<meta name="dcterms.date" content="2025-03-19">

<title>Juvenile Arrests - County</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="juvenile-arrests-county-combined_files/libs/clipboard/clipboard.min.js"></script>
<script src="juvenile-arrests-county-combined_files/libs/quarto-html/quarto.js"></script>
<script src="juvenile-arrests-county-combined_files/libs/quarto-html/popper.min.js"></script>
<script src="juvenile-arrests-county-combined_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="juvenile-arrests-county-combined_files/libs/quarto-html/anchor.min.js"></script>
<link href="juvenile-arrests-county-combined_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="juvenile-arrests-county-combined_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="juvenile-arrests-county-combined_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="juvenile-arrests-county-combined_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="juvenile-arrests-county-combined_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Juvenile Arrests - County</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Vincent Pancini </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">March 19, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<style>
@import url('https://fonts.googleapis.com/css?family=Lato&display=swap');
</style>
<p><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato"></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen =</span> <span class="dv">999</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidylog)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(urbnthemes)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"functions"</span>, <span class="st">"testing"</span>, <span class="st">"evaluate_final_data.R"</span>))</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">set_urbn_defaults</span>(<span class="at">style =</span> <span class="st">"print"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This metric represents the county-level rate of juvenile arrests per 100,00 juveniles (age 10-17) for years 2021-2023.</p>
<p>The rest of this program is organized as follows:</p>
<ol start="0" type="1">
<li>Background and changes</li>
<li>Manually download NIBRS arrest data</li>
<li>Clean and append NIBRS arrest data</li>
<li>Aggregate arrests from individual to agency-level</li>
<li>Aggregate arrests from agency to county-level</li>
<li>Calculate metric</li>
<li>Construct quality indicators</li>
<li>Validation</li>
<li>Save and write out data</li>
</ol>
<p>All data used for the creation of metrics in this program are available on Box <a href="https://urbanorg.box.com/s/3emanjkl5rw1jhcnj3zuiwddt3x6s70u">here</a>. Data stored on Box are only available to Urban Institute researchers.</p>
<p>This file assumes that you have cloned the GitHub repository for this project to your local computer. You can find the project repository <a href="https://github.com/UI-Research/mobility-from-poverty">here</a> and learn how to clone a repository <a href="https://docs.github.com/en/repositories/creating-and-managing-repositories/cloning-a-repository">here</a>.</p>
<section id="background-and-changes" class="level1">
<h1>0. Background and Changes</h1>
<p>This section provides background information for the data used to create this metric and describes changes from the previous round of metric updates.</p>
<section id="background" class="level2">
<h2 class="anchored" data-anchor-id="background">0.1 Background</h2>
<p>The creation of this metric relies on data from the FBI’s National Incident-Based Reporting System (NIBRS) data. To learn more about the data, see criminologist Jacob Kaplan’s book <a href="https://ucrbook.com/nibrs-overview.html">“Decoding FBI Crime Data”</a>. There are two important things to consider in the creation of this metric:</p>
<ol type="1">
<li>Most police agencies do not report NIBRS data prior to 2021. In 2019, only 8,500 out of approximately 18,000 police agencies in the United States (covering about 45% of the US population) reported NIBRS data. Therefore, we do not create metrics using this data from years prior to 2021. Many agencies still do not submit data to NIBRS, and those that do may not submit complete information, so this metric is inherently inaccurate.</li>
<li>Data may become more comprehensive over time as more agencies report their information. E.g., the full 2022 NIBRS data may not be available until later in 2023. Therefore, previous years should be re-run with each metric update, and the values for the same year are not expected to match in newer metric updates.</li>
</ol>
<p>We use criminologist Jacob Kaplan’s pre-processed NIBRS data available <a href="https://dataverse.harvard.edu/dataverse/ucrdata">here</a> instead of raw data downloaded directly from the FBI. Instructions for downloading the data are included in the next section.</p>
<p>The age bracket of ages 10 to 17 was chosen for this metric because the majority of states have an age of adult criminal liability of 18, at least one state has a minimum age of criminal liability of 12, and arrests of very young children are unlikely. Each instance of an arrest, citation, or summons for an offense is counted as an arrest. An individual can be arrested more than once, and therefore rates constructed are of arrests and not of persons arrested. Arrest rates are calculated for all offense types available in NIBRS data, including offenses against property, persons, and society.</p>
</section>
<section id="changes-from-previous-round-of-updates" class="level2">
<h2 class="anchored" data-anchor-id="changes-from-previous-round-of-updates">0.2 Changes from previous round of updates</h2>
<ul>
<li>Added the newest year of data, 2023.</li>
<li>Previous versions of the metric relied on two files: One that created population weights for each agency in order to more accurately aggregate agency-level crimes to the county-level, and one that actually calculated the metric. I’ve integrated the two programs into one in this round of updates to be more straightforward and intuitive.</li>
<li>Access to the data changed from OpenICPSR to Harvard Dataverse, and the storage format of the data changed. Therefore, the section of the program that reads in the data has changed.</li>
<li>The code for this metric used to contain a section that classified crimes into <code>violent</code> and <code>property</code> crimes. However, this classification isn’t used in the calculation of juvenile arrest rates and has been removed in this version.</li>
<li>Last update, the codes for <code>race</code> and <code>ethnicity</code> were not consistent between the Group A and Group B files. There was no codebook to describe the values, but I used my best judgement to recode them. The variables in the data have the same values this year, so this section was removed.</li>
</ul>
</section>
</section>
<section id="instructions-to-download-both-nibrs-arrest-segments" class="level1">
<h1>1. Instructions to download both NIBRS arrest segments</h1>
<p>This section describes the steps for manually downloading the NIBRS data segments necessary for this metric.</p>
<p>We get arrest counts from two segments of the NIBRS: the Arrestee Segment and the Group B Arrest Report Segment. There are two categories of offenses reported in the NIBRS: Group A (incidents like assault and homicide) and Group B (incidents like bad checks and disorderly conduct). The two categories have different reporting requirements. Group A offenses must include relevant incident data represented in multiple segments (Administrative, Offense, Property, Victim, Offender, and Arrestee) while Group B reports include only arrest data. These are mutually exclusive observations; <a href="https://ucrbook.com/arrestee.html">a single arrest cannot be in both segments</a>. We have to use both the Arrestee segment and the Group B segment to get the full count of arrests.</p>
<p>Accessing these data requires completing a license/data use agreement. Therefore, we do not directly download the data in this program. Manually downloading these data is a five-step process, but you will only need to do each of these steps once for the creation of this metric:</p>
<section id="arrestee-segment" class="level2">
<h2 class="anchored" data-anchor-id="arrestee-segment">1.1 Arrestee Segment</h2>
<ol type="1">
<li>Navigate to the National Incident-Based Reporting System (NIBRS) - Arrestee Segment webpage on Harvard Dataverse <a href="https://dataverse.harvard.edu/dataset.xhtml?persistentId=doi:10.7910/DVN/ZULQVE&amp;version=1.0">here</a>.</li>
<li>For each year you need to download, click on the relevant <code>.rds</code> file (e.g., <code>nibrs_arrestee_segment_YYYY.rds</code>).</li>
<li>Towards the top right of the screen, select <code>Access File</code> and, from the dropdown menu, select <code>Original File Format</code> under <code>Download Options</code>.</li>
<li>Complete the <code>License/Data Use Agreement</code> by entering your <code>Name</code>, <code>Email</code>, <code>Institution</code>, <code>Position</code>, and the <code>Additional Questions</code> (<code>How will this data be used (e.g. personal project, academic paper, for-profit project)</code>, <code>What is your research question?</code>, and <code>Do you agree to cite the data properly if used in publications?</code>).</li>
<li>Move the zip file from your <code>Downloads</code> folder to the <code>\mobility-from-poverty\07_safety\data\arrestee-segment</code> directory.</li>
</ol>
</section>
<section id="group-b-arrest-report-segment" class="level2">
<h2 class="anchored" data-anchor-id="group-b-arrest-report-segment">1.2 Group B Arrest Report Segment</h2>
<ol type="1">
<li>Navigate to the National Incident-Based Reporting System (NIBRS) - Group B Arrest Report Segment webpage on Harvard Dataverse <a href="https://dataverse.harvard.edu/dataset.xhtml?persistentId=doi:10.7910/DVN/ZULQVE&amp;version=1.0">here</a>.</li>
<li>For each year you need to download, click on the relevant <code>.rds</code> file (e.g., <code>nibrs_group_b_arrest_report_segment_YYYY.rds</code>).</li>
<li>Towards the top right of the screen, select <code>Access File</code> and, from the dropdown menu, select <code>Original File Format</code> under <code>Download Options</code>.</li>
<li>Complete the <code>License/Data Use Agreement</code> by entering your <code>Name</code>, <code>Email</code>, <code>Institution</code>, <code>Position</code>, and the <code>Additional Questions</code> (<code>How will this data be used (e.g. personal project, academic paper, for-profit project)</code>, <code>What is your research question?</code>, and <code>Do you agree to cite the data properly if used in publications?</code>).</li>
<li>Move the zip file from your <code>Downloads</code> folder to the <code>\mobility-from-poverty\07_safety\data\group-b-arrest-report-segment</code> directory.</li>
</ol>
</section>
</section>
<section id="read-in-clean-and-append-both-nibrs-arrest-segments" class="level1">
<h1>2. Read in, clean, and append both NIBRS arrest segments</h1>
<p>This section reads in, cleans, and appends the NIBRS Arrest Segment and Group B Arrest Report Segment data for 2021-2023.</p>
<section id="read-and-clean-files-for-2021-2023-from-the-arrestee-segment" class="level2">
<h2 class="anchored" data-anchor-id="read-and-clean-files-for-2021-2023-from-the-arrestee-segment">2.1 Read and clean files for 2021-2023 from the Arrestee Segment</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># List all files in the Arrestee Segment folder (Group A)</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>file_list <span class="ot">&lt;-</span> <span class="fu">list.files</span>(here<span class="sc">::</span><span class="fu">here</span>(</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"07_safety"</span>, <span class="st">"data"</span>, <span class="st">"arrestee-segment"</span>),</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">pattern =</span> <span class="st">"[.]rds$"</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Read in Group A files and append them</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>arrests_a <span class="ot">&lt;-</span> file_list <span class="sc">|&gt;</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(basename) <span class="sc">|&gt;</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map_df</span>(readRDS)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Select only necessary variables from Group A and filter to ages 10-17</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>arrests_a_clean <span class="ot">&lt;-</span> arrests_a <span class="sc">|&gt;</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    year, </span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    ori, <span class="co"># ORI is a unique agency identifier</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    age_of_arrestee,</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    sex_of_arrestee, </span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    race_of_arrestee, </span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>    ethnicity_of_arrestee</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">age_of_arrestee =</span> <span class="fu">as.numeric</span>(age_of_arrestee)</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>NA values are introduced above when converting <code>age_of_arrestee</code> to a numeric variable because there are two character values: <code>over 98 years old</code> and <code>unknown</code>. This is fine. They won’t be included in the juvenile arrest rates, but the observations will still be used later to calculate the percentage of agencies that report any arrest data which is used in the construction of the quality indicator.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>arrests_a <span class="sc">|&gt;</span> <span class="fu">group_by</span>(age_of_arrestee) <span class="sc">|&gt;</span> <span class="fu">count</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 100 × 2
# Groups:   age_of_arrestee [100]
   age_of_arrestee     n
   &lt;chr&gt;           &lt;int&gt;
 1 01                 31
 2 02                  6
 3 03                 10
 4 04                 13
 5 05                 42
 6 06                 91
 7 07                254
 8 08                631
 9 09               1495
10 10               5191
# ℹ 90 more rows</code></pre>
</div>
</div>
</section>
<section id="read-and-clean-files-for-2021-2023-from-the-group-b-arrest-report-segment" class="level2">
<h2 class="anchored" data-anchor-id="read-and-clean-files-for-2021-2023-from-the-group-b-arrest-report-segment">2.2 Read and clean files for 2021-2023 from the Group B Arrest Report Segment</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># List all files in the Arrest Report Segment folder (Group B)</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>file_list <span class="ot">&lt;-</span> <span class="fu">list.files</span>(here<span class="sc">::</span><span class="fu">here</span>(</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"07_safety"</span>, <span class="st">"data"</span>, <span class="st">"group-b-arrest-report-segment"</span>),</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">pattern =</span> <span class="st">"[.]rds$"</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Read in Group B files and append them</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="do">## I read these files in using a different method than the Group A arrests, because the variable `automatic_weapon_indicator_2` has inconsistent data types across the files. We don't use this variable anyway.</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>arrests_b <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">rbindlist</span>(<span class="fu">lapply</span>(file_list, readRDS), <span class="at">fill =</span> <span class="cn">TRUE</span>)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Select only necessary variables from Group B and filter to ages 10-17</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>arrests_b_clean <span class="ot">&lt;-</span> arrests_b <span class="sc">|&gt;</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    year, </span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    ori, <span class="co"># ORI is a unique agency identifier</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    age_of_arrestee, </span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    sex_of_arrestee, </span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    race_of_arrestee, </span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    ethnicity_of_arrestee</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">age_of_arrestee =</span> <span class="fu">as.numeric</span>(age_of_arrestee)</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>NA values are introduced above when converting <code>age_of_arrestee</code> to a numeric variable because there are two character values: <code>over 98 years old</code> and <code>unknown</code>. This is fine. They won’t be included in the juvenile arrest rates, but the observations will still be used later to calculate the percentage of agencies that report any arrest data which is used in the construction of the quality indicator.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>arrests_b <span class="sc">|&gt;</span> <span class="fu">group_by</span>(age_of_arrestee) <span class="sc">|&gt;</span> <span class="fu">count</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 100 × 2
# Groups:   age_of_arrestee [100]
   age_of_arrestee     n
   &lt;chr&gt;           &lt;int&gt;
 1 01                 33
 2 02                 17
 3 03                 15
 4 04                 21
 5 05                 36
 6 06                110
 7 07                194
 8 08                329
 9 09                628
10 10               1563
# ℹ 90 more rows</code></pre>
</div>
</div>
</section>
<section id="append-group-a-and-group-b-files-for-all-arrests" class="level2">
<h2 class="anchored" data-anchor-id="append-group-a-and-group-b-files-for-all-arrests">2.3 Append Group A and Group B files for all arrests</h2>
<p>We are only interested in juvenile arrests for the creation of this metric, but we use all arrests to determine agency reporting rates that are used in construction of the quality values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Append files</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>arrests_all <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(arrests_a_clean, arrests_b_clean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="create-juvenile-arrests-file" class="level2">
<h2 class="anchored" data-anchor-id="create-juvenile-arrests-file">2.4 Create juvenile arrests file</h2>
<p>Filter the file of all arrests to just juveniles between the ages of 10 and 17.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>arrests_juv <span class="ot">&lt;-</span> arrests_all <span class="sc">|&gt;</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(age_of_arrestee <span class="sc">&gt;=</span> <span class="dv">10</span> <span class="sc">&amp;</span> age_of_arrestee <span class="sc">&lt;=</span> <span class="dv">17</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="aggregate-individual-arrest-counts-to-the-reporting-agency-level" class="level1">
<h1>3. Aggregate individual arrest counts to the reporting agency level</h1>
<p>Aggregate arrests by agency and finish race construction</p>
<p>Note that this metric includes the following subgroups by race, sex, and age subgroups, so those subgroups are also aggregated in this section:</p>
<ul>
<li>Race: white, Black, Hispanic, Asian/other</li>
<li>Sex: male, female</li>
<li>Age: ages 10-14, ages 15-17</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>arrests_juv <span class="sc">|&gt;</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(race_of_arrestee, ethnicity_of_arrestee) <span class="sc">|&gt;</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 24 × 3
# Groups:   race_of_arrestee, ethnicity_of_arrestee [24]
   race_of_arrestee               ethnicity_of_arrestee       n
   &lt;chr&gt;                          &lt;chr&gt;                   &lt;int&gt;
 1 american indian/alaskan native hispanic or latino       1195
 2 american indian/alaskan native not hispanic or latino  19177
 3 american indian/alaskan native unknown                  3602
 4 american indian/alaskan native &lt;NA&gt;                     2833
 5 asian                          hispanic or latino        462
 6 asian                          not hispanic or latino   8614
 7 asian                          unknown                  1087
 8 asian                          &lt;NA&gt;                     1395
 9 black                          hispanic or latino       6943
10 black                          not hispanic or latino 328938
# ℹ 14 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>arrests_juv_agency <span class="ot">&lt;-</span> arrests_juv <span class="sc">|&gt;</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, ori) <span class="sc">|&gt;</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">arr_total_juv =</span> <span class="fu">n</span>(),</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Race subgroups</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">arr_white =</span> <span class="fu">sum</span>(race_of_arrestee <span class="sc">==</span> <span class="st">"white"</span>),</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">arr_black =</span> <span class="fu">sum</span>(race_of_arrestee <span class="sc">==</span> <span class="st">"black"</span>),</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">arr_hispanic =</span> <span class="fu">sum</span>(ethnicity_of_arrestee <span class="sc">==</span> <span class="st">"hispanic or latino"</span>),</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">arr_asian_other =</span> <span class="fu">sum</span>(race_of_arrestee <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"asian"</span>, <span class="st">"native hawaiian or other pacific islander"</span>, <span class="st">"american indian/alaskan native"</span>)),</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sex subgroups</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">arr_male =</span> <span class="fu">sum</span>(sex_of_arrestee <span class="sc">==</span> <span class="st">"male"</span>),</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">arr_female =</span> <span class="fu">sum</span>(sex_of_arrestee <span class="sc">==</span> <span class="st">"female"</span>),</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Age subgroups</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">arr_1014 =</span> <span class="fu">sum</span>(age_of_arrestee <span class="sc">&gt;=</span> <span class="dv">10</span> <span class="sc">&amp;</span> age_of_arrestee <span class="sc">&lt;=</span> <span class="dv">14</span>),</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">arr_1517 =</span> <span class="fu">sum</span>(age_of_arrestee <span class="sc">&gt;=</span> <span class="dv">15</span> <span class="sc">&amp;</span> age_of_arrestee <span class="sc">&lt;=</span> <span class="dv">17</span>)</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(file_list, arrests_a, arrests_a_clean, arrests_b, arrests_b_clean, arrests_juv)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="aggregate-arrests-to-county-level" class="level1">
<h1>4. Aggregate arrests to county-level</h1>
<p>This section uses the Batch Header Segment of the NIBRS. The Batch Header Segment includes metadata about each participating police agency. Each individual police agency (identified by originating agency identifier, or ORI) that has submitted any information to NIBRS for that year will appear in this segment only once. Police agencies that have not submitted their data to NIBRS do not appear in this segment, so it is inherently incomplete.</p>
<p>Some police agencies have jurisdiction in more than one county. The Batch Header Segment includes county information for all counties associated with each agency. This section reshapes the file to be long by agency/county-pairs, merges on county population by county and year, and creates weights to more accurately aggregate arrest counts from the agency-level to the county-level.</p>
<section id="instructions-to-manually-download-nibrs-batch-header-segment" class="level2">
<h2 class="anchored" data-anchor-id="instructions-to-manually-download-nibrs-batch-header-segment">4.1 Instructions to manually download NIBRS Batch Header Segment</h2>
<p>Manually downloading these data from the Harvard Dataverse is a five-step process, but you will only need to do each of these steps once for the creation of this metric:</p>
<ol type="1">
<li>Navigate to the Uniform Crime Reporting (UCR) Program Data portal hosted on Harvard Dataverse <a href="https://dataverse.harvard.edu/dataverse/ucrdata">here</a>.</li>
<li>Select National Incident-Based Reporting System - Batch Header Segment <a href="https://dataverse.harvard.edu/dataset.xhtml?persistentId=doi:10.7910/DVN/HUI9WF">here</a>.</li>
<li>Scroll down to <code>nibrs_batch_header_1991_2023.rds</code> and select the file <a href="https://dataverse.harvard.edu/file.xhtml?fileId=10899624&amp;version=2.0">here</a>.</li>
<li>Select <code>Access File</code>
<ul>
<li>Select <code>Gzip Archive</code> under <code>Download Options</code></li>
<li>Agree to the Dataset Terms by entering your <code>Name</code>, <code>Email</code>, <code>Institution</code>, <code>Position</code>, and answer <code>How will this data be used</code>, and then select <code>Accept</code> at the bottom of the pop-up</li>
</ul></li>
<li>This will download an <code>.rds</code> file titled <code>nibrs_batch_header_1991_2023.rds</code>. Move this file to the <code>mobility-from-poverty\07_safety\data\batch-header-segment-and-agencies</code> directory after you have cloned the repository for this project from GitHub.</li>
</ol>
</section>
<section id="load-and-clean-nibrs-batch-header-files" class="level2">
<h2 class="anchored" data-anchor-id="load-and-clean-nibrs-batch-header-files">4.2 Load and clean NIBRS Batch Header Files</h2>
<p>Load Batch Header File</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>batch_header_file_full <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"07_safety"</span>, <span class="st">"data"</span>, <span class="st">"batch-header-segment-and-agencies"</span>, <span class="st">"nibrs_batch_header_1991_2023.rds"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Filter the file to the appropriate year, select relevant necessary, and rename as necessary.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>batch_header_file <span class="ot">&lt;-</span> batch_header_file_full <span class="sc">|&gt;</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    year <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2021</span>, <span class="dv">2022</span>, <span class="dv">2023</span>),</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># number_of_months_reported != "0"</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    ori,</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    agency_indicator,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    year,</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">state_name =</span> state,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    state_abbreviation,</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>    city_name,</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>    core_city,</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># A single agency may have jurisdiction in up to five counties. We keep all counties. </span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">county_fips_1 =</span> fips_county_code_1,</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">county_fips_2 =</span> fips_county_code_2,</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">county_fips_3 =</span> fips_county_code_3,</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">county_fips_4 =</span> fips_county_code_4,</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">county_fips_5 =</span> fips_county_code_5</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Edit county FIPS codes to have three digits</span></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">"county_fips_"</span>),</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>           <span class="sc">~</span> <span class="fu">str_pad</span>(.x, <span class="dv">3</span>, <span class="at">side =</span> <span class="st">"left"</span>, <span class="at">pad =</span> <span class="st">"0"</span>))</span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Change the values for core city indicator from <code>Y</code>/<code>N</code> to <code>0</code>/<code>1</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>batch_header_file <span class="ot">&lt;-</span> batch_header_file <span class="sc">|&gt;</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">core_city =</span> <span class="fu">case_when</span>(</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>      core_city<span class="sc">==</span><span class="st">"Y"</span> <span class="sc">~</span> <span class="fu">as.numeric</span>(<span class="dv">1</span>),</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>      core_city<span class="sc">==</span><span class="st">"N"</span> <span class="sc">~</span> <span class="fu">as.numeric</span>(<span class="dv">0</span>),</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_real_</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Clean geography information on the batch header file.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># See what states/territories are included</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>batch_header_file <span class="sc">|&gt;</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(state_name, state_abbreviation) <span class="sc">|&gt;</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 54 × 3
# Groups:   state_name, state_abbreviation [54]
   state_name           state_abbreviation     n
   &lt;chr&gt;                &lt;chr&gt;              &lt;int&gt;
 1 Alabama              AL                  1453
 2 Alaska               AK                   141
 3 Arizona              AZ                   403
 4 Arkansas             AR                  1026
 5 California           CA                  2669
 6 Colorado             CO                   892
 7 Connecticut          CT                   372
 8 Delaware             DE                   224
 9 District of Columbia DC                     9
10 Florida              FL                  2477
# ℹ 44 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>batch_header_file <span class="ot">&lt;-</span> batch_header_file <span class="sc">|&gt;</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Remove US territories by name because no FIPS codes</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>state_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Guam"</span>, <span class="st">"Puerto Rico"</span>, <span class="st">"Virgin Islands"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The NIBRS data abbreviates Nebraska as "NB" instead of its correct abbreviation "NE"</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">state_abbreviation =</span> <span class="fu">if_else</span>(state_abbreviation<span class="sc">==</span><span class="st">"NB"</span>, <span class="st">"NE"</span>, state_abbreviation),</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Wyoming is also named "Wyoming V2" but it is unclear why</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">state_name =</span> <span class="fu">if_else</span>(state_name<span class="sc">==</span><span class="st">"Wyoming V2"</span>, <span class="st">"Wyoming"</span>, state_name)</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The batch header file identifies state by name and abbreviation, but not state FIPS code. We manually add on state FIPS codes to the batch header file</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create crosswalk of state FIPS codes to state names/abbreviations</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>state_fips_xw <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>state_fips, <span class="sc">~</span>state_abbreviation, <span class="sc">~</span>state_name,</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"01"</span>, <span class="st">"AL"</span>, <span class="st">"Alabama"</span>,</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"02"</span>, <span class="st">"AK"</span>, <span class="st">"Alaska"</span>,</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"04"</span>, <span class="st">"AZ"</span>, <span class="st">"Arizona"</span>, </span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"05"</span>, <span class="st">"AR"</span>, <span class="st">"Arkansas"</span>,   </span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"06"</span>, <span class="st">"CA"</span>, <span class="st">"California"</span>, </span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"08"</span>, <span class="st">"CO"</span>, <span class="st">"Colorado"</span>,</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">"09"</span>, <span class="st">"CT"</span>, <span class="st">"Connecticut"</span>,</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">"10"</span>, <span class="st">"DE"</span>, <span class="st">"Delaware"</span>,</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">"11"</span>, <span class="st">"DC"</span>, <span class="st">"District of Columbia"</span>,</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>  <span class="st">"12"</span>, <span class="st">"FL"</span>, <span class="st">"Florida"</span>,</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>  <span class="st">"13"</span>, <span class="st">"GA"</span>, <span class="st">"Georgia"</span>,    </span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>  <span class="st">"15"</span>, <span class="st">"HI"</span>, <span class="st">"Hawaii"</span>,</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>  <span class="st">"16"</span>, <span class="st">"ID"</span>, <span class="st">"Idaho"</span>,</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>  <span class="st">"17"</span>, <span class="st">"IL"</span>, <span class="st">"Illinois"</span>,</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>  <span class="st">"18"</span>, <span class="st">"IN"</span>, <span class="st">"Indiana"</span>,</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>  <span class="st">"19"</span>, <span class="st">"IA"</span>, <span class="st">"Iowa"</span>,   </span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>  <span class="st">"20"</span>, <span class="st">"KS"</span>, <span class="st">"Kansas"</span>, </span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>  <span class="st">"21"</span>, <span class="st">"KY"</span>, <span class="st">"Kentucky"</span>,   </span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>  <span class="st">"22"</span>, <span class="st">"LA"</span>, <span class="st">"Louisiana"</span>,</span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>  <span class="st">"23"</span>, <span class="st">"ME"</span>, <span class="st">"Maine"</span>,</span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>  <span class="st">"24"</span>, <span class="st">"MD"</span>, <span class="st">"Maryland"</span>,</span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a>  <span class="st">"25"</span>, <span class="st">"MA"</span>, <span class="st">"Massachusetts"</span>,</span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>  <span class="st">"26"</span>, <span class="st">"MI"</span>, <span class="st">"Michigan"</span>,   </span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a>  <span class="st">"27"</span>, <span class="st">"MN"</span>, <span class="st">"Minnesota"</span>,  </span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a>  <span class="st">"28"</span>, <span class="st">"MS"</span>, <span class="st">"Mississippi"</span>,    </span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>  <span class="st">"29"</span>, <span class="st">"MO"</span>, <span class="st">"Missouri"</span>,   </span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a>  <span class="st">"30"</span>, <span class="st">"MT"</span>, <span class="st">"Montana"</span>,    </span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a>  <span class="st">"31"</span>, <span class="st">"NE"</span>, <span class="st">"Nebraska"</span>,   </span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a>  <span class="st">"32"</span>, <span class="st">"NV"</span>, <span class="st">"Nevada"</span>, </span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a>  <span class="st">"33"</span>, <span class="st">"NH"</span>, <span class="st">"New Hampshire"</span>,  </span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a>  <span class="st">"34"</span>, <span class="st">"NJ"</span>, <span class="st">"New Jersey"</span>, </span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a>  <span class="st">"35"</span>, <span class="st">"NM"</span>, <span class="st">"New Mexico"</span>, </span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a>  <span class="st">"36"</span>, <span class="st">"NY"</span>, <span class="st">"New York"</span>,   </span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a>  <span class="st">"37"</span>, <span class="st">"NC"</span>, <span class="st">"North Carolina"</span>,</span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a>  <span class="st">"38"</span>, <span class="st">"ND"</span>, <span class="st">"North Dakota"</span>,   </span>
<span id="cb20-39"><a href="#cb20-39" aria-hidden="true" tabindex="-1"></a>  <span class="st">"39"</span>, <span class="st">"OH"</span>, <span class="st">"Ohio"</span>,   </span>
<span id="cb20-40"><a href="#cb20-40" aria-hidden="true" tabindex="-1"></a>  <span class="st">"40"</span>, <span class="st">"OK"</span>, <span class="st">"Oklahoma"</span>,   </span>
<span id="cb20-41"><a href="#cb20-41" aria-hidden="true" tabindex="-1"></a>  <span class="st">"41"</span>, <span class="st">"OR"</span>, <span class="st">"Oregon"</span>, </span>
<span id="cb20-42"><a href="#cb20-42" aria-hidden="true" tabindex="-1"></a>  <span class="st">"42"</span>, <span class="st">"PA"</span>, <span class="st">"Pennsylvania"</span>,   </span>
<span id="cb20-43"><a href="#cb20-43" aria-hidden="true" tabindex="-1"></a>  <span class="st">"44"</span>, <span class="st">"RI"</span>, <span class="st">"Rhode Island"</span>,   </span>
<span id="cb20-44"><a href="#cb20-44" aria-hidden="true" tabindex="-1"></a>  <span class="st">"45"</span>, <span class="st">"SC"</span>, <span class="st">"South Carolina"</span>, </span>
<span id="cb20-45"><a href="#cb20-45" aria-hidden="true" tabindex="-1"></a>  <span class="st">"46"</span>, <span class="st">"SD"</span>, <span class="st">"South Dakota"</span>,</span>
<span id="cb20-46"><a href="#cb20-46" aria-hidden="true" tabindex="-1"></a>  <span class="st">"47"</span>, <span class="st">"TN"</span>, <span class="st">"Tennessee"</span>,</span>
<span id="cb20-47"><a href="#cb20-47" aria-hidden="true" tabindex="-1"></a>  <span class="st">"48"</span>, <span class="st">"TX"</span>, <span class="st">"Texas"</span>,  </span>
<span id="cb20-48"><a href="#cb20-48" aria-hidden="true" tabindex="-1"></a>  <span class="st">"49"</span>, <span class="st">"UT"</span>, <span class="st">"Utah"</span>,   </span>
<span id="cb20-49"><a href="#cb20-49" aria-hidden="true" tabindex="-1"></a>  <span class="st">"50"</span>, <span class="st">"VT"</span>, <span class="st">"Vermont"</span>,    </span>
<span id="cb20-50"><a href="#cb20-50" aria-hidden="true" tabindex="-1"></a>  <span class="st">"51"</span>, <span class="st">"VA"</span>, <span class="st">"Virginia"</span>,   </span>
<span id="cb20-51"><a href="#cb20-51" aria-hidden="true" tabindex="-1"></a>  <span class="st">"53"</span>, <span class="st">"WA"</span>, <span class="st">"Washington"</span>, </span>
<span id="cb20-52"><a href="#cb20-52" aria-hidden="true" tabindex="-1"></a>  <span class="st">"54"</span>, <span class="st">"WV"</span>, <span class="st">"West Virginia"</span>,  </span>
<span id="cb20-53"><a href="#cb20-53" aria-hidden="true" tabindex="-1"></a>  <span class="st">"55"</span>, <span class="st">"WI"</span>, <span class="st">"Wisconsin"</span>,  </span>
<span id="cb20-54"><a href="#cb20-54" aria-hidden="true" tabindex="-1"></a>  <span class="st">"56"</span>, <span class="st">"WY"</span>, <span class="st">"Wyoming"</span></span>
<span id="cb20-55"><a href="#cb20-55" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-56"><a href="#cb20-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-57"><a href="#cb20-57" aria-hidden="true" tabindex="-1"></a><span class="co"># Join state FIPS codes onto the batch header file</span></span>
<span id="cb20-58"><a href="#cb20-58" aria-hidden="true" tabindex="-1"></a>batch_header_file <span class="ot">&lt;-</span> batch_header_file <span class="sc">|&gt;</span> </span>
<span id="cb20-59"><a href="#cb20-59" aria-hidden="true" tabindex="-1"></a>  tidylog<span class="sc">::</span><span class="fu">left_join</span>(</span>
<span id="cb20-60"><a href="#cb20-60" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> state_fips_xw, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"state_name"</span>, <span class="st">"state_abbreviation"</span>)</span>
<span id="cb20-61"><a href="#cb20-61" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb20-62"><a href="#cb20-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-63"><a href="#cb20-63" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove crosswalk</span></span>
<span id="cb20-64"><a href="#cb20-64" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(batch_header_file_full, state_fips_xw)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="a-exclude-state-police-and-other-state-agencies" class="level3">
<h3 class="anchored" data-anchor-id="a-exclude-state-police-and-other-state-agencies">4.2a Exclude state police and other state agencies</h3>
<p>Check distribution of agency types. There are 7 types of agencies. Note that I’m not sure what an agency indicator of “5” represents, and I can’t find any information about it in the <a href="https://ucrbook.com/">available documentation</a>. In data year 2022, a value of 5 represented “special agencies” (last year’s values shown below), so it could be an error in the pre-processing of this data.</p>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: center;">Value</th>
<th style="text-align: left;">Label</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">0</td>
<td style="text-align: left;">Covered by another agency</td>
</tr>
<tr class="even">
<td style="text-align: center;">1</td>
<td style="text-align: left;">City</td>
</tr>
<tr class="odd">
<td style="text-align: center;">2</td>
<td style="text-align: left;">County</td>
</tr>
<tr class="even">
<td style="text-align: center;">3</td>
<td style="text-align: left;">University or college</td>
</tr>
<tr class="odd">
<td style="text-align: center;">4</td>
<td style="text-align: left;">State Police</td>
</tr>
<tr class="even">
<td style="text-align: center;">5</td>
<td style="text-align: left;">Special Agency</td>
</tr>
<tr class="odd">
<td style="text-align: center;">6</td>
<td style="text-align: left;">Other state agencies</td>
</tr>
<tr class="even">
<td style="text-align: center;">7</td>
<td style="text-align: left;">Tribal agencies</td>
</tr>
<tr class="odd">
<td style="text-align: center;">8</td>
<td style="text-align: left;">Federal agencies</td>
</tr>
</tbody>
</table>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>batch_header_file <span class="sc">|&gt;</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(agency_indicator) <span class="sc">|&gt;</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">percent =</span> n<span class="sc">/</span><span class="fu">nrow</span>(batch_header_file))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       agency_indicator     n    percent
1                     5  2903 0.04440875
2                  city 41892 0.64084442
3                county  9338 0.14284840
4        other agencies  3838 0.05871195
5          state police  3562 0.05448983
6                tribal   662 0.01012697
7 university or college  3175 0.04856968</code></pre>
</div>
</div>
<p>State agencies cover multiple counties, so we remove these agencies for simplicity. Note that in data year 2022, we also removed “other state agencies” but that isn’t a category in data year 2023. They could be included in the new “other agencies” category, but I’m not sure how to be certain, so leaving this category for now.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>batch_header_file <span class="ot">&lt;-</span> batch_header_file <span class="sc">|&gt;</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>agency_indicator <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"state police"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Almost 400 agencies have a missing county FIPS value in each year.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Subset data to examine further</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>bhf_missing_county <span class="ot">&lt;-</span> batch_header_file <span class="sc">|&gt;</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(county_fips_1))</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>bhf_missing_county <span class="sc">|&gt;</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(year)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  year   n
1 2021 367
2 2022 370
3 2023 376</code></pre>
</div>
</div>
</section>
</section>
<section id="use-leaic-to-identify-some-of-the-agencies-with-missing-county-information" class="level2">
<h2 class="anchored" data-anchor-id="use-leaic-to-identify-some-of-the-agencies-with-missing-county-information">4.3 Use LEAIC to identify some of the agencies with missing county information</h2>
<p>The goal of this section is to match a county FIPS code onto every agency in the 2022 NIBRS Batch Header Segment. The Batch Header Segment already includes a county FIPS code for most agencies, but some agencies still do not have a county associated with them. We attempt to get county information for these agencies using the Law Enforcement Agency Identifiers Crosswalk (LEAIC).</p>
<section id="a-background-on-leaic-and-manual-download" class="level3">
<h3 class="anchored" data-anchor-id="a-background-on-leaic-and-manual-download">4.3a Background on LEAIC and manual download</h3>
<p>To address the agencies that are missing county information, we use the 2012 Law Enforcement Agency Identifiers Crosswalk (LEAIC)</p>
<p>The LEAIC facilitates linking reported crime data with socio-economic data. The LEAIC file is available for download from the National Archive of Criminal Justice Data (NACJD) available through ICPSR at the following link:</p>
<ul>
<li><a href="https://www.icpsr.umich.edu/web/NACJD/studies/35158">LEAIC</a></li>
</ul>
<p>Note that 2012 is the most recent year for which this crosswalk is available. This may present issues in harmonizing data across years, because some counties have changed since 2012. Future updates should check if a more recent crosswalk is available yet.</p>
<p>Accessing these data requires an ICPSR account. Manually downloading these data is a five-step process, but you will only need to do each of these steps once for the creation of this metric:</p>
<ol type="1">
<li>Create an ICPSR account <a href="https://www.icpsr.umich.edu/cgi-bin/newacct">here</a>.</li>
<li>Navigate to the National Archive of Criminal Justice Data (NACJD) landing page for the LEAIC <a href="https://www.icpsr.umich.edu/web/NACJD/studies/35158">here</a>).</li>
<li>Select <code>Download</code>
<ul>
<li>Select <code>Delimited</code></li>
<li>Select <code>Agree</code> on the <code>Terms of Use</code></li>
</ul></li>
<li>Sign into your ICPSR account</li>
<li>This will download a zip file titled <code>ICPSR_35158-V2</code>. Unzip the file and navigate to <code>ICPSR_35158\DS0001\35158-0001-Data.tsv</code>. Move this file to the <code>mobility-from-poverty\07_safety\data\batch-header-segment-and-agencies</code> directory after you have cloned the repository for this project from GitHub.</li>
</ol>
</section>
<section id="b-load-and-clean-leaic" class="level3">
<h3 class="anchored" data-anchor-id="b-load-and-clean-leaic">4.3b Load and clean LEAIC</h3>
<p>After downloading the LEAIC, read it in. This file has a county FIPS linked to every reporting agency.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read in crosswalk</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>leaic <span class="ot">&lt;-</span> <span class="fu">read_tsv</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"07_safety"</span>, <span class="st">"data"</span>, <span class="st">"batch-header-segment-and-agencies"</span>, <span class="st">"35158-0001-Data.tsv"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>971 of the 1113 agency-years with missing county information from the Batch Header File are in the LEAIC.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check how many agencies with missing county are in LEAIC</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(bhf_missing_county<span class="sc">$</span>ori <span class="sc">%in%</span> leaic<span class="sc">$</span>ORI9)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 971</code></pre>
</div>
</div>
<p>Limit file to necessary variables and rename. We use the codebook (<code>ICPSR_35158\DS0001\35158-0001-Codebook</code>) to determine what each variable represents.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>leaic <span class="ot">&lt;-</span> leaic <span class="sc">|&gt;</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">ori =</span> ORI9,</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># state = FIPS_ST,</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">county_fips_1 =</span> FIPS_COUNTY</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Remove agencies with invalid ORI</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ori <span class="sc">!=</span> <span class="st">"-1"</span>) <span class="co"># Not in UCR/NCIC </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="c-join-leaic-onto-nibrs-data-with-missing-counties-by-agency-identifier" class="level3">
<h3 class="anchored" data-anchor-id="c-join-leaic-onto-nibrs-data-with-missing-counties-by-agency-identifier">4.3c Join LEAIC onto NIBRS data with missing counties by agency identifier</h3>
<p>Join the LEAIC to the NIBRS Batch Header Segment by agency. 142 agencies still have no county after using the county information from LEAIC. Most of these observations are tribal or other agencies.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>bhf_missing_county <span class="ot">&lt;-</span> <span class="fu">left_join</span>(</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> bhf_missing_county <span class="sc">|&gt;</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span><span class="fu">starts_with</span>(<span class="st">"county_fips"</span>)),</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> leaic,</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"ori"</span>)</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>bhf_missing_county <span class="sc">|&gt;</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(county_fips_1)) <span class="sc">|&gt;</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(agency_indicator)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  agency_indicator  n
1                5  3
2   other agencies 58
3           tribal 81</code></pre>
</div>
</div>
</section>
<section id="d-use-leaic-to-create-final-agency-county-data" class="level3">
<h3 class="anchored" data-anchor-id="d-use-leaic-to-create-final-agency-county-data">4.3d Use LEAIC to create final agency-county data</h3>
<p>Replace county information in NIBRS data for observations that initially had a missing county value with the updated county information from LEAIC.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>batch_header_file <span class="ot">&lt;-</span> batch_header_file <span class="sc">|&gt;</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Drop the NIBRS agencies with a missing county value</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(county_fips_1)) <span class="sc">|&gt;</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Append those agencies back onto main data with the county info gleaned from LEAIC</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(bhf_missing_county)</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove obsolete files</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a><span class="co">#rm(leaic, bhf_missing_county)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="create-population-weights-for-each-agency" class="level2">
<h2 class="anchored" data-anchor-id="create-population-weights-for-each-agency">4.4 Create population weights for each agency</h2>
<p>This section relies on the <code>tidycensus</code> package, which requires a Census API key. You can acquire a key <a href="https://api.census.gov/data/key_signup.html">here</a> and learn more about installing your key <a href="https://walker-data.com/tidycensus/reference/census_api_key.html">here</a>. Replace <code>[YOUR-KEY-HERE]</code> in the code below with your Census API key (leave the quotation marks).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set Census API once</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="co"># tidycensus::census_api_key("[YOUR-KEY-HERE]", install=TRUE, overwrite = TRUE)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="a-check-acs-variable-names-and-identify-those-we-need" class="level3">
<h3 class="anchored" data-anchor-id="a-check-acs-variable-names-and-identify-those-we-need">4.4a Check ACS variable names and identify those we need</h3>
<p>Load ACS variables for our first and last years. Manually explore each file and spot check several observations. The naming conventions of ACS variables do not seem to change during our time period. Note that if they did we would need to split up the code that reads in the years below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check ACS variables for the first and last years to see if they change over time</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>variables_fy <span class="ot">&lt;-</span> tidycensus<span class="sc">::</span><span class="fu">load_variables</span>(<span class="dv">2021</span>, <span class="st">"acs5"</span>)</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>variables_ly <span class="ot">&lt;-</span> tidycensus<span class="sc">::</span><span class="fu">load_variables</span>(<span class="dv">2023</span>, <span class="st">"acs5"</span>)</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>test_fy <span class="ot">&lt;-</span> variables_fy <span class="sc">|&gt;</span> <span class="fu">filter</span>(name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"B01003_001"</span>, <span class="st">"B01001_005"</span>, <span class="st">"B01001_006"</span>, <span class="st">"B01001_029"</span>, <span class="st">"B01001_030"</span>, <span class="st">"B01001A_005"</span>, <span class="st">"B01001B_005"</span>, <span class="st">"B01001C_005"</span>, <span class="st">"B01001D_005"</span>, <span class="st">"B01001E_005"</span>))</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(test_fy)</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>test_ly <span class="ot">&lt;-</span> variables_ly <span class="sc">|&gt;</span> <span class="fu">filter</span>(name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"B01003_001"</span>, <span class="st">"B01001_005"</span>, <span class="st">"B01001_006"</span>, <span class="st">"B01001_029"</span>, <span class="st">"B01001_030"</span>, <span class="st">"B01001A_005"</span>, <span class="st">"B01001B_005"</span>, <span class="st">"B01001C_005"</span>, <span class="st">"B01001D_005"</span>, <span class="st">"B01001E_005"</span>))</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(test_ly)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="b-pull-5-year-acs-data-for-each-year-at-the-county-level" class="level3">
<h3 class="anchored" data-anchor-id="b-pull-5-year-acs-data-for-each-year-at-the-county-level">4.4b Pull 5-year ACS data for each year at the county level</h3>
<p>First create vectors for years and variables of interest, which are county-level population totals for the entire county and for our subgroups.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a list of all our years</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>years <span class="ot">&lt;-</span> <span class="fu">lst</span>(<span class="dv">2021</span>, <span class="dv">2022</span>, <span class="dv">2023</span>)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a vector for our ACS variables of interest</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>my_vars <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">total_people =</span> <span class="st">"B01003_001"</span>,</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">age_m_1014 =</span> <span class="st">"B01001_005"</span>, </span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">age_m_1517 =</span> <span class="st">"B01001_006"</span>,</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">age_f_1014 =</span> <span class="st">"B01001_029"</span>, </span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">age_f_1517 =</span> <span class="st">"B01001_030"</span>,</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">age_m_1014_white =</span> <span class="st">"B01001A_005"</span>, </span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">age_m_1014_black =</span> <span class="st">"B01001B_005"</span>,</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">age_m_1014_aian =</span> <span class="st">"B01001C_005"</span>, </span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">age_m_1014_asin =</span> <span class="st">"B01001D_005"</span>,</span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">age_m_1014_nhpi =</span> <span class="st">"B01001E_005"</span>, </span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">age_m_1014_othr =</span> <span class="st">"B01001F_005"</span>,</span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">age_m_1014_twom =</span> <span class="st">"B01001G_005"</span>,</span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">age_m_1014_white_nh =</span> <span class="st">"B01001H_005"</span>,</span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">age_m_1014_hispanic =</span> <span class="st">"B01001I_005"</span>,</span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">age_m_1517_white =</span> <span class="st">"B01001A_006"</span>, </span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">age_m_1517_black =</span> <span class="st">"B01001B_006"</span>,</span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">age_m_1517_aian =</span> <span class="st">"B01001C_006"</span>, </span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">age_m_1517_asin =</span> <span class="st">"B01001D_006"</span>,</span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">age_m_1517_nhpi =</span> <span class="st">"B01001E_006"</span>, </span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">age_m_1517_othr =</span> <span class="st">"B01001F_006"</span>,</span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">age_m_1517_twom =</span> <span class="st">"B01001G_006"</span>,</span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">age_m_1517_white_nh =</span> <span class="st">"B01001H_006"</span>, </span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">age_m_1517_hispanic =</span> <span class="st">"B01001I_006"</span>,</span>
<span id="cb35-29"><a href="#cb35-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">age_f_1014_white =</span> <span class="st">"B01001A_020"</span>, </span>
<span id="cb35-30"><a href="#cb35-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">age_f_1014_black =</span> <span class="st">"B01001B_020"</span>,</span>
<span id="cb35-31"><a href="#cb35-31" aria-hidden="true" tabindex="-1"></a>  <span class="at">age_f_1014_aian =</span> <span class="st">"B01001C_020"</span>, </span>
<span id="cb35-32"><a href="#cb35-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">age_f_1014_asin =</span> <span class="st">"B01001D_020"</span>,</span>
<span id="cb35-33"><a href="#cb35-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">age_f_1014_nhpi =</span> <span class="st">"B01001E_020"</span>, </span>
<span id="cb35-34"><a href="#cb35-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">age_f_1014_othr =</span> <span class="st">"B01001F_020"</span>,</span>
<span id="cb35-35"><a href="#cb35-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">age_f_1014_twom =</span> <span class="st">"B01001G_020"</span>,</span>
<span id="cb35-36"><a href="#cb35-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">age_f_1014_white_nh =</span> <span class="st">"B01001H_020"</span>,</span>
<span id="cb35-37"><a href="#cb35-37" aria-hidden="true" tabindex="-1"></a>  <span class="at">age_f_1014_hispanic =</span> <span class="st">"B01001I_020"</span>,</span>
<span id="cb35-38"><a href="#cb35-38" aria-hidden="true" tabindex="-1"></a>  <span class="at">age_f_1517_white =</span> <span class="st">"B01001A_021"</span>, </span>
<span id="cb35-39"><a href="#cb35-39" aria-hidden="true" tabindex="-1"></a>  <span class="at">age_f_1517_black =</span> <span class="st">"B01001B_021"</span>,</span>
<span id="cb35-40"><a href="#cb35-40" aria-hidden="true" tabindex="-1"></a>  <span class="at">age_f_1517_aian =</span> <span class="st">"B01001C_021"</span>, </span>
<span id="cb35-41"><a href="#cb35-41" aria-hidden="true" tabindex="-1"></a>  <span class="at">age_f_1517_asin =</span> <span class="st">"B01001D_021"</span>,</span>
<span id="cb35-42"><a href="#cb35-42" aria-hidden="true" tabindex="-1"></a>  <span class="at">age_f_1517_nhpi =</span> <span class="st">"B01001E_021"</span>,</span>
<span id="cb35-43"><a href="#cb35-43" aria-hidden="true" tabindex="-1"></a>  <span class="at">age_f_1517_othr =</span> <span class="st">"B01001F_021"</span>,</span>
<span id="cb35-44"><a href="#cb35-44" aria-hidden="true" tabindex="-1"></a>  <span class="at">age_f_1517_twom =</span> <span class="st">"B01001G_021"</span>,</span>
<span id="cb35-45"><a href="#cb35-45" aria-hidden="true" tabindex="-1"></a>  <span class="at">age_f_1517_white_nh =</span> <span class="st">"B01001H_021"</span>, </span>
<span id="cb35-46"><a href="#cb35-46" aria-hidden="true" tabindex="-1"></a>  <span class="at">age_f_1517_hispanic =</span> <span class="st">"B01001I_021"</span></span>
<span id="cb35-47"><a href="#cb35-47" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then pull 5-year ACS data at the county level for each year</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Pull data</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>acs_pops_full <span class="ot">&lt;-</span> <span class="fu">map_dfr</span>(</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  years,</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span> tidycensus<span class="sc">::</span><span class="fu">get_acs</span>(</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">geography =</span> <span class="st">"county"</span>,</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">variables =</span> my_vars,</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">year =</span> .x,</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">survey =</span> <span class="st">"acs5"</span>,</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">output =</span> <span class="st">"wide"</span>,</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">geometry =</span> <span class="cn">FALSE</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create a year variable for each year</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">.id =</span> <span class="st">"year"</span></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove Puerto Rico from ACS data</span></span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>acs_pops <span class="ot">&lt;-</span> acs_pops_full <span class="sc">|&gt;</span></span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">state_fips =</span> <span class="fu">substr</span>(GEOID, <span class="dv">1</span>, <span class="dv">2</span>),</span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>         <span class="at">county_fips =</span> <span class="fu">substr</span>(GEOID, <span class="dv">3</span>, <span class="dv">5</span>)) <span class="sc">|&gt;</span></span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(state_fips <span class="sc">!=</span> <span class="st">"72"</span>)</span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove obsolete files</span></span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a><span class="co">#rm(variables_fy, variables_ly, years, my_vars)</span></span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(years, my_vars, acs_pops_full)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="c-clean-acs-data-and-create-subgroups" class="level3">
<h3 class="anchored" data-anchor-id="c-clean-acs-data-and-create-subgroups">4.4c Clean ACS data and create subgroups</h3>
<p>Clean variable names and drop margins of error</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>acs_pops <span class="ot">&lt;-</span> acs_pops <span class="sc">|&gt;</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_with</span>(<span class="sc">~</span> <span class="fu">sub</span>(<span class="st">"E$"</span>, <span class="st">""</span>, .x), <span class="fu">everything</span>()) <span class="sc">|&gt;</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="fu">ends_with</span>(<span class="st">"M"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For the rate of juvenile arrests per 100,000 juveniles metric, we want subgroups by race, sex, and age subgroups. These are subgroups of all observations ages 10-17, so the sum of each subgroup should equal the total number of observations ages 10-17.</p>
<ul>
<li>Race: white, Black, Hispanic, Asian/other</li>
<li>Sex: male, female</li>
<li>Age: ages 10-14, ages 15-17</li>
</ul>
<p>Note that there is a Non-Hispanic white category, but not a Non-Hispanic category for other races (Black, Asian, etc.). This means that the categories will have a small but non-zero overlap. The race/ethnicity categories actually used in the <code>juvenile-arrests</code> metric are white, Black, Asian/other, and Hispanic. These are not mutually exclusive (e.g., someone could be counted as both Black and Hispanic), which matches the population denominators created here (this is because ACS doesn’t have counts of non-Hispanic Black or other non-Hispanic races other than white).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the total for ages 10-17 and the race, sex, and age subgroups</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>acs_pops <span class="ot">&lt;-</span> acs_pops <span class="sc">|&gt;</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Total age 10-17</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">pop_1017 =</span> age_m_1014 <span class="sc">+</span> age_m_1517 <span class="sc">+</span> age_f_1014 <span class="sc">+</span> age_f_1517,</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Race subgroups</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">pop_1017_white =</span> age_m_1014_white <span class="sc">+</span> age_m_1517_white <span class="sc">+</span> age_f_1014_white <span class="sc">+</span> age_f_1517_white,</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">pop_1017_black =</span> age_m_1014_black <span class="sc">+</span> age_m_1517_black <span class="sc">+</span> age_f_1014_black <span class="sc">+</span> age_f_1517_black,</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">pop_1017_aian =</span> age_m_1014_aian <span class="sc">+</span> age_m_1517_aian <span class="sc">+</span> age_f_1014_aian <span class="sc">+</span> age_f_1517_aian,</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">pop_1017_asin =</span> age_m_1014_asin <span class="sc">+</span> age_m_1517_asin <span class="sc">+</span> age_f_1014_asin <span class="sc">+</span> age_f_1517_asin,</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">pop_1017_nhpi =</span> age_m_1014_nhpi <span class="sc">+</span> age_m_1517_nhpi <span class="sc">+</span> age_f_1014_nhpi <span class="sc">+</span> age_f_1517_nhpi,</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">pop_1017_othr =</span> age_m_1014_othr <span class="sc">+</span> age_m_1517_othr <span class="sc">+</span> age_f_1014_othr <span class="sc">+</span> age_f_1517_othr,</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">pop_1017_hispanic =</span> age_m_1014_hispanic <span class="sc">+</span> age_m_1517_hispanic <span class="sc">+</span> age_f_1014_hispanic <span class="sc">+</span> age_f_1517_hispanic,</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sex subgroups</span></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">pop_1017_male =</span> age_m_1014 <span class="sc">+</span> age_m_1517,</span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">pop_1017_female =</span> age_f_1014 <span class="sc">+</span> age_f_1517,</span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Age subgroups</span></span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">pop_1017_1014 =</span> age_m_1014 <span class="sc">+</span> age_f_1014,</span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">pop_1017_1517 =</span> age_m_1517 <span class="sc">+</span> age_f_1517</span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Edit race variables   </span></span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Manually create "two or more" race variable</span></span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">pop_1017_twom =</span> pop_1017 <span class="sc">-</span> pop_1017_white <span class="sc">-</span> pop_1017_black <span class="sc">-</span> </span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a>      pop_1017_aian <span class="sc">-</span> pop_1017_asin <span class="sc">-</span> pop_1017_nhpi <span class="sc">-</span> pop_1017_othr,</span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Combine all asian races, other races, and two or more races</span></span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">pop_1017_asian_other =</span> pop_1017_aian <span class="sc">+</span> pop_1017_asin <span class="sc">+</span> pop_1017_nhpi <span class="sc">+</span></span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a>      pop_1017_othr <span class="sc">+</span> pop_1017_twom</span>
<span id="cb38-29"><a href="#cb38-29" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb38-30"><a href="#cb38-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="fu">starts_with</span>(<span class="st">"age"</span>), pop_1017_aian, pop_1017_asin, pop_1017_nhpi, pop_1017_othr, pop_1017_twom))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="d-join-bhf-onto-acs-data" class="level3">
<h3 class="anchored" data-anchor-id="d-join-bhf-onto-acs-data">4.4d Join BHF onto ACS data</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Reshape NIBRS data to be long by agency AND county</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>batch_header_file_long <span class="ot">&lt;-</span> batch_header_file <span class="sc">|&gt;</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">"county_fips_"</span>),</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"county_fips"</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Some agencies only have jurisdiction in a single county, and their values for `county_fips_2`, `county_fips_3`, etc. are missing. These observations are still reshaped above (i.e., each agency observation becomes five agency-county observations), but we only want to keep actual agency-county pairs, so we drop the observations that are missing county.</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>(county_fips) <span class="sc">|&gt;</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(name))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Join agency/county pairs onto the ACS county/year-level population and demographics</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create GEOID</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>batch_header_file_long <span class="ot">&lt;-</span> batch_header_file_long <span class="sc">|&gt;</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">GEOID =</span> <span class="fu">str_c</span>(state_fips, county_fips))</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Join data</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>bhf_acs_joined <span class="ot">&lt;-</span> <span class="fu">left_join</span>(</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> acs_pops <span class="sc">|&gt;</span> </span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(year, GEOID, total_people) <span class="sc">|&gt;</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.numeric</span>(year)),</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> batch_header_file_long,</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>, <span class="st">"year"</span>)</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="e-calculate-weights" class="level3">
<h3 class="anchored" data-anchor-id="e-calculate-weights">4.4e Calculate weights</h3>
<p>For agencies that cover multiple counties, assign weight based on county population (e.g., if Agency A has jurisdiction in both County 1 which has 10,000 people and County 2 which has 5,000 people, the weights will be 0.667 and 0.333, respectively).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make agency weights based on population of counties they cover</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>agency_weights <span class="ot">&lt;-</span> bhf_acs_joined <span class="sc">|&gt;</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(total_people)) <span class="sc">|&gt;</span>  </span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, ori) <span class="sc">|&gt;</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">weight =</span> total_people <span class="sc">/</span> <span class="fu">sum</span>(total_people),</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">weight =</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(ori), <span class="cn">NA</span>, weight)</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="e-join-arrest-counts-onto-the-weight-file-and-multiply-arrest-variables-by-population-weight" class="level3">
<h3 class="anchored" data-anchor-id="e-join-arrest-counts-onto-the-weight-file-and-multiply-arrest-variables-by-population-weight">4.4e Join arrest counts onto the weight file and Multiply arrest variables by population weight</h3>
<p>Join arrests onto the full universe of county-agencies and multiply counts by the agency-county weight.</p>
<p>We expect a lot of unmatched observations from the <code>agency_weights</code> file, because this is derived from the Batch Header Segment. Agencies may be included in the Batch Header Segment if they submitted any information to NIBRS across all segments, but may not have provided information on arrests.</p>
<p>I’m not sure why there are unmatched observations in the <code>arrests_juv_agency</code> file. Theoretically, because an agency included in either arrest segment is by definition included in the Batch Header Segment, all of these observations should match onto the Batch Header Segment.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Join agency-level juvenile arrests onto universe of agencies</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>arrests_juv_agency_county <span class="ot">&lt;-</span> <span class="fu">left_join</span>(</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> agency_weights,</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> arrests_juv_agency, </span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"ori"</span>, <span class="st">"year"</span>)</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Multiply counts by agency-county weight</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">"arr"</span>), <span class="sc">~</span>.x <span class="sc">*</span> weight))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="f-finish-aggregating-from-agency-level-to-county-level" class="level3">
<h3 class="anchored" data-anchor-id="f-finish-aggregating-from-agency-level-to-county-level">4.4f Finish aggregating from agency-level to county-level</h3>
<p>Now that we have joined our agency-level juvenile arrests data onto the full universe of county-agencies, which links agencies to counties and assigns weights for agencies that serve more than one county, we can aggregate the counts from the agency to the county level.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Count number of arrests from reporting agencies in each county</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>arrests_juv_county <span class="ot">&lt;-</span> arrests_juv_agency_county <span class="sc">|&gt;</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, GEOID) <span class="sc">|&gt;</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">"arr"</span>), <span class="sc">~</span><span class="fu">sum</span>(.x, <span class="at">na.rm=</span><span class="cn">TRUE</span>))) <span class="sc">|&gt;</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>
<section id="calculate-juvenile-arrest-rates" class="level1">
<h1>5. Calculate juvenile arrest rates</h1>
<p>Join the county-level juvenile arrest data onto the county-level population and demographic information from ACS.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>arrests_pop_county <span class="ot">&lt;-</span> <span class="fu">left_join</span>(</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> acs_pops,</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> arrests_juv_county <span class="sc">|&gt;</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.character</span>(year)),</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"year"</span>, <span class="st">"GEOID"</span>)</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Calculate arrest rates per 100,000 juveniles. We also calculate rates for the following subgroups:</p>
<ul>
<li>Race: white, Black, Hispanic, Asian/other</li>
<li>Sex: male, female</li>
<li>Age: ages 10-14, ages 15-17</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate arrest rates (per 100,000 people) and subgroups</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>arrest_rates_juv_county <span class="ot">&lt;-</span> arrests_pop_county <span class="sc">|&gt;</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Total ages 10-17</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">rate_juv_arrest =</span> arr_total_juv <span class="sc">/</span> pop_1017 <span class="sc">*</span> <span class="dv">100000</span>,</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Race/ethnicity subgroups</span></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">rate_juv_arrest_white =</span> arr_white <span class="sc">/</span> pop_1017_white <span class="sc">*</span> <span class="dv">100000</span>,</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">rate_juv_arrest_black =</span> arr_black <span class="sc">/</span> pop_1017_black <span class="sc">*</span> <span class="dv">100000</span>,</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">rate_juv_arrest_hispanic  =</span> arr_hispanic <span class="sc">/</span> pop_1017_hispanic <span class="sc">*</span> <span class="dv">100000</span>,</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">rate_juv_arrest_asian_other =</span> arr_asian_other <span class="sc">/</span> pop_1017_asian_other <span class="sc">*</span> <span class="dv">100000</span>,</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sex subgroups</span></span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">rate_juv_arrest_male =</span> arr_male <span class="sc">/</span> pop_1017_male <span class="sc">*</span> <span class="dv">100000</span>,</span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">rate_juv_arrest_female =</span> arr_female <span class="sc">/</span> pop_1017_female <span class="sc">*</span> <span class="dv">100000</span>,</span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Age subgroups</span></span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">rate_juv_arrest_1014 =</span> arr_1014 <span class="sc">/</span> pop_1017_1014 <span class="sc">*</span> <span class="dv">100000</span>,</span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">rate_juv_arrest_1517 =</span> arr_1517 <span class="sc">/</span> pop_1017_1517 <span class="sc">*</span> <span class="dv">100000</span></span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Replace the rates of observations with a population less than 30 with <code>NA</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Suppress data using populations &lt; 30 people</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>arrest_rates_juv_county <span class="ot">&lt;-</span> arrest_rates_juv_county <span class="sc">%&gt;%</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">rate_juv_arrest =</span> <span class="fu">ifelse</span>(pop_1017 <span class="sc">&lt;</span> <span class="dv">30</span>, <span class="cn">NA</span>, rate_juv_arrest),</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">rate_juv_arrest_white =</span> <span class="fu">ifelse</span>(pop_1017_white <span class="sc">&lt;</span> <span class="dv">30</span>, <span class="cn">NA</span>, rate_juv_arrest_white),</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">rate_juv_arrest_black =</span> <span class="fu">ifelse</span>(pop_1017_black <span class="sc">&lt;</span> <span class="dv">30</span>, <span class="cn">NA</span>, rate_juv_arrest_black),</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">rate_juv_arrest_hispanic =</span> <span class="fu">ifelse</span>(pop_1017_hispanic <span class="sc">&lt;</span> <span class="dv">30</span>, <span class="cn">NA</span>, rate_juv_arrest_hispanic),</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">rate_juv_arrest_asian_other =</span> <span class="fu">ifelse</span>(pop_1017_asian_other <span class="sc">&lt;</span> <span class="dv">30</span>, <span class="cn">NA</span>, rate_juv_arrest_asian_other),</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">rate_juv_arrest_male =</span> <span class="fu">ifelse</span>(pop_1017_male <span class="sc">&lt;</span> <span class="dv">30</span>, <span class="cn">NA</span>, rate_juv_arrest_male),</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">rate_juv_arrest_female =</span> <span class="fu">ifelse</span>(pop_1017_female <span class="sc">&lt;</span> <span class="dv">30</span>, <span class="cn">NA</span>, rate_juv_arrest_female),</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">rate_juv_arrest_1014 =</span> <span class="fu">ifelse</span>(pop_1017_1014 <span class="sc">&lt;</span> <span class="dv">30</span>, <span class="cn">NA</span>, rate_juv_arrest_1014),</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">rate_juv_arrest_1517 =</span> <span class="fu">ifelse</span>(pop_1017_1517 <span class="sc">&lt;</span> <span class="dv">30</span>, <span class="cn">NA</span>, rate_juv_arrest_1517)</span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="construct-quality-indicators" class="level1">
<h1>6. Construct quality indicators</h1>
<p>This section constructs an indicator used to assess the quality of data for each place. Places with 100% of agencies reporting are coded as 1; places with 80% or more of agencies reporting OR 100% of core agencies reporting are coded as 2; places with less than 80% of agencies reporting are coded as 3; places with 0% of agencies reporting (or no agencies in the place) are coded as <code>NA</code>.</p>
<section id="calculate-reporting-rate-for-all-agencies" class="level2">
<h2 class="anchored" data-anchor-id="calculate-reporting-rate-for-all-agencies">6.1 Calculate reporting rate for all agencies</h2>
<p>The quality indicator for this metric is based on the number of agencies reporting. We can’t use the agency-level juvenile arrests data for this, because agencies may have zero juvenile arrests and thus be excluded but still have reported arrests for other ages. Instead, we use the full arrests file (i.e., all arrests and not just juvenile arrests) to calculate agency reporting rates.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sum total arrests by year and reporting agency</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>arrests_all_agency <span class="ot">&lt;-</span> arrests_all <span class="sc">%&gt;%</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, ori) <span class="sc">%&gt;%</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">arr_total_allage =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Join total number of arrests for each agency onto the county/agency weight file.</p>
<p>We expect a lot of unmatched observations from the <code>agency_weights</code> file, because this is derived from the Batch Header Segment. Agencies may be included in the Batch Header Segment if they submitted any information to NIBRS across all segments, but may not have provided information on arrests.</p>
<p>I’m not sure why there are unmatched observations in the <code>arrests_all_agency</code> file. Theoretically, because an agency included in either arrest segment is by definition included in the Batch Header Segment, all of these observations should match onto the Batch Header Segment.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Join by year and reporting agency</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>arrests_all_agency_county <span class="ot">&lt;-</span> <span class="fu">left_join</span>(</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> agency_weights,</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> arrests_all_agency,</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"year"</span>, <span class="st">"ori"</span>)</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Weight total arrests and indicate reporting by county-agency pairs.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>arrests_all_agency_county <span class="ot">&lt;-</span> arrests_all_agency_county <span class="sc">|&gt;</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Weight total arrest by county weight</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">arr_total_any_wt =</span> arr_total_allage <span class="sc">*</span> weight,</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Indicate reporting by county-agency</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">reporting =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(arr_total_allage), <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Aggregate variables to the county level.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarize by county. We want both an unweighted and weighted count of agencies reporting, as well as percentage reporting</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>arrests_all_county <span class="ot">&lt;-</span> arrests_all_agency_county <span class="sc">%&gt;%</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, state_fips, county_fips) <span class="sc">%&gt;%</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">n</span>(), </span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_wt =</span> <span class="fu">sum</span>(weight), <span class="co"># check how weighted agencies compares to total agencies</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_reporting =</span> <span class="fu">sum</span>(reporting),</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_reporting_wt =</span> <span class="fu">sum</span>(reporting <span class="sc">*</span> weight),</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_core_city =</span> <span class="fu">sum</span>(core_city),</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_core_city_rpt =</span> <span class="fu">sum</span>(core_city<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> reporting<span class="sc">==</span><span class="dv">1</span>),</span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">across</span>(arr_total_allage, <span class="sc">~</span><span class="fu">sum</span>(.x, <span class="at">na.rm=</span><span class="cn">TRUE</span>))</span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">agencies_reporting =</span> n_reporting <span class="sc">/</span> n,</span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">agencies_reporting_wt =</span> n_reporting_wt <span class="sc">/</span> n_wt,</span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">core_reporting =</span> n_core_city_rpt <span class="sc">/</span> n_core_city,</span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">core_reporting =</span> <span class="fu">ifelse</span>(<span class="fu">is.nan</span>(core_reporting), <span class="cn">NA</span>, core_reporting),</span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">#GEOID = str_c(state, county)</span></span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(year, state_fips, county_fips, agencies_reporting, core_reporting)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Join total arrests back to juvenile arrest file.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>arrests_all_county <span class="ot">&lt;-</span> arrests_all_county <span class="sc">|&gt;</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">GEOID =</span> <span class="fu">str_c</span>(state_fips, county_fips),</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">year =</span> <span class="fu">as.character</span>(year))</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Join all arrests and juvenile arrests</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>arrest_rates_county <span class="ot">&lt;-</span> <span class="fu">left_join</span>(</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> arrest_rates_juv_county, <span class="co"># juvenile arrests</span></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> arrests_all_county,</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"year"</span>, <span class="st">"GEOID"</span>)</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="construct-the-quality-indicator." class="level2">
<h2 class="anchored" data-anchor-id="construct-the-quality-indicator.">6.2 Construct the quality indicator.</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare all reporting plus core reporting</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>arrest_rates_county <span class="ot">&lt;-</span> arrest_rates_county <span class="sc">%&gt;%</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">rate_juv_arrest_quality =</span> <span class="fu">case_when</span>(</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>      agencies_reporting <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>      agencies_reporting <span class="sc">&gt;=</span> <span class="fl">0.8</span> <span class="sc">|</span> core_reporting<span class="sc">==</span><span class="dv">1</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>      agencies_reporting <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="dv">3</span>,</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>      agencies_reporting <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="cn">NA_real_</span></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">rate_juv_arrest_quality =</span> <span class="fu">ifelse</span>(pop_1017 <span class="sc">&lt;</span> <span class="dv">30</span>, <span class="cn">NA</span>, rate_juv_arrest_quality)</span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>arrest_rates_county <span class="ot">&lt;-</span> arrest_rates_county <span class="sc">%&gt;%</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">"rate"</span>), </span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>                <span class="sc">~</span><span class="fu">ifelse</span>(<span class="fu">is.na</span>(rate_juv_arrest_quality), <span class="cn">NA</span>, .x)),</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>         )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The plurality of counties had less than 80 percent of agencies reporting.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>arrest_rates_county <span class="sc">%&gt;%</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> rate_juv_arrest_quality)) <span class="sc">+</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="juvenile-arrests-county-combined_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="validation" class="level1">
<h1>7. Validation</h1>
<p>This section performs several checks on the calculated rates of juvenile arrests.</p>
<p>Check the distribution of rates of juvenile arrests for 2021-2022, both overall and by subgroup. All rates are plausible. Rates are of arrests, not persons arrested, so values greater than 100,000 are plausible and indicates some people in that population group were arrested more than once.</p>
<p>Note that increasing rates over each year reflect more complete data from NIBRS and do not necessarily indicate a rise in juvenile arrests.</p>
<p>Checking arrest rates for all juveniles</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>arrest_rates_county <span class="sc">|&gt;</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">|&gt;</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">quantiles =</span> <span class="fu">list</span>(</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">quantile</span>(rate_juv_arrest, <span class="at">probs =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.2</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>, <span class="fl">0.8</span>, <span class="fl">0.9</span>, <span class="fl">0.99</span>, <span class="dv">1</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(quantiles)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 9
  year   `0%` `20%` `40%` `60%` `80%` `90%` `99%` `100%`
  &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
1 2021      0  84.9  366.  823. 1676. 2712. 7278. 19184.
2 2022      0 108.   437.  951. 1912. 2927. 7500. 20225.
3 2023      0 138.   482. 1020. 2058. 3076. 7833. 24209.</code></pre>
</div>
</div>
<p>Checking arrest rates for white juveniles</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>arrest_rates_county <span class="sc">|&gt;</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">|&gt;</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">quantiles =</span> <span class="fu">list</span>(</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">quantile</span>(rate_juv_arrest_white, <span class="at">probs =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.2</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>, <span class="fl">0.8</span>, <span class="fl">0.9</span>, <span class="fl">0.99</span>, <span class="dv">1</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(quantiles)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 9
  year   `0%` `20%` `40%` `60%` `80%` `90%` `99%` `100%`
  &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
1 2021      0  46.0  283.  685. 1513. 2408. 6412. 12426.
2 2022      0  65.5  349.  777. 1692. 2723. 7145. 12076.
3 2023      0  90.0  401.  886. 1893. 2945. 7182. 15647.</code></pre>
</div>
</div>
<p>Checking arrest rates for Black juveniles.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>arrest_rates_county <span class="sc">|&gt;</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">|&gt;</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">quantiles =</span> <span class="fu">list</span>(</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">quantile</span>(rate_juv_arrest_black, <span class="at">probs =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.2</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>, <span class="fl">0.8</span>, <span class="fl">0.9</span>, <span class="fl">0.99</span>, <span class="dv">1</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(quantiles)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 9
  year   `0%` `20%` `40%` `60%` `80%`  `90%`  `99%`  `100%`
  &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
1 2021      0  43.6 1131. 2767. 6250  11874. 59107. 187649.
2 2022      0 244.  1517. 3333. 7818. 14078. 61484. 116950.
3 2023      0 374.  1818. 3968. 8229. 16562. 69838. 248207.</code></pre>
</div>
</div>
<p>Checking arrest rates for Hispanic juveniles</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>arrest_rates_county <span class="sc">|&gt;</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">|&gt;</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">quantiles =</span> <span class="fu">list</span>(</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">quantile</span>(rate_juv_arrest_hispanic, <span class="at">probs =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.2</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>, <span class="fl">0.8</span>, <span class="fl">0.9</span>, <span class="fl">0.99</span>, <span class="dv">1</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(quantiles)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 9
  year   `0%` `20%` `40%` `60%` `80%` `90%` `99%` `100%`
  &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
1 2021      0     0     0  184.  962. 1786. 6267. 24528.
2 2022      0     0     0  274. 1087. 2056. 6314. 16667.
3 2023      0     0     0  338. 1160. 2182. 7071. 21250 </code></pre>
</div>
</div>
<p>Checking arrest rates for Asian/other race juveniles</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>arrest_rates_county <span class="sc">|&gt;</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">|&gt;</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">quantiles =</span> <span class="fu">list</span>(</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">quantile</span>(rate_juv_arrest_asian_other, <span class="at">probs =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.2</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>, <span class="fl">0.8</span>, <span class="fl">0.9</span>, <span class="fl">0.99</span>, <span class="dv">1</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(quantiles)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 9
  year   `0%` `20%` `40%` `60%` `80%` `90%` `99%` `100%`
  &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
1 2021      0     0     0     0  111.  519. 8812. 71667.
2 2022      0     0     0     0  141.  569. 7258. 55111.
3 2023      0     0     0     0  131.  536. 7460. 45059.</code></pre>
</div>
</div>
<p>Checking arrest rates for male juveniles</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>arrest_rates_county <span class="sc">|&gt;</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">|&gt;</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">quantiles =</span> <span class="fu">list</span>(</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">quantile</span>(rate_juv_arrest_male, <span class="at">probs =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.2</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>, <span class="fl">0.8</span>, <span class="fl">0.9</span>, <span class="fl">0.99</span>, <span class="dv">1</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(quantiles)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 9
  year   `0%` `20%` `40%` `60%` `80%` `90%` `99%` `100%`
  &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
1 2021      0  111.  520. 1132. 2344. 3631. 8938. 18705.
2 2022      0  145.  630. 1309. 2575. 3982. 9372. 21574.
3 2023      0  176.  669. 1423. 2744. 4046. 9454. 25783.</code></pre>
</div>
</div>
<p>Checking arrest rates for female juveniles</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>arrest_rates_county <span class="sc">|&gt;</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">|&gt;</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">quantiles =</span> <span class="fu">list</span>(</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">quantile</span>(rate_juv_arrest_female, <span class="at">probs =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.2</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>, <span class="fl">0.8</span>, <span class="fl">0.9</span>, <span class="fl">0.99</span>, <span class="dv">1</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(quantiles)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 9
  year   `0%` `20%` `40%` `60%` `80%` `90%` `99%` `100%`
  &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
1 2021      0     0  166.  463. 1095. 1756. 5701. 19592.
2 2022      0     0  213.  557. 1263. 2075. 6307. 18919.
3 2023      0     0  246.  619. 1361. 2238. 6176. 22604.</code></pre>
</div>
</div>
<p>Checking arrest rates for juveniles aged 10-14</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>arrest_rates_county <span class="sc">|&gt;</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">|&gt;</span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">quantiles =</span> <span class="fu">list</span>(</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">quantile</span>(rate_juv_arrest_1014, <span class="at">probs =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.2</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>, <span class="fl">0.8</span>, <span class="fl">0.9</span>, <span class="fl">0.99</span>, <span class="dv">1</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(quantiles)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 9
  year   `0%` `20%` `40%` `60%` `80%` `90%` `99%` `100%`
  &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
1 2021      0     0  117.  373.  896. 1594. 5009. 16667.
2 2022      0     0  167.  464. 1081. 1763. 4973.  9177.
3 2023      0     0  205.  524. 1161. 1929. 5120. 11821.</code></pre>
</div>
</div>
<p>Checking arrest rates for juveniles aged 15-17</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>arrest_rates_county <span class="sc">|&gt;</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">|&gt;</span></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">quantiles =</span> <span class="fu">list</span>(</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">quantile</span>(rate_juv_arrest_1517, <span class="at">probs =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.2</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>, <span class="fl">0.8</span>, <span class="fl">0.9</span>, <span class="fl">0.99</span>, <span class="dv">1</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(quantiles)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 9
  year   `0%` `20%` `40%` `60%` `80%` `90%`  `99%` `100%`
  &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
1 2021      0  148.  708. 1543. 3040. 4774. 12287. 23252.
2 2022      0  193.  799. 1744. 3359. 5019. 12784. 44840.
3 2023      0  226.  889. 1858. 3508. 5262. 12403. 56747.</code></pre>
</div>
</div>
<p>There is less missingness over time. This makes sense, because more agencies report to NIBRS over time.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>arrest_rates_county <span class="sc">%&gt;%</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(rate_juv_arrest)) <span class="sc">%&gt;%</span></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
# Groups:   year [3]
  year      n
  &lt;chr&gt; &lt;int&gt;
1 2021    307
2 2022    265
3 2023    242</code></pre>
</div>
</div>
<p>The rate of missingness is the same for the quality variable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>arrest_rates_county <span class="sc">%&gt;%</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(rate_juv_arrest_quality)) <span class="sc">%&gt;%</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
# Groups:   year [3]
  year      n
  &lt;chr&gt; &lt;int&gt;
1 2021    307
2 2022    265
3 2023    242</code></pre>
</div>
</div>
</section>
<section id="save-and-write-out-data" class="level1">
<h1>8. Save and write out data</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>arrest_rates_county_all <span class="ot">&lt;-</span> arrest_rates_county <span class="sc">|&gt;</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(year, GEOID, <span class="fu">starts_with</span>(<span class="st">"rate"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">state =</span> <span class="fu">substr</span>(GEOID, <span class="dv">1</span>, <span class="dv">2</span>),</span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">county =</span> <span class="fu">substr</span>(GEOID, <span class="dv">3</span>, <span class="dv">5</span>)</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Create a subset without subgroup rates and write out this data set</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co"># File with only total juvenile arrest rates</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>rate_juv_arrest_county_all <span class="ot">&lt;-</span> arrest_rates_county_all <span class="sc">|&gt;</span></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>    year,</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>    state,</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>    county,</span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>    rate_juv_arrest,</span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>    rate_juv_arrest_quality</span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">evaluate_final_data</span>(</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">exp_form_path =</span> <span class="st">"10a_final-evaluation/evaluation_form_rate_arrests_overall_county.csv"</span>,</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> rate_juv_arrest_county_all,  </span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">geography =</span> <span class="st">"county"</span>,</span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">subgroups =</span> <span class="cn">FALSE</span>, </span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">confidence_intervals =</span> <span class="cn">FALSE</span></span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "This data passes all tests!"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Write out this data set</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>rate_juv_arrest_county_all <span class="sc">|&gt;</span></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_csv</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"07_safety"</span>,</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"final"</span>,</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"rate_arrests_county_all.csv"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Create a file that is long by subgroup and write it out</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co"># pivot longer subgroup arrest rates</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>juv_arrest_all_subgroup <span class="ot">&lt;-</span> arrest_rates_county_all <span class="sc">|&gt;</span></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rate_juv_arrest_all =</span> rate_juv_arrest) <span class="sc">|&gt;</span></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>    year, </span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>    state, </span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>    county, </span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>    rate_juv_arrest_all, </span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a>    rate_juv_arrest_white, </span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a>    rate_juv_arrest_black,</span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a>    rate_juv_arrest_asian_other,</span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a>    rate_juv_arrest_hispanic,</span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a>    rate_juv_arrest_male,</span>
<span id="cb82-14"><a href="#cb82-14" aria-hidden="true" tabindex="-1"></a>    rate_juv_arrest_female,</span>
<span id="cb82-15"><a href="#cb82-15" aria-hidden="true" tabindex="-1"></a>    rate_juv_arrest_1014,</span>
<span id="cb82-16"><a href="#cb82-16" aria-hidden="true" tabindex="-1"></a>    rate_juv_arrest_1517,</span>
<span id="cb82-17"><a href="#cb82-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">quality =</span> rate_juv_arrest_quality</span>
<span id="cb82-18"><a href="#cb82-18" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb82-19"><a href="#cb82-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">contains</span>(<span class="st">"rate_juv_arrest_"</span>), </span>
<span id="cb82-20"><a href="#cb82-20" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"subgroup"</span>,</span>
<span id="cb82-21"><a href="#cb82-21" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"rate_juv_arrest"</span>,</span>
<span id="cb82-22"><a href="#cb82-22" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_drop_na =</span> <span class="cn">TRUE</span>,</span>
<span id="cb82-23"><a href="#cb82-23" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_pattern =</span> <span class="st">"rate_juv_arrest_(.*)"</span>) <span class="sc">|&gt;</span></span>
<span id="cb82-24"><a href="#cb82-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">rate_juv_arrest_quality =</span> quality)</span>
<span id="cb82-25"><a href="#cb82-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-26"><a href="#cb82-26" aria-hidden="true" tabindex="-1"></a>acs_pops_subgroup <span class="ot">&lt;-</span> acs_pops <span class="sc">|&gt;</span></span>
<span id="cb82-27"><a href="#cb82-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pop_1017_all =</span> pop_1017) <span class="sc">|&gt;</span></span>
<span id="cb82-28"><a href="#cb82-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">contains</span>(<span class="st">"pop_1017_"</span>), </span>
<span id="cb82-29"><a href="#cb82-29" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"subgroup"</span>,</span>
<span id="cb82-30"><a href="#cb82-30" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"pop"</span>,</span>
<span id="cb82-31"><a href="#cb82-31" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_drop_na =</span> <span class="cn">TRUE</span>,</span>
<span id="cb82-32"><a href="#cb82-32" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_pattern =</span> <span class="st">"pop_1017_(.*)"</span>) <span class="sc">|&gt;</span></span>
<span id="cb82-33"><a href="#cb82-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(year, <span class="at">state =</span> state_fips, <span class="at">county =</span> county_fips, subgroup, pop)</span>
<span id="cb82-34"><a href="#cb82-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-35"><a href="#cb82-35" aria-hidden="true" tabindex="-1"></a><span class="co"># combine into one file</span></span>
<span id="cb82-36"><a href="#cb82-36" aria-hidden="true" tabindex="-1"></a><span class="co"># replace quality indicators with missing if subgroup population &lt; 30</span></span>
<span id="cb82-37"><a href="#cb82-37" aria-hidden="true" tabindex="-1"></a>juv_arrest_county_all_subgroup <span class="ot">&lt;-</span> <span class="fu">left_join</span>(</span>
<span id="cb82-38"><a href="#cb82-38" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> acs_pops_subgroup,</span>
<span id="cb82-39"><a href="#cb82-39" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> juv_arrest_all_subgroup,</span>
<span id="cb82-40"><a href="#cb82-40" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"year"</span>, <span class="st">"state"</span>, <span class="st">"county"</span>, <span class="st">"subgroup"</span>)</span>
<span id="cb82-41"><a href="#cb82-41" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb82-42"><a href="#cb82-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb82-43"><a href="#cb82-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">subgroup_type =</span> <span class="fu">case_when</span>(</span>
<span id="cb82-44"><a href="#cb82-44" aria-hidden="true" tabindex="-1"></a>      subgroup <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"all"</span>) <span class="sc">~</span> <span class="st">"all"</span>,</span>
<span id="cb82-45"><a href="#cb82-45" aria-hidden="true" tabindex="-1"></a>      subgroup <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"white"</span>, <span class="st">"black"</span>, <span class="st">"asian_other"</span>, <span class="st">"hispanic"</span>) <span class="sc">~</span> <span class="st">"race-ethnicity"</span>,</span>
<span id="cb82-46"><a href="#cb82-46" aria-hidden="true" tabindex="-1"></a>      subgroup <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"male"</span>, <span class="st">"female"</span>) <span class="sc">~</span> <span class="st">"gender"</span>,</span>
<span id="cb82-47"><a href="#cb82-47" aria-hidden="true" tabindex="-1"></a>      subgroup <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"1014"</span>, <span class="st">"1517"</span>) <span class="sc">~</span> <span class="st">"age"</span>,</span>
<span id="cb82-48"><a href="#cb82-48" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb82-49"><a href="#cb82-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">subgroup =</span> <span class="fu">case_when</span>(</span>
<span id="cb82-50"><a href="#cb82-50" aria-hidden="true" tabindex="-1"></a>      subgroup <span class="sc">==</span> <span class="st">"all"</span> <span class="sc">~</span> <span class="st">"All"</span>,</span>
<span id="cb82-51"><a href="#cb82-51" aria-hidden="true" tabindex="-1"></a>      subgroup <span class="sc">==</span> <span class="st">"white"</span> <span class="sc">~</span> <span class="st">"White"</span>,</span>
<span id="cb82-52"><a href="#cb82-52" aria-hidden="true" tabindex="-1"></a>      subgroup <span class="sc">==</span> <span class="st">"black"</span> <span class="sc">~</span> <span class="st">"Black"</span>,</span>
<span id="cb82-53"><a href="#cb82-53" aria-hidden="true" tabindex="-1"></a>      subgroup <span class="sc">==</span> <span class="st">"hispanic"</span> <span class="sc">~</span> <span class="st">"Hispanic"</span>,</span>
<span id="cb82-54"><a href="#cb82-54" aria-hidden="true" tabindex="-1"></a>      subgroup <span class="sc">==</span> <span class="st">"asian_other"</span> <span class="sc">~</span> <span class="st">"Other Races and Ethnicities"</span>,</span>
<span id="cb82-55"><a href="#cb82-55" aria-hidden="true" tabindex="-1"></a>      subgroup <span class="sc">==</span> <span class="st">"1014"</span> <span class="sc">~</span> <span class="st">"Age 10 to 14"</span>,</span>
<span id="cb82-56"><a href="#cb82-56" aria-hidden="true" tabindex="-1"></a>      subgroup <span class="sc">==</span> <span class="st">"1517"</span> <span class="sc">~</span> <span class="st">"Age 15 to 17"</span>,</span>
<span id="cb82-57"><a href="#cb82-57" aria-hidden="true" tabindex="-1"></a>      subgroup <span class="sc">==</span> <span class="st">"male"</span> <span class="sc">~</span> <span class="st">"Male"</span>,</span>
<span id="cb82-58"><a href="#cb82-58" aria-hidden="true" tabindex="-1"></a>      subgroup <span class="sc">==</span> <span class="st">"female"</span> <span class="sc">~</span> <span class="st">"Female"</span></span>
<span id="cb82-59"><a href="#cb82-59" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb82-60"><a href="#cb82-60" aria-hidden="true" tabindex="-1"></a>    <span class="at">rate_juv_arrest_quality =</span> <span class="fu">ifelse</span>(pop <span class="sc">&lt;</span> <span class="dv">30</span>, <span class="cn">NA</span>, rate_juv_arrest_quality))</span>
<span id="cb82-61"><a href="#cb82-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-62"><a href="#cb82-62" aria-hidden="true" tabindex="-1"></a>juv_arrest_county_all_subgroup <span class="ot">&lt;-</span> juv_arrest_county_all_subgroup <span class="sc">|&gt;</span></span>
<span id="cb82-63"><a href="#cb82-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb82-64"><a href="#cb82-64" aria-hidden="true" tabindex="-1"></a>    year,</span>
<span id="cb82-65"><a href="#cb82-65" aria-hidden="true" tabindex="-1"></a>    state,</span>
<span id="cb82-66"><a href="#cb82-66" aria-hidden="true" tabindex="-1"></a>    county,</span>
<span id="cb82-67"><a href="#cb82-67" aria-hidden="true" tabindex="-1"></a>    subgroup_type,</span>
<span id="cb82-68"><a href="#cb82-68" aria-hidden="true" tabindex="-1"></a>    subgroup,</span>
<span id="cb82-69"><a href="#cb82-69" aria-hidden="true" tabindex="-1"></a>    rate_juv_arrest,</span>
<span id="cb82-70"><a href="#cb82-70" aria-hidden="true" tabindex="-1"></a>    rate_juv_arrest_quality</span>
<span id="cb82-71"><a href="#cb82-71" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb82-72"><a href="#cb82-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(year, state, county, subgroup_type, subgroup)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>juv_arrest_county_all_raceth <span class="ot">&lt;-</span> juv_arrest_county_all_subgroup <span class="sc">|&gt;</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(subgroup_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"all"</span>, <span class="st">"race-ethnicity"</span>))</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a><span class="fu">evaluate_final_data</span>(</span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">exp_form_path =</span> <span class="st">"10a_final-evaluation/evaluation_form_rate_arrests_race-ethnicity_county.csv"</span>,</span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> juv_arrest_county_all_raceth,  </span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">geography =</span> <span class="st">"county"</span>,</span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">subgroups =</span> <span class="cn">TRUE</span>, </span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">confidence_intervals =</span> <span class="cn">FALSE</span></span>
<span id="cb83-10"><a href="#cb83-10" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "This data passes all tests!"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>juv_arrest_county_all_gender <span class="ot">&lt;-</span> juv_arrest_county_all_subgroup <span class="sc">|&gt;</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(subgroup_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"all"</span>, <span class="st">"gender"</span>))</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a><span class="fu">evaluate_final_data</span>(</span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">exp_form_path =</span> <span class="st">"10a_final-evaluation/evaluation_form_rate_arrests_gender_county.csv"</span>,</span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> juv_arrest_county_all_gender,  </span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">geography =</span> <span class="st">"county"</span>,</span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">subgroups =</span> <span class="cn">TRUE</span>, </span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">confidence_intervals =</span> <span class="cn">FALSE</span></span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "This data passes all tests!"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>juv_arrest_county_all_age <span class="ot">&lt;-</span> juv_arrest_county_all_subgroup <span class="sc">|&gt;</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(subgroup_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"all"</span>, <span class="st">"age"</span>))</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a><span class="fu">evaluate_final_data</span>(</span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">exp_form_path =</span> <span class="st">"10a_final-evaluation/evaluation_form_rate_arrests_age_county.csv"</span>,</span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> juv_arrest_county_all_age,  </span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">geography =</span> <span class="st">"county"</span>,</span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">subgroups =</span> <span class="cn">TRUE</span>, </span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">confidence_intervals =</span> <span class="cn">FALSE</span></span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "This data passes all tests!"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Write out this data set</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>juv_arrest_county_all_subgroup <span class="sc">|&gt;</span></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_csv</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"07_safety"</span>,</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"final"</span>,</span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"rate_arrests_county_all_subgroup.csv"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>