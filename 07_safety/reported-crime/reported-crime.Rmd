---
title: "Reported Violent Crime and Property Crime"
author: "Vincent Pancini"
date: "`r format(Sys.time(), '%B %d, %Y %H:%M')`"
output:
  html_document:
    number_sections: false
    self_contained: TRUE
    code_folding: show
    toc: TRUE
    toc_float: TRUE
    editor_options:
      chunk_output_type: console
---

<style>
@import url('https://fonts.googleapis.com/css?family=Lato&display=swap');
</style>

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato" />



```{r rmarkdown-setup, echo = FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE)
```

```{r setup}
options(scipen = 999)

library(tidyverse)

# set_urbn_defaults(style = "print")

```

## 1. Load and clean offense data

The data for this metric come from the FBI's [National Incident-Based Reporting System (NIBRS)](https://bjs.ojp.gov/national-incident-based-reporting-system-nibrs). This is the national standard for law enforcement crime data reporting in the United States. Processing the raw NIBRS data would take a lot of work.

Instead, we use criminologist Jacob Kaplan's Concatenated Files: National Incident-Based Reporting System (NIBRS) Data, 1991-2022. These data are available for download via [openICPSR](https://www.openicpsr.org/openicpsr/project/118281/version/V9/view).

We want the offense segment for this metric, so we download `nibrs_1991_2022_offense_segment_rds.zip` and agree to the `Terms of Use`, unzip the file, select `nibrs_offense_segment_2022.rds`, and move it to the appropriate directory and folder. Now, we read in the data.
```{r}
# Load 2022 NIBRS offense segment
offense_data <- readRDS(here::here("07_safety", "reported-crime", "nibrs_offense_segment_2022.rds"))
#todo(): delete following line
# full_data <- offense_data

```

Limit the data to our variables of interest.
```{r}
offense_data <- offense_data %>%
  select(agency = ori, # An ORI (Originating Agency Identifier) is a unique nine-character identifier the National Crime Information Center (NCIC) has assigned to each law enforcement agency (LEA) in coordination with the CJIS Systems Officer (CSO)
         ucr_offense_code)
```

There are 61 unique crimes/offense codes in our data. We group these offense codes into property crimes and violent crimes using the categories outlines in the [2021.1 National Incident-Based Reporting System User Manual](https://bjs.ojp.gov/sites/g/files/xyckuh236/files/sarble/data_common/nibrs-user-manual-2021-1041521.pdf) and aggregate counts up to the reporting agency level.
```{r}
# Count number of observations in each offense code 
crimes <- offense_data %>%
  count(ucr_offense_code)

# Create a vector for property crimes
property <- c(
  "all other larceny", 
  "arson", "bribery", 
  "burglary/breaking and entering",
  "counterfeiting/forgery", 
  "credit card/atm fraud", 
  "destruction/damage/vandalism of property", 
  "embezzlement",
  "extortion/blackmail", 
  "false pretenses/swindle/confidence game",
  "hacking/computer invasion", 
  "identity theft", 
  "impersonation",
  "motor vehicle theft", 
  "pocket-picking", 
  "purse-snatching", 
  "robbery",
  "shoplifting", 
  "stolen property offenses (receiving, selling, etc.)",
  "theft from building", 
  "theft from coin-operated machine or device",
  "theft from motor vehicle", 
  "theft of motor vehicle parts/accessories",
  "welfare fraud", 
  "wire fraud"
)

# Create a vector for violent crimes
violent <- c(
  "aggravated assault", 
  "fondling (incident liberties/child molest)",
  "human trafficking - commercial sex acts", 
  "human trafficking - involuntary servitude",
  "incest", 
  "intimidation", 
  "kidnapping/abduction", 
  "murder/nonnegligent manslaughter", 
  "negligent manslaughter", 
  "rape",
  "sexual assault with an object", 
  "simple assault", 
  "sodomy",
  "statutory rape"
)

# Create indicator variables for property and violent crimes
offense_data <- offense_data %>%
  mutate(property = ifelse(ucr_offense_code %in% property, 1, 0),
         violent = ifelse(ucr_offense_code %in% violent, 1, 0)
  )

# Aggregate property and violent crimes by agency
offense_data_agency <- offense_data %>%
  group_by(agency) %>%
  summarize(all = n(),
            violent = sum(violent),
            property = sum(property)) %>%
  ungroup()

# Remove obsolete objects
rm(property, violent)

```


