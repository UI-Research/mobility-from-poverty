---
title: ""
author: ""
date: "`r format(Sys.time(), '%d %B, %Y')`"
format:
  html:
    embed-resources: true
    code-fold: true
    css: 10_construct-database/www/web_report.css
    toc: true
    toc_float: true
editor_options: 
  chunk_output_type: console
---

<style>
@import url('https://fonts.googleapis.com/css?family=Lato&display=swap');
</style>

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato" />

```{r rmarkdown-setup, include = FALSE}
knitr::opts_chunk$set(message = FALSE)
knitr::opts_chunk$set(warning = FALSE)
options(knitr.kable.NA = "")

```

```{r load-packages}
library(tidyverse)
library(here)
library(assertr)
library(gt)

```



```{r add-labels}
county_pop <- read_csv(here("geographic-crosswalks", "data", "county-populations.csv")) %>%
  select(state, county, state_name, county_name) %>%
  distinct()

```

Gm note: environmental index is updated to have subgroups by race share

## Environmental

```{r}
environment <- 
  read_csv(here("06_neighborhoods", "environment", "data", "output", "environment_county_sub_all.csv"), guess_max = Inf) %>%
  mutate(
    subgroup = recode(
      subgroup,
      `High Poverty` = "High Poverty Tracts",
      `Not High Poverty` = "Not High Poverty Tracts"
    )
  ) %>%
  left_join(county_pop) %>%
  relocate(year, state, county, state_name, county_name) 

write_csv(environment, here("data", "04_environmental-exposure_poverty_longitudinal.csv")) 

```


```{r}
SEDA <- read_csv(here("08_education", "SEDA_all_subgroups_county.csv")) %>%
  filter(subgroup_type %in% c("all", "income")) %>%
  mutate(
    subgroup = case_when(
      subgroup == "All" ~ "All",
      subgroup == "Economically Disadvantaged" ~ "Low Income",
      subgroup == "Not Economically Disadvantaged" ~ "Not Low-Income"
    )
  ) %>%
  left_join(county_pop) %>%
  rename(
    rate_learning = learning_rate,
    rate_learning_lb = learning_rate_lb,
    rate_learning_ub = learning_rate_ub,
    rate_learning_quality = learning_rate_quality
  ) %>%
  relocate(year, state, county, state_name, county_name)

write_csv(SEDA, here("data", "04_SEDA-income_longitudinal.csv"))

```
