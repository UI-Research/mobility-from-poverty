---
title: ""
author: ""
date: "`r format(Sys.time(), '%d %B, %Y')`"
format:
  html:
    code-fold: true
    css: 10_construct-database/www/web_report.css
    toc: true
    toc_float: true
editor_options: 
  chunk_output_type: console
---

<style>
@import url('https://fonts.googleapis.com/css?family=Lato&display=swap');
</style>

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato" />

```{r rmarkdown-setup, include = FALSE}
knitr::opts_chunk$set(message = FALSE)
knitr::opts_chunk$set(warning = FALSE)
options(knitr.kable.NA = "")

```

```{r load-packages}
library(tidyverse)
library(here)
library(assertr)
library(gt)

```



<!-- Gm note: environmental index is updated to have subgroups by race share  -->
<!-- ## Environmental  -->

<!-- ```{r} -->
<!-- read_csv(here("06_neighborhoods", "environment", "enviro_poverty.csv"), guess_max = 5000) %>% -->
<!--   mutate( -->
<!--     subgroup = recode( -->
<!--       subgroup, -->
<!--       `High Poverty` = "High Poverty Tracts", -->
<!--       `Not High Poverty` = "Not High Poverty Tracts" -->
<!--     ) -->
<!--   ) %>% -->
<!--   write_csv(here("data", "environmental-exposure_poverty.csv")) -->

<!-- ``` -->

```{r}
SEDA <- read_csv(here("08_education", "SEDA_all_subgroups_county.csv")) %>%
  filter(subgroup_type %in% c("all", "income")) %>%
  #filter(year == 2015) %>% #GM note: not obvious why we do this 
  mutate(
    subgroup = case_when(
      subgroup == "All" ~ "All",
      subgroup == "Economically Disadvantaged" ~ "Low Income",
      subgroup == "Not Economically Disadvantaged" ~ "Not Low-Income"
    )
  )

SEDA_recent <- SEDA %>%
  slice_max(year) %>%
  write_csv(here("data", "04_SEDA-income_recent.csv"))

write_csv(SEDA, here("data", "04_SEDA-income_longitudinal.csv"))
```

## Poverty Exposure

```{r}
files <- c(
  here("06_neighborhoods", "poverty-exposure", "poverty-exposure_race-ethnicity_county_2018.csv"),
  here("06_neighborhoods", "poverty-exposure", "poverty-exposure_race-ethnicity_county_2021.csv")
  )

pov_exposure_race_ethnicity <- lapply(files, read_csv) %>%
  bind_rows() %>%
  write_csv(here("data", "04_poverty-exposure_race-ethnicity_longitudinal.csv"))


read_csv(  
  here("06_neighborhoods", "poverty-exposure", "poverty-exposure_race-ethnicity_county_2021.csv")
  ) %>%
  write_csv(
    here("data", "04_poverty-exposure_race-ethnicity_recent.csv")

  )

```




